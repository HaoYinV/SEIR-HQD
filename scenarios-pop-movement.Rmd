---
title: "The Interaction between Population Age Structure and Policy Interventions on the Spread of COVID-19"
author: "Hao Yin"
date: "8/10/2020"
output: html_document
---
```{r model description}

##########################################################################
#scenario simulations with SEIR-HQD-population movement model
#codes for the study "The Interaction between Population Age Structure and Policy Interventions on the Spread of COVID-19"
##########################################################################
```


```{r packages}
library(deSolve)
library(ggsci)
library(lubridate)
library(viridis)
library(data.table)
library(dplyr)
```



```{r parameters}

birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")
incub.rate <- as.data.frame(incub.rate)
write.csv(incub.rate,"incub.rate.csv")



hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis

#para 11
quar.rate_nairobi =c(rep(0.00001,9))
quar.rate_daegu =c(rep(0.00001,9))
quar.rate_nyc =c(rep(0.00001,9))
quar.rate_la =c(rep(0.00001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.

tourism_age_structure <- c(0.062, 0.153, 0.185, 0.175, 0.149, 0.126, 0.089, 0.047, 0.012)

```

```{r current policy package in NYC}

#current policy package in NYC
nyc_int_travel_import_data <- readRDS("nyc_int_travel_import_data.rds")
nyc_int_travel_export_data <- readRDS("nyc_int_travel_export_data.rds")
nyc_dom_travel_import_data <- readRDS("nyc_dom_travel_import_data.rds")
nyc_dom_travel_export_data <- readRDS("nyc_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_nyc_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "New York")
age_specific_incidence_prop_nyc_extend_agg<-fread("age_specific_prop_nyc_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")
covid19_infected_US_korea_kenya_travel<-fread("covid19_infected_US_korea_kenya_travel.csv", header = T)
age_specific_domestic_prop_US_extend_agg<-fread("age_specific_domestic_prop_US_extend_agg.csv", header = T)
age_specific_domestic_prop_US_extend_annual_agg<-fread("age_specific_domestic_prop_US_extend_annual_agg.csv", header = T)
age_specific_domestic_incidence_US_extend_agg<-fread("age_specific_domestic_incidence_US_extend_agg.csv", header = T)
age_specific_domestic_incidence_US_extend_annual_agg<-fread("age_specific_domestic_incidence_US_extend_annual_agg.csv", header = T)

#contact matrix package

contact_matrix_9age_ny <-readRDS("contact_matrix_9age_ny.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_ny <- list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work,contact_matrix_9age_ny$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_ny<-list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work*0.95,contact_matrix_9age_ny$other*0.98)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_ny<-list(contact_matrix_9age_ny$home*1.2,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.6,contact_matrix_9age_ny$other*0.8)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.45)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.3,contact_matrix_9age_ny$other*0.3)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.40)


#transmissibility
transmissibility_9age_nyc <- readRDS("transmissibility_9age_nyc.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact_matrix_9age_nointer_ny)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p1_ny)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p2_ny)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p3_ny)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p4_ny)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p5_ny)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc.rds")

parameters_nyc <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc/transm.rate_without_intervention_nyc),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.1,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                                d.import = c(rep(1-0.70,9)),
                                i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                                d.export = c(rep(1-0.70,9)),
                                i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                                d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                                transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc*0.9,#transmission rate
                                incub.rate = c(rep(1,9)),#
                                recov.rate = c(rep(1,9)),
                                hosp.rate = c(rep(1,9)),#hospitalization rate
                                fatal.rate = c(rep(1,9)),
                                quar.rate = c(rep(1e04*0.15,9)),
                                death.rate = c(rep(1,9)), #death.rate,
                                birth.rate = c(rep(1,9)),
                                n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

#2020-04-03
constraint_package5_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                                d.import = c(rep(1-0.80,9)),
                                i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                                d.export = c(rep(1-0.80,9)),
                                i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                                d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                                transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                                incub.rate = c(rep(1,9)),#
                                recov.rate = c(rep(1,9)),
                                hosp.rate = c(rep(1,9)),#hospitalization rate
                                fatal.rate = c(rep(1,9)),
                                quar.rate = c(rep(1e04*0.5,9)),
                                death.rate = c(rep(1,9)), #death.rate,
                                birth.rate = c(rep(1,9)),
                                n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")


#2020-05-18
constraint_package6_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                                d.import = c(rep(0.1,9)),
                                i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                                d.export = c(rep(0.1,9)),
                                i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                                d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                                transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                                incub.rate = c(rep(1,9)),#
                                recov.rate = c(rep(1,9)),
                                hosp.rate = c(rep(1,9)),#hospitalization rate
                                fatal.rate = c(rep(1,9)),
                                quar.rate = c(rep(1e04*0.7,9)),
                                death.rate = c(rep(1,9)), #death.rate,
                                birth.rate = c(rep(1,9)),
                                n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")

E. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")



#simulate the cases
SEIHDQR_9age_simulation_nyc_no_inter_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"), constraint1 = constraint_no_intervention_nyc, constraint2 = constraint_no_intervention_nyc, constraint3 = constraint_no_intervention_nyc, constraint4 = constraint_no_intervention_nyc, constraint5 = constraint_no_intervention_nyc, constraint6 =constraint_no_intervention_nyc)#2 days time lag



#plots
SEIHDQR_9age_simulation_nyc_no_inter_estimate_long <- SEIHDQR_9age_simulation_nyc_no_inter_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_no_inter_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_no_inter_estimate_long <- cbind(SEIHDQR_9age_simulation_nyc_no_inter_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_no_inter_estimate_long ,"SEIHDQR_9age_simulation_nyc_no_inter_estimate_long.csv",row.names = F)
I_9age_simulation_nyc_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_nyc_no_inter_estimate_long, state=="I")
case_agg <- aggregate(estimate~state+time, FUN= sum, na.rm=T, I_9age_simulation_nyc_no_inter_estimate_long)
#plot(x=case_agg$time, y = case_agg$estimate)
SEIHDQR_9age_simulation_nyc_no_inter_estimate_long<-fread("SEIHDQR_9age_simulation_nyc_no_inter_estimate_long.csv")
SEIHDQR_9age_simulation_nyc_no_inter_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_no_inter_estimate_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_no_inter_estimate_long, state=="D"))
ID_9age_simulation_nyc_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_nyc_no_inter_estimate_long, state=="I" | state == "D")
#View(ID_9age_simulation_nyc_no_inter_estimate_long)
line_plot_ID_9age_simulation_no_inter_nyc <- ggplot(ID_9age_simulation_nyc_no_inter_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("New York City no intervention")

ggsave("line_plot_ID_9age_nyc_no_intervention.pdf", width = 12, height = 10)




#simulate the cases


SEIHDQR_9age_simulation_nyc_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


#plots 
SEIHDQR_9age_simulation_nyc_estimate_long <- SEIHDQR_9age_simulation_nyc_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_long ,"SEIHDQR_9age_simulation_nyc_estimate_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_long, state=="D"))
ID_9age_simulation_nyc_estimate_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc <- ggplot(ID_9age_simulation_nyc_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("New York City policy intervention")

ggsave("line_plot_ID_9age_nyc_policy_intervention.pdf", width = 12, height = 10)



#all policy-package one week earlier 

SEIHDQR_9age_simulation_nyc_estimate_pearlier <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-04'), inter_start_date2 = as.Date("2020-03-10"), inter_start_date3 = as.Date("2020-03-14"), inter_start_date4 = as.Date("2020-03-18"),inter_start_date5 = as.Date("2020-03-27"),inter_start_date6 = as.Date("2020-04-09"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


#plots
SEIHDQR_9age_simulation_nyc_estimate_pearlier_long <- SEIHDQR_9age_simulation_nyc_estimate_pearlier %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_pearlier_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_pearlier_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_pearlier_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_pearlier_long ,"SEIHDQR_9age_simulation_nyc_estimate_pearlier_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_pearlier_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_pearlier_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_long, state=="D"))
ID_9age_simulation_nyc_estimate_pearlier_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_pearlier_long, state=="I" | state == "D")#

line_plot_ID_9age_simulation_nyc_pearlier <- ggplot(ID_9age_simulation_nyc_estimate_pearlier_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("New York City policy intervention")

ggsave("line_plot_ID_9age_nyc_policy_intervention_pearlier.pdf", width = 12, height = 10)


```




```{r current policy package in LA}
la_int_travel_import_data <- readRDS("la_int_travel_import_data.rds")
la_int_travel_export_data <- readRDS("la_int_travel_export_data.rds")
la_dom_travel_import_data <- readRDS("la_dom_travel_import_data.rds")
la_dom_travel_export_data <- readRDS("la_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_la_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "Los Angeles")
age_specific_prop_la_extend_agg<-fread("age_specific_prop_la_extend_agg.csv",header = T)

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")
age_specific_domestic_prop_US_extend_agg<-fread("age_specific_domestic_prop_US_extend_agg.csv")
age_specific_domestic_prop_US_extend_annual_agg<-fread("age_specific_domestic_prop_US_extend_annual_agg.csv")
age_specific_domestic_incidence_US_extend_agg<-fread("age_specific_domestic_incidence_US_extend_agg.csv", header = T)
age_specific_domestic_incidence_US_extend_annual_agg<-fread("age_specific_domestic_incidence_US_extend_annual_agg.csv", header = T)



#contact matrix package

contact_matrix_9age_la <-readRDS("contact_matrix_9age_la.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_la <- list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other*0.9)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_la<-list(contact_matrix_9age_la$home*1.2,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.6,contact_matrix_9age_la$other*0.7)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_la<-list(contact_matrix_9age_la$home*1.2,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.55,contact_matrix_9age_la$other*0.6)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_la<-list(contact_matrix_9age_la$home*1.2,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.5,contact_matrix_9age_la$other*0.55)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_la<-list(contact_matrix_9age_la$home*1.1,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.6,contact_matrix_9age_la$other*0.70)


#transmissibility
transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_la <- unlist(transmissibility_9age_la)*Reduce('+', contact_matrix_9age_nointer_la)
saveRDS(transm.rate_without_intervention_la,"transm.rate_without_intervention_la.rds")
transm.rate_package1_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p1_la)
saveRDS(transm.rate_package1_la,"transm.rate_package1_la.rds")
transm.rate_package2_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p2_la)
saveRDS(transm.rate_package2_la,"transm.rate_package2_la.rds")
transm.rate_package3_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p3_la)
saveRDS(transm.rate_package3_la,"transm.rate_package3_la.rds")
transm.rate_package4_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p4_la)
saveRDS(transm.rate_package4_la,"transm.rate_package4_la.rds")
transm.rate_package5_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p5_la)
saveRDS(transm.rate_package5_la,"transm.rate_package5_la.rds")





parameters_la <- list(i.import=la_int_travel_import_data*tourism_age_structure,
                       d.import=la_dom_travel_import_data*pop_age_structure_la,
                       i.export=la_int_travel_export_data*tourism_age_structure,
                       d.export=la_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)])),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10])),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)

saveRDS(parameters_la,"parameters_la.rds")

constraint_no_intervention_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_la,"constraint_no_intervention_la.rds")
#2020-02-04
#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
constraint_package1_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.9,9)),
                               i.export = c(rep(0.9,9)),
                               d.export = c(rep(0.9,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_la_extend_agg[3,3:11])*100,3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[5,3:11])*100,3)),
                               transm.rate = as.matrix(transm.rate_package1_la/transm.rate_without_intervention_la),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.9,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_la,"constraint_package1_la.rds")


#2020-03-12
#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
constraint_package2_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[7,3:11])*0.01),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11])*0.02,3)), 
                              transm.rate = transm.rate_package2_la/transm.rate_without_intervention_la,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.5,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_la,"constraint_package2_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#2020-03-19
constraint_package3_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[7,3:11]*0.015)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]*0.02),3)),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_la,"constraint_package3_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-04-03
constraint_package4_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.45,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.45,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[9,3:11]*0.025)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[10,3:11]*0.03),3)),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_la,"constraint_package4_la.rds")

#2020-04-16
constraint_package5_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.import = c(rep(1-0.40,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.export = c(rep(1-0.40,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[10,3:11]*0.075)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[11,3:11])*0.1,3)),
                               transm.rate = transm.rate_package4_la/transm.rate_without_intervention_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_la,"constraint_package5_la.rds")


#2020-06-04
constraint_package6_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[17],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[17],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[15,3:11]*0.09)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[16,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_la/transm.rate_without_intervention_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.4,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_la,"constraint_package6_la.rds")

E. = pop_la*pop_age_structure_la*2e-06/incub.rate
I. = pop_la*pop_age_structure_la*2e-06
initials_la <- c(S. = pop_la*pop_age_structure_la - E. - I.,
                  E. = pop_la*pop_age_structure_la*2e-06/incub.rate,
                  I. = pop_la*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_la*pop_age_structure_la*2e-06)
saveRDS(initials_la,"initials_la.rds")
# 
# E. = 1*pop_age_structure_la/incub.rate
# I. = 1*pop_age_structure_la
# initials_la <- c(S. = pop_la*pop_age_structure_la - E. - I.,
#                   E. = I./incub.rate,
#                   I. = 1*pop_age_structure_la,
#                   H. = rep(0,9),
#                   D. = rep(0,9),
#                   Q. = rep(0,9),
#                   R. = rep(0,9),
#                   Ic. = 1*pop_age_structure_la)
# saveRDS(initials_la,"initials_la.rds")
# #simulate the cases
SEIHDQR_9age_simulation_la_no_inter_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_no_intervention_la, constraint2 = constraint_no_intervention_la, constraint3 = constraint_no_intervention_la, constraint4 = constraint_no_intervention_la, constraint5 = constraint_no_intervention_la, constraint6 =constraint_no_intervention_la)



#plots
SEIHDQR_9age_simulation_la_no_inter_estimate_long <- SEIHDQR_9age_simulation_la_no_inter_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_no_inter_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_no_inter_estimate_long <- cbind(SEIHDQR_9age_simulation_la_no_inter_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_no_inter_estimate_long ,"SEIHDQR_9age_simulation_la_no_inter_estimate_long.csv",row.names = F)
I_9age_simulation_la_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_la_no_inter_estimate_long, state=="I")
case_agg <- aggregate(estimate~state+time, FUN= sum, na.rm=T, I_9age_simulation_la_no_inter_estimate_long)
plot(x=case_agg$time, y = case_agg$estimate)
SEIHDQR_9age_simulation_la_no_inter_estimate_long<-fread("SEIHDQR_9age_simulation_la_no_inter_estimate_long.csv")
SEIHDQR_9age_simulation_la_no_inter_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_la_no_inter_estimate_long$time, origin = "2020-01-26")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_la_no_inter_estimate_long, state=="D"))
ID_9age_simulation_la_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_la_no_inter_estimate_long, state=="I" | state == "D")
#View(ID_9age_simulation_la_no_inter_estimate_long)
line_plot_ID_9age_simulation_no_inter_la<- ggplot(ID_9age_simulation_la_no_inter_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Los Angeles no intervention")

ggsave("line_plot_ID_9age_la_no_intervention.pdf", width = 12, height = 10)




#simulate the cases


SEIHDQR_9age_simulation_la_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)


#plots
SEIHDQR_9age_simulation_la_estimate_long <- SEIHDQR_9age_simulation_la_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_estimate_long <- cbind(SEIHDQR_9age_simulation_la_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_estimate_long ,"SEIHDQR_9age_simulation_la_estimate_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_estimate_long<-fread("SEIHDQR_9age_simulation_la_estimate_long.csv")
SEIHDQR_9age_simulation_la_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_la_estimate_long$time, origin = "2020-01-26")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_la_estimate_long, state=="D"))
ID_9age_simulation_la_estimate_long<-subset(SEIHDQR_9age_simulation_la_estimate_long, state=="I" | state == "D")#
#View(ID_9age_simulation_la_estimate_long)
line_plot_ID_9age_simulation_la <- ggplot(ID_9age_simulation_la_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Los Angeles policy intervention")

ggsave("line_plot_ID_9age_la_policy_intervention.pdf", width = 12, height = 10)




constraint_no_intervention_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_la,"constraint_no_intervention_la.rds")
#2020-02-04
#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
constraint_package1_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.9,9)),
                               i.export = c(rep(0.9,9)),
                               d.export = c(rep(0.9,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_la_extend_agg[3,3:11])*100,3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[5,3:11])*100,3)),
                               transm.rate = as.matrix(transm.rate_package1_la/transm.rate_without_intervention_la),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.9,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_la,"constraint_package1_la.rds")


#2020-03-12
#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
constraint_package2_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[7,3:11])*800),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11])*1500,3)), 
                              transm.rate = transm.rate_package2_la/transm.rate_without_intervention_la,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.5,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_la,"constraint_package2_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#2020-03-19
constraint_package3_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[7,3:11]*1000)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]*2000),3)),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_la,"constraint_package3_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-04-03
constraint_package4_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.45,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.45,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[9,3:11]*2000)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[10,3:11]*2500),3)),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_la,"constraint_package4_la.rds")

#2020-04-16
constraint_package5_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.import = c(rep(1-0.40,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.export = c(rep(1-0.40,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[10,3:11]*6500)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[11,3:11])*8000,3)),
                               transm.rate = transm.rate_package4_la/transm.rate_without_intervention_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_la,"constraint_package5_la.rds")


#2020-06-04
constraint_package6_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[17],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[17],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[15,3:11]*8000)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[16,3:11]*9000),3)),
                               transm.rate = transm.rate_package5_la/transm.rate_without_intervention_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.4,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_la,"constraint_package6_la.rds")


SEIHDQR_9age_simulation_la_estimate_pearlier <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-05"), inter_start_date3 = as.Date("2020-03-12"), inter_start_date4 = as.Date("2020-03-27"),inter_start_date5 = as.Date("2020-04-09"),inter_start_date6 = as.Date("2020-05-28"),inter_end_date6 = as.Date("2021-01-24"),  constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)


#plots
SEIHDQR_9age_simulation_la_estimate_pearlier_long <- SEIHDQR_9age_simulation_la_estimate_pearlier %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_estimate_pearlier_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_estimate_pearlier_long <- cbind(SEIHDQR_9age_simulation_la_estimate_pearlier_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_estimate_pearlier_long ,"SEIHDQR_9age_simulation_la_estimate_pearlier_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_la_estimate_pearlier_long.csv")
SEIHDQR_9age_simulation_la_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_la_estimate_pearlier_long$time, origin = "2020-01-26")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_la_estimate_long, state=="D"))
ID_9age_simulation_la_estimate_pearlier_long<-subset(SEIHDQR_9age_simulation_la_estimate_pearlier_long, state=="I" | state == "D")#

line_plot_ID_9age_simulation_la_pearlier <- ggplot(ID_9age_simulation_la_estimate_pearlier_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Los Angeles policy intervention")

ggsave("line_plot_ID_9age_la_policy_intervention_pearlier.pdf", width = 12, height = 10)



```




```{r current policy package in Daegu}

daegu_int_travel_import_data <- readRDS("daegu_int_travel_import_data.rds")
daegu_int_travel_export_data <- readRDS("daegu_int_travel_export_data.rds")
daegu_dom_travel_import_data <- readRDS("daegu_dom_travel_import_data.rds")
daegu_dom_travel_export_data <- readRDS("daegu_dom_travel_export_data.rds")
mobility_nyc_la_daegu_nairobi<- fread("mobility_nyc_la_daegu_nairobi.csv")
mobility_daegu_sub <- subset(mobility_nyc_la_daegu_nairobi, city =="Daegu")
#View(mobility_daegu_sub)
mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_daegu_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "Daegu")
age_specific_incidence_prop_daegu_extend_agg<-fread("age_specific_prop_daegu_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")



contact_matrix_9age_daegu <-readRDS("contact_matrix_9age_daegu.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_daegu <- list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other)
#2020-01-28
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work*0.95,contact_matrix_9age_daegu$other*0.88)
#2020-02-07
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work*0.9,contact_matrix_9age_daegu$other*0.85)
#2020-02-20
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work*0.9,contact_matrix_9age_daegu$other*0.8)
#2020-02-25 4-20
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work*0.7,contact_matrix_9age_daegu$other*0.7)
#2020-05-06
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0.1,contact_matrix_9age_daegu$work*0.7,contact_matrix_9age_daegu$other*0.7)


#transmissibility
transmissibility_9age_daegu <- readRDS("transmissibility_9age_daegu.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact_matrix_9age_nointer_daegu)
saveRDS(transm.rate_without_intervention_daegu,"transm.rate_without_intervention_daegu.rds")
transm.rate_package1_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p1_daegu)
saveRDS(transm.rate_package1_daegu,"transm.rate_package1_daegu.rds")
transm.rate_package2_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p2_daegu)
saveRDS(transm.rate_package2_daegu,"transm.rate_package2_daegu.rds")
transm.rate_package3_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p3_daegu)
saveRDS(transm.rate_package3_daegu,"transm.rate_package3_daegu.rds")
transm.rate_package4_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p4_daegu)
saveRDS(transm.rate_package4_daegu,"transm.rate_package4_daegu.rds")
transm.rate_package5_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p5_daegu)
saveRDS(transm.rate_package5_daegu,"transm.rate_package5_daegu.rds")

parameters_daegu <- list(i.import=daegu_int_travel_import_data*tourism_age_structure,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu,
                       i.export=daegu_int_travel_export_data*tourism_age_structure,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.15),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.15)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)


constraint_no_intervention_daegu<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_daegu,"constraint_no_intervention_daegu.rds")
#2020-01-28
#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
constraint_package1_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[2],9)),
                               d.import = c(rep(0.8,9)),
                               i.export = c(rep(0.8,9)),
                               d.export = c(rep(0.8,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_daegu_extend_agg[2,3:11]*0.5),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[2,3:11]*0.5),3)),
                               transm.rate = as.matrix(transm.rate_package1_daegu/transm.rate_without_intervention_daegu)*0.9,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.3,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_daegu,"constraint_package1_daegu.rds")


#2020-02-07
#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
constraint_package2_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[4],9)),
                               d.import = c(rep(1-0.3,9)),
                               i.export = c(rep(1-0.3,9)),
                               d.export = c(rep(1-0.3,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[4,3:11]*0.15)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[3,3:11]*0.15),3)),
                               transm.rate = transm.rate_package2_daegu/transm.rate_without_intervention_daegu*0.8,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.4,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_daegu,"constraint_package2_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#2020-02-20
constraint_package3_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[4],9)),
                               d.import = c(rep(1-0.4,9)),
                               i.export = c(rep(1-0.4,9)),
                               d.export = c(rep(1-0.4,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[4,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[4,3:11]*0.1),3)),
                               transm.rate = transm.rate_package3_daegu/transm.rate_without_intervention_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_daegu,"constraint_package3_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-02-25
constraint_package4_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.5,9)),
                               i.export = c(rep(1-0.5,9)),
                               d.export = c(rep(1-0.5,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[5,3:11]*0.05)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[5,3:11]*0.05),3)),
                               transm.rate = transm.rate_package3_daegu/transm.rate_without_intervention_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.6,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_daegu,"constraint_package4_daegu.rds")

#2020-04-20
constraint_package5_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[11],9)),
                               d.import = c(rep(1-0.8,9)),
                               i.export = c(rep(1-0.8,9)),
                               d.export = c(rep(1-0.8,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[11,3:11]*0.01)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[10,3:11]*0.01),3)),
                               transm.rate = transm.rate_package4_daegu/transm.rate_without_intervention_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_daegu,"constraint_package5_daegu.rds")


#2020-05-06
constraint_package6_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[13],9)),
                               d.import = c(rep(1-0.8,9)),
                               i.export = c(rep(1-0.95,9)),
                               d.export = c(rep(1-0.8,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[11,3:11]*0.01)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[12,3:11]*0.01),3)),
                               transm.rate = transm.rate_package5_daegu/transm.rate_without_intervention_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.8,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_daegu,"constraint_package6_daegu.rds")




E. = pop_daegu*pop_age_structure_daegu*2e-06/incub.rate
I. = pop_daegu*pop_age_structure_daegu*2e-06
initials_daegu <- c(S. = pop_daegu*pop_age_structure_daegu- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_daegu*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_daegu*pop_age_structure_daegu*2e-06)
saveRDS(initials_daegu,"initials_daegu.rds")

library(deSolve)
#no intervention

#simulate the cases
SEIHDQR_9age_simulation_daegu_no_inter_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_no_intervention_daegu, constraint2 = constraint_no_intervention_daegu, constraint3 = constraint_no_intervention_daegu, constraint4 = constraint_no_intervention_daegu, constraint5 = constraint_no_intervention_daegu, constraint6 =constraint_no_intervention_daegu)



#plots
SEIHDQR_9age_simulation_daegu_no_inter_estimate_long <- SEIHDQR_9age_simulation_daegu_no_inter_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_no_inter_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_no_inter_estimate_long <- cbind(SEIHDQR_9age_simulation_daegu_no_inter_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_no_inter_estimate_long ,"SEIHDQR_9age_simulation_daegu_no_inter_estimate_long.csv",row.names = F)
I_9age_simulation_daegu_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_daegu_no_inter_estimate_long, state=="I")
case_agg <- aggregate(estimate~state+time, FUN= sum, na.rm=T, I_9age_simulation_daegu_no_inter_estimate_long)
plot(x=case_agg$time, y = case_agg$estimate)
SEIHDQR_9age_simulation_daegu_no_inter_estimate_long<-fread("SEIHDQR_9age_simulation_daegu_no_inter_estimate_long.csv")
SEIHDQR_9age_simulation_daegu_no_inter_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_no_inter_estimate_long$time, origin = "2020-01-20")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_daegu_no_inter_estimate_long, state=="D"))
ID_9age_simulation_daegu_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_daegu_no_inter_estimate_long, state=="I" | state == "D")
#View(ID_9age_simulation_daegu_no_inter_estimate_long)
line_plot_ID_9age_simulation_no_inter_daegu<- ggplot(ID_9age_simulation_daegu_no_inter_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Daegu no intervention")

ggsave("line_plot_ID_9age_daegu_no_intervention.pdf", width = 12, height = 10)




#simulate the cases


SEIHDQR_9age_simulation_daegu_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"),  constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)


#plots
SEIHDQR_9age_simulation_daegu_estimate_long <- SEIHDQR_9age_simulation_daegu_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_estimate_long <- cbind(SEIHDQR_9age_simulation_daegu_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_estimate_long,"SEIHDQR_9age_simulation_daegu_estimate_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_estimate_long<-fread("SEIHDQR_9age_simulation_daegu_estimate_long.csv")
SEIHDQR_9age_simulation_daegu_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_estimate_long$time, origin = "2020-01-20")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_daegu_estimate_long, state=="D"))
ID_9age_simulation_daegu_estimate_long<-subset(SEIHDQR_9age_simulation_daegu_estimate_long, state=="I" | state == "D")#

I_9age_simulation_daegu_estimate_long <- subset(ID_9age_simulation_daegu_estimate_long, state=="I" & time <= as.Date("2020-07-01"))
sum(I_9age_simulation_daegu_estimate_long$estimate)
line_plot_ID_9age_simulation_daegu <- ggplot(ID_9age_simulation_daegu_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Daegu policy intervention")

ggsave("line_plot_ID_9age_daegu_policy_intervention.pdf", width = 12, height = 10)



#all policy-package one week earlier 

SEIHDQR_9age_simulation_daegu_estimate_pearlier <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-22'), inter_start_date2 = as.Date("2020-02-01"), inter_start_date3 = as.Date("2020-02-13"), inter_start_date4 = as.Date("2020-02-18"),inter_start_date5 = as.Date("2020-04-13"),inter_start_date6 = as.Date("2020-04-30"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)


#plots
SEIHDQR_9age_simulation_daegu_estimate_pearlier_long <- SEIHDQR_9age_simulation_daegu_estimate_pearlier %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_estimate_pearlier_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_estimate_pearlier_long <- cbind(SEIHDQR_9age_simulation_daegu_estimate_pearlier_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_estimate_pearlier_long ,"SEIHDQR_9age_simulation_daegu_estimate_pearlier_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_daegu_estimate_pearlier_long.csv")
SEIHDQR_9age_simulation_daegu_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_estimate_pearlier_long$time, origin = "2020-01-20")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_daegu_estimate_long, state=="D"))
ID_9age_simulation_daegu_estimate_pearlier_long<-subset(SEIHDQR_9age_simulation_daegu_estimate_pearlier_long, state=="I" | state == "D")#

line_plot_ID_9age_simulation_daegu_pearlier <- ggplot(ID_9age_simulation_daegu_estimate_pearlier_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Daegu policy intervention")

ggsave("line_plot_ID_9age_daegu_policy_intervention_pearlier.pdf", width = 12, height = 10)

```



```{r current policy package in Nairobi}
nairobi_int_travel_import_data <- readRDS("nairobi_int_travel_import_data.rds")
nairobi_int_travel_export_data <- readRDS("nairobi_int_travel_export_data.rds")
nairobi_dom_travel_import_data <- readRDS("nairobi_dom_travel_import_data.rds")
nairobi_dom_travel_export_data <- readRDS("nairobi_dom_travel_export_data.rds")
mobility_nyc_la_daegu_nairobi<- fread("mobility_nyc_la_daegu_nairobi.csv")
mobility_nairobi_sub <- subset(mobility_nyc_la_daegu_nairobi, city =="Nairobi")
#View(mobility_daegu_sub)
mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_nairobi_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "Nairobi")
age_specific_incidence_prop_nairobi_extend_agg<-fread("age_specific_prop_nairobi_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")


tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)

#contact matrix package

contact_matrix_9age_nairobi <-readRDS("contact_matrix_9age_nairobi.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_nairobi <- list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other)
#2020-03-15
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work*0.9,contact_matrix_9age_nairobi$other*0.9)
#2020-03-23
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work*0.80,contact_matrix_9age_nairobi$other*0.70)
#2020-03-27
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work*0.60,contact_matrix_9age_nairobi$other*0.55)
#2020-04-15
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work*0.7,contact_matrix_9age_nairobi$other*0.5)
#2020-09-01
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0.5,contact_matrix_9age_nairobi$work*0.8,contact_matrix_9age_nairobi$other*0.8)


#transmissibility
transmissibility_9age_nairobi <- readRDS("transmissibility_9age_nairobi.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact_matrix_9age_nointer_nairobi)
saveRDS(transm.rate_without_intervention_nairobi,"transm.rate_without_intervention_nairobi.rds")
transm.rate_package1_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p1_nairobi)
saveRDS(transm.rate_package1_nairobi,"transm.rate_package1_nairobi.rds")
transm.rate_package2_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p2_nairobi)
saveRDS(transm.rate_package2_nairobi,"transm.rate_package2_nairobi.rds")
transm.rate_package3_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p3_nairobi)
saveRDS(transm.rate_package3_nairobi,"transm.rate_package3_nairobi.rds")
transm.rate_package4_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p4_nairobi)
saveRDS(transm.rate_package4_nairobi,"transm.rate_package4_nairobi.rds")
transm.rate_package5_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p5_nairobi)
saveRDS(transm.rate_package5_nairobi,"transm.rate_package5_nairobi.rds")

parameters_nairobi <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)


constraint_no_intervention_nairobi<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nairobi,"constraint_no_intervention_nairobi.rds")
#2020-03-15
#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
constraint_package1_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(0.8,9)),
                               i.export = c(rep(0.7,9)),
                               d.export = c(rep(0.8,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nairobi_extend_agg[2,3:11]*0.5),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[7,3:11]*0.5),3)),
                               transm.rate = as.matrix(transm.rate_package1_nairobi/transm.rate_without_intervention_nairobi),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nairobi,"constraint_package1_nairobi.rds")


#2020-03-23
#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
constraint_package2_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(1-0.30,9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[3,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[7,3:11]*0.5),3)),
                               transm.rate = transm.rate_package2_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nairobi,"constraint_package2_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#2020-03-27
constraint_package3_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.4,9)),
                               i.export = c(rep(1-0.4,9)),
                               d.export = c(rep(1-0.4,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[3,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[8,3:11]*0.5),3)),
                               transm.rate = transm.rate_package3_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.01,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nairobi,"constraint_package3_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-04-15
constraint_package4_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.import = c(rep(1-0.5,9)),
                               i.export = c(rep(1-0.5,9)),
                               d.export = c(rep(1-0.5,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[5,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[10,3:11]*0.5),3)),
                               transm.rate = transm.rate_package3_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.01,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nairobi,"constraint_package4_nairobi.rds")

#2020-04-20
constraint_package5_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[11],9)),
                               d.import = c(rep(1-0.4,9)),
                               i.export = c(rep(1-0.4,9)),
                               d.export = c(rep(1-0.4,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[6,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[11,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.01,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nairobi,"constraint_package5_nairobi.rds")


#2020-09-01
constraint_package6_nairobi <- list(i.import = c(rep(0.15,9)),
                               d.import = c(rep(0.5,9)),
                               i.export = c(rep(0.4,9)),
                               d.export = c(rep(0.5,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[19,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[24,3:11]*0.5),3)),
                               transm.rate = transm.rate_package5_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.02,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nairobi,"constraint_package6_nairobi.rds")


E. = pop_nairobi*pop_age_structure_nairobi*2e-06#/incub.rate
I. = pop_nairobi*pop_age_structure_nairobi*2e-06
initials_nairobi <- c(S. = pop_nairobi*pop_age_structure_nairobi- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nairobi*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nairobi*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nairobi,"initials_nairobi.rds")

library(deSolve)
#no intervention

#simulate the cases
SEIHDQR_9age_simulation_nairobi_no_inter_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"), constraint1 = constraint_no_intervention_nairobi, constraint2 = constraint_no_intervention_nairobi, constraint3 = constraint_no_intervention_nairobi, constraint4 = constraint_no_intervention_nairobi, constraint5 = constraint_no_intervention_nairobi, constraint6 =constraint_no_intervention_nairobi)



#plots
SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long <- SEIHDQR_9age_simulation_nairobi_no_inter_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long <- cbind(SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long ,"SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long.csv",row.names = F)
I_9age_simulation_nairobi_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long, state=="I")
case_agg <- aggregate(estimate~state+time, FUN= sum, na.rm=T, I_9age_simulation_nairobi_no_inter_estimate_long)
plot(x=case_agg$time, y = case_agg$estimate)
SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long<-fread("SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long.csv")
SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long, state=="D"))
ID_9age_simulation_nairobi_no_inter_estimate_long<-subset(SEIHDQR_9age_simulation_nairobi_no_inter_estimate_long, state=="I" | state == "D")
#View(ID_9age_simulation_nairobi_no_inter_estimate_long)
line_plot_ID_9age_simulation_no_inter_nairobi<- ggplot(ID_9age_simulation_nairobi_no_inter_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Nairobi no intervention")

ggsave("line_plot_ID_9age_nairobi_no_intervention.pdf", width = 12, height = 10)




#simulate the cases


SEIHDQR_9age_simulation_nairobi_estimate <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)


#plots
SEIHDQR_9age_simulation_nairobi_estimate_long <- SEIHDQR_9age_simulation_nairobi_estimate %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_estimate_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_estimate_long <- cbind(SEIHDQR_9age_simulation_nairobi_estimate_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_estimate_long ,"SEIHDQR_9age_simulation_nairobi_estimate_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_estimate_long<-fread("SEIHDQR_9age_simulation_nairobi_estimate_long.csv")
SEIHDQR_9age_simulation_nairobi_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_estimate_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
ID_9age_simulation_nairobi_estimate_long<-subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="I" | state == "D")#
#ID_9age_simulation_nairobi_estimate_long2 <- subset(ID_9age_simulation_nairobi_estimate_long, time < as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nairobi <- ggplot(ID_9age_simulation_nairobi_estimate_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Nairobi policy intervention")

ggsave("line_plot_ID_9age_nairobi_policy_intervention.pdf", width = 12, height = 10)



#all policy-package one week earlier 

SEIHDQR_9age_simulation_nairobi_estimate_pearlier <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-12-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)


#plots
SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long <- SEIHDQR_9age_simulation_nairobi_estimate_pearlier %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long <- cbind(SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long ,"SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long.csv")
SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
ID_9age_simulation_nairobi_estimate_pearlier_long<-subset(SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long, state=="I" | state == "D")#

line_plot_ID_9age_simulation_nairobi_pearlier <- ggplot(ID_9age_simulation_nairobi_estimate_pearlier_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Nairobi policy intervention")

ggsave("line_plot_ID_9age_nairobi_policy_intervention_pearlier.pdf", width = 12, height = 10)

```


```{r The effects of intervention timing}

SEIHDQR_9age_simulation_nyc_estimate_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_pearlier_long.csv")
SEIHDQR_9age_simulation_la_estimate_long<-fread("SEIHDQR_9age_simulation_la_estimate_long.csv")
SEIHDQR_9age_simulation_la_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_la_estimate_pearlier_long.csv")
SEIHDQR_9age_simulation_daegu_estimate_long<-fread("SEIHDQR_9age_simulation_daegu_estimate_long.csv")
SEIHDQR_9age_simulation_daegu_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_daegu_estimate_pearlier_long.csv")
SEIHDQR_9age_simulation_nairobi_estimate_long<-fread("SEIHDQR_9age_simulation_nairobi_estimate_long.csv")
SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long<-fread("SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_long$city <- "New York"
SEIHDQR_9age_simulation_nyc_estimate_long$scenario <- "Policy"
SEIHDQR_9age_simulation_nyc_estimate_pearlier_long$city <- "New York"
SEIHDQR_9age_simulation_nyc_estimate_pearlier_long$scenario <- "Policy earlier"

SEIHDQR_9age_simulation_la_estimate_long$city <- "Los Angeles"
SEIHDQR_9age_simulation_la_estimate_long$scenario <- "Policy"
SEIHDQR_9age_simulation_la_estimate_pearlier_long$city <- "Los Angeles"
SEIHDQR_9age_simulation_la_estimate_pearlier_long$scenario <- "Policy earlier"

SEIHDQR_9age_simulation_daegu_estimate_long$city <- "Daegu"
SEIHDQR_9age_simulation_daegu_estimate_long$scenario <- "Policy"
SEIHDQR_9age_simulation_daegu_estimate_pearlier_long$city <- "Daegu"
SEIHDQR_9age_simulation_daegu_estimate_pearlier_long$scenario <- "Policy earlier"

SEIHDQR_9age_simulation_nairobi_estimate_long$city <- "Nairobi"
SEIHDQR_9age_simulation_nairobi_estimate_long$scenario <- "Policy"
SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long$city <- "Nairobi"
SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long$scenario <- "Policy earlier"

SEIHDQR_9age_simulation_nyc_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_long$time, origin = "2020-03-02")
SEIHDQR_9age_simulation_nyc_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_pearlier_long$time, origin = "2020-03-02")
SEIHDQR_9age_simulation_la_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_la_estimate_long$time, origin = "2020-01-26")
SEIHDQR_9age_simulation_la_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_la_estimate_pearlier_long$time, origin = "2020-01-26")

SEIHDQR_9age_simulation_daegu_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_estimate_long$time, origin = "2020-01-20")
SEIHDQR_9age_simulation_daegu_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_estimate_pearlier_long$time, origin = "2020-01-20")

SEIHDQR_9age_simulation_nairobi_estimate_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_estimate_long$time, origin = "2020-03-13")
SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long$time, origin = "2020-03-13")

SEIHDQR_estimate_fourcities_timing <- rbind(SEIHDQR_9age_simulation_nyc_estimate_long,SEIHDQR_9age_simulation_nyc_estimate_pearlier_long,SEIHDQR_9age_simulation_la_estimate_long,SEIHDQR_9age_simulation_la_estimate_pearlier_long,SEIHDQR_9age_simulation_daegu_estimate_long,SEIHDQR_9age_simulation_daegu_estimate_pearlier_long,SEIHDQR_9age_simulation_nairobi_estimate_long,SEIHDQR_9age_simulation_nairobi_estimate_pearlier_long)
SEIHDQR_estimate_fourcities_timing$SEIHDQR<-NULL
neworder_age<-c(1,2,3,4,5,6,7,8,9)
SEIHDQR_estimate_fourcities_timing$age_group<-factor(SEIHDQR_estimate_fourcities_timing$age_group, levels=neworder_age, labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))

I_estimate_fourcities_timing<-subset(SEIHDQR_estimate_fourcities_timing, state=="I")
D_estimate_fourcities_timing<-subset(SEIHDQR_estimate_fourcities_timing, state=="D")
#age specific effects
I_estimate_fourcities_timing_agg <- aggregate(estimate~age_group+city+scenario, FUN= sum, I_estimate_fourcities_timing,na.rm=T)

I_estimate_fourcities_timing_agg_p <- subset(I_estimate_fourcities_timing_agg, scenario=="Policy")

I_estimate_fourcities_timing_agg_pearlier <- subset(I_estimate_fourcities_timing_agg, scenario=="Policy earlier")
names(I_estimate_fourcities_timing_agg_pearlier) <- c("age_group", "city" "scenario_pealier", "estimate_pearlier")
I_estimate_fourcities_timing_agg_p_pearlier <-  merge(I_estimate_fourcities_timing_agg_p,I_estimate_fourcities_timing_agg_pearlier, by= c("age_group","city"))
I_estimate_fourcities_timing_agg_p_pearlier$effects <- (I_estimate_fourcities_timing_agg_p_pearlier$estimate_pearlier-I_estimate_fourcities_timing_agg_p_pearlier$estimate)/I_estimate_fourcities_timing_agg_p_pearlier$estimate
write.csv(I_estimate_fourcities_timing_agg_p_pearlier,"I_estimate_fourcities_timing_agg_p_pearlier.csv",row.names = F)

#city aggregate effects
I_estimate_fourcities_timing_cityagg <- aggregate(estimate ~ city+scenario, FUN= sum, I_estimate_fourcities_timing,na.rm=T)

I_estimate_fourcities_timing_cityagg_p <- subset(I_estimate_fourcities_timing_cityagg, scenario=="Policy")

I_estimate_fourcities_timing_cityagg_pearlier <- subset(I_estimate_fourcities_timing_cityagg, scenario=="Policy earlier")
names(I_estimate_fourcities_timing_cityagg_pearlier) <- c("city""scenario_pealier", "estimate_pearlier")
I_estimate_fourcities_timing_cityagg_p_pearlier <-  merge(I_estimate_fourcities_timing_cityagg_p,I_estimate_fourcities_timing_cityagg_pearlier, by= c("city"))
I_estimate_fourcities_timing_cityagg_p_pearlier$effects <- (I_estimate_fourcities_timing_cityagg_p_pearlier$estimate_pearlier-I_estimate_fourcities_timing_cityagg_p_pearlier$estimate)/I_estimate_fourcities_timing_cityagg_p_pearlier$estimate
write.csv(I_estimate_fourcities_timing_cityagg_p_pearlier,"I_estimate_fourcities_timing_cityagg_p_pearlier.csv",row.names = F)




lineplot_I_estimate_fourcities_timing<- ggplot(I_estimate_fourcities_timing)+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(x= time, y= estimate, color=as.factor(age_group), linetype = scenario, alpha=scenario), size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%Y-%m-%d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        strip.text = element_text(size = 20,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 20,face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=20, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=20, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=12, angle = 90),
        axis.text.y = element_text(size=18, angle = 0))+
  #xlab("Date")+ 
  ylab("Real-time infected cases per day")+
  facet_wrap(.~city, scales = "free")+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"), Scenario = guide_legend("Scenario"))+
  ggtitle("Earlier interventions in four cities")

ggsave("lineplot_I_estimate_fourcities_timing.pdf", width = 16, height = 14)




lineplot_D_estimate_fourcities_timing <- ggplot(D_estimate_fourcities_timing)+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(x= time, y= estimate, color=as.factor(age_group), linetype = scenario, alpha=scenario), size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 day", date_labels = "%Y-%m-%d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        strip.text = element_text(size = 20,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 20,face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=20, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=20, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=12, angle = 90),
        axis.text.y = element_text(size=18, angle = 0))+
  #xlab("Date")+ 
  ylab("Real-time dead cases per day")+
  facet_wrap(.~city, scales = "free")+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"), Scenario = guide_legend("Scenario"))+
  ggtitle("Earlier interventions in four cities")

ggsave("lineplot_D_estimate_fourcities_timing.pdf", width = 16, height = 14)

```



```{r effects of school closure/working home/other mobility/quarantine}


#contact matrix package
contact_matrix_9age_nyc <-readRDS("contact_matrix_9age_ny.rds")
contact_matrix_9age_la <-readRDS("contact_matrix_9age_la.rds")
contact_matrix_9age_daegu <-readRDS("contact_matrix_9age_daegu.rds")
contact_matrix_9age_nairobi <-readRDS("contact_matrix_9age_nairobi.rds")

#create block matrix
m1 <- matrix(1,nrow= 6, ncol=6)
m2 <- matrix(0.5, nrow=3, ncol=3)

#contact matrix policy package 1: school close
contact.matrix_package1_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work*0.5,contact_matrix_9age_nairobi$other)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work*0.2,contact_matrix_9age_nairobi$other)
#contact matrix policy package 4: 50% other
contact.matrix_package4_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other*0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other*0.2)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work*0.5,contact_matrix_9age_nairobi$other*0.5)
#contact matrix policy package 7: 
contact.matrix_10quanrantine_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other)
#reduce interaction between young and old


#contact matrix policy package 8: 
contact.matrix_nointer_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other)


#contact matrix for the nyc

#contact matrix policy package 1: school close
contact.matrix_package1_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school*0,contact_matrix_9age_nyc$work,contact_matrix_9age_nyc$other)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work*0.5,contact_matrix_9age_nyc$other)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work*0.2,contact_matrix_9age_nyc$other)
#contact matrix policy package 4: 50% other
contact.matrix_package4_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work,contact_matrix_9age_nyc$other*0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work,contact_matrix_9age_nyc$other*0.2)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school*0,contact_matrix_9age_nyc$work*0.5,contact_matrix_9age_nyc$other*0.5)
#contact matrix policy package 7: 
contact.matrix_10quanrantine_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work,contact_matrix_9age_nyc$other)
#contact matrix policy package 8: 
contact.matrix_nointer_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work,contact_matrix_9age_nyc$other)

#contact matrix for the la

#contact matrix policy package 1: school close
contact.matrix_package1_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work,contact_matrix_9age_la$other)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work*0.5,contact_matrix_9age_la$other)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work*0.2,contact_matrix_9age_la$other)
#contact matrix policy package 4: 50% other
contact.matrix_package4_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other*0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other*0.2)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.5,contact_matrix_9age_la$other*0.5)
#contact matrix policy package 7: 
contact.matrix_10quanrantine_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other)
#contact matrix policy package 8: 
contact.matrix_nointer_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other)

#contact matrix for the daegu

#contact matrix policy package 1: school close
contact.matrix_package1_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work*0.5,contact_matrix_9age_daegu$other)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work*0.2,contact_matrix_9age_daegu$other)
#contact matrix policy package 4: 50% other
contact.matrix_package4_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other*0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other*0.2)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work*0.5,contact_matrix_9age_daegu$other*0.5)
#contact matrix policy package 7: 
contact.matrix_10quanrantine_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other)
#contact matrix policy package 8: 
contact.matrix_nointer_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other)

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.



#transmissibility
transmissibility_9age_nairobi <- calculate_transimissibility(R0t = R0t_nairobi, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nairobi, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_nairobi)

transmissibility_9age_nyc <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nyc, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_nyc)

transmissibility_9age_la <- calculate_transimissibility(R0t = R0t_la, recov.rate = recov.rate, pop_age_structure = pop_age_structure_la, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_la)

transmissibility_9age_daegu <- calculate_transimissibility(R0t = R0t_daegu, recov.rate = recov.rate, pop_age_structure = pop_age_structure_daegu, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_daegu)


###transmission rate
transm.rate_without_intervention_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_nointer_nairobi)
saveRDS(transm.rate_without_intervention_nairobi,"transm.rate_without_intervention_nairobi_age_effect.rds")
transm.rate_package1_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package1_nairobi)
saveRDS(transm.rate_package1_nairobi,"transm.rate_package1_nairobi_age_effect.rds")
transm.rate_package2_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package2_nairobi)
saveRDS(transm.rate_package2_nairobi,"transm.rate_package2_nairobi_age_effect.rds")
transm.rate_package3_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package3_nairobi)
saveRDS(transm.rate_package3_nairobi,"transm.rate_package3_nairobi_age_effect.rds")
transm.rate_package4_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package4_nairobi)
saveRDS(transm.rate_package4_nairobi,"transm.rate_package4_nairobi_age_effect.rds")
transm.rate_package5_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package5_nairobi)
saveRDS(transm.rate_package5_nairobi,"transm.rate_package5_nairobi_age_effect.rds")
transm.rate_package6_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package6_nairobi)
saveRDS(transm.rate_package6_nairobi,"transm.rate_package6_nairobi_age_effect.rds")
transm.rate_quarantine10_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_nointer_nairobi)
saveRDS(transm.rate_quarantine10_nairobi,"transm.rate_quarantine10_nairobi_age_effect.rds")


###transmission rate
transm.rate_without_intervention_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_nointer_daegu)
saveRDS(transm.rate_without_intervention_daegu,"transm.rate_without_intervention_daegu_age_effect.rds")
transm.rate_package1_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package1_daegu)
saveRDS(transm.rate_package1_daegu,"transm.rate_package1_daegu_age_effect.rds")
transm.rate_package2_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package2_daegu)
saveRDS(transm.rate_package2_daegu,"transm.rate_package2_daegu_age_effect.rds")
transm.rate_package3_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package3_daegu)
saveRDS(transm.rate_package3_daegu,"transm.rate_package3_daegu_age_effect.rds")
transm.rate_package4_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package4_daegu)
saveRDS(transm.rate_package4_daegu,"transm.rate_package4_daegu_age_effect.rds")
transm.rate_package5_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package5_daegu)
saveRDS(transm.rate_package5_daegu,"transm.rate_package5_daegu_age_effect.rds")
transm.rate_package6_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package6_daegu)
saveRDS(transm.rate_package6_daegu,"transm.rate_package6_daegu_age_effect.rds")
transm.rate_quarantine10_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_nointer_daegu)
saveRDS(transm.rate_quarantine10_daegu,"transm.rate_quarantine10_daegu_age_effect.rds")


###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_nointer_nyc)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc_age_effect.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package1_nyc)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc_age_effect.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package2_nyc)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc_age_effect.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package3_nyc)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc_age_effect.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package4_nyc)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc_age_effect.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package5_nyc)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc_age_effect.rds")
transm.rate_package6_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package6_nyc)
saveRDS(transm.rate_package6_nyc,"transm.rate_package6_nyc_age_effect.rds")
transm.rate_quarantine10_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_nointer_nyc)
saveRDS(transm.rate_quarantine10_nyc,"transm.rate_quarantine10_nyc_age_effect.rds")




###transmission rate
transm.rate_without_intervention_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_nointer_la)
saveRDS(transm.rate_without_intervention_la,"transm.rate_without_intervention_la_age_effect.rds")
transm.rate_package1_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package1_la)
saveRDS(transm.rate_package1_la,"transm.rate_package1_la_age_effect.rds")
transm.rate_package2_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package2_la)
saveRDS(transm.rate_package2_la,"transm.rate_package2_la_age_effect.rds")
transm.rate_package3_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package3_la)
saveRDS(transm.rate_package3_la,"transm.rate_package3_la_age_effect.rds")
transm.rate_package4_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package4_la)
saveRDS(transm.rate_package4_la,"transm.rate_package4_la_age_effect.rds")
transm.rate_package5_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package5_la)
saveRDS(transm.rate_package5_la,"transm.rate_package5_la_age_effect.rds")
transm.rate_package6_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package6_la)
saveRDS(transm.rate_package6_la,"transm.rate_package6_la_age_effect.rds")
transm.rate_quarantine10_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_nointer_la)
saveRDS(transm.rate_quarantine10_la,"transm.rate_quarantine10_la_age_effect.rds")

write.csv(transm.rate_without_intervention_nairobi,"transm.rate_without_intervention_nairobi.csv",row.names = F)
write.csv(transm.rate_without_intervention_daegu,"transm.rate_without_intervention_daegu.csv",row.names = F)
write.csv(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc.csv",row.names = F)
write.csv(transm.rate_without_intervention_la,"transm.rate_without_intervention_la.csv",row.names = F)

birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")




#para 9
hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis


tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)
#para 11
quar.rate_nairobi =c(rep(0.0001,9))
quar.rate_daegu =c(rep(0.0001,9))
quar.rate_nyc =c(rep(0.0001,9))
quar.rate_la =c(rep(0.0001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06


#without intervention
parameters_nairobi_age_effect <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)
saveRDS(parameters_nairobi_age_effect,"parameters_nairobi_age_effect.rds")

#without intervention
parameters_daegu_age_effect <- list(i.import=daegu_int_travel_import_data*tourism_age_structure,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu,
                       i.export=daegu_int_travel_export_data*tourism_age_structure,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)
saveRDS(parameters_daegu_age_effect,"parameters_daegu_age_effect.rds")

#without intervention
parameters_nyc_age_effect <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


saveRDS(parameters_nyc_age_effect,"parameters_nyc_age_effect.rds")


#without intervention
parameters_la_age_effect <- list(i.import=la_int_travel_import_data*tourism_age_structure,
                       d.import=la_dom_travel_import_data*pop_age_structure_la,
                       i.export=la_int_travel_export_data*tourism_age_structure,
                       d.export=la_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.1)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)
saveRDS(parameters_la_age_effect,"parameters_la_age_effect.rds")


#No intervention
constraint_no_intervention_nairobi<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nairobi,"constraint_no_intervention_nairobi.rds")



constraint_no_intervention_daegu<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_daegu,"constraint_no_intervention_daegu.rds")


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

constraint_no_intervention_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_la,"constraint_no_intervention_la.rds")



#intervention constraint package1
constraint_package1_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package1_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_nairobi,"constraint_package1_nairobi.rds")


constraint_package1_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package1_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_daegu,"constraint_package1_daegu.rds")

constraint_package1_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package1_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")

constraint_package1_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = transm.rate_package1_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_la,"constraint_package1_la.rds")



#intervention constraint package2

constraint_package2_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package2_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_nairobi,"constraint_package2_nairobi.rds")



constraint_package2_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package2_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_daegu,"constraint_package2_daegu.rds")

constraint_package2_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

constraint_package2_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package2_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_la,"constraint_package2_la.rds")




#intervention constraint package3

constraint_package3_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package3_nairobi/transm.rate_without_intervention_nairobi,
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_nairobi,"constraint_package3_nairobi.rds")


constraint_package3_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package3_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_daegu,"constraint_package3_daegu.rds")

constraint_package3_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

constraint_package3_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_la,"constraint_package3_la.rds")





#intervention constraint package4

constraint_package4_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package4_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_nairobi,"constraint_package4_nairobi.rds")


constraint_package4_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package4_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_daegu,"constraint_package4_daegu.rds")

constraint_package4_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

constraint_package4_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package4_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_la,"constraint_package4_la.rds")


#intervention constraint package5

constraint_package5_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package5_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_nairobi,"constraint_package5_nairobi.rds")


constraint_package5_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package5_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_daegu,"constraint_package5_daegu.rds")

constraint_package5_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")

constraint_package5_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package5_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_la,"constraint_package5_la.rds")


#intervention constraint package6

constraint_package6_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package6_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_nairobi,"constraint_package6_nairobi.rds")


constraint_package6_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package6_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_daegu,"constraint_package6_daegu.rds")

constraint_package6_nyc <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package6_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")

constraint_package6_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package6_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_la,"constraint_package6_la.rds")


#intervention constraint quarantine10

constraint_quarantine10_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_quarantine10_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_nairobi,"constraint_quarantine10_nairobi.rds")


constraint_quarantine10_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_quarantine10_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_daegu,"constraint_quarantine10_daegu.rds")

constraint_quarantine10_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_quarantine10_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_nyc,"constraint_quarantine10_nyc.rds")

constraint_quarantine10_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_quarantine10_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_la,"constraint_quarantine10_la.rds")


#intervention constraint city borderclosure

constraint_inter_borderclosure_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_nairobi,"constraint_inter_borderclosure_nairobi.rds")


constraint_inter_borderclosure_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_daegu,"constraint_inter_borderclosure_daegu.rds")

constraint_inter_borderclosure_nyc <- list(i.import = c(rep(0,9)),
                                     d.import = c(rep(1,9)),
                                     i.export = c(rep(0,9)),
                                     d.export = c(rep(1,9)),
                                     i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_nyc,"constraint_inter_borderclosure_nyc.rds")

constraint_inter_borderclosure_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_la,"constraint_inter_borderclosure_la.rds")



#intervention constraint city lockdown

constraint_city_lockdown_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_nairobi,"constraint_city_lockdown_nairobi.rds")


constraint_city_lockdown_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_daegu,"constraint_city_lockdown_daegu.rds")

constraint_city_lockdown_nyc <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                     i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_nyc,"constraint_city_lockdown_nyc.rds")

constraint_city_lockdown_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_la,"constraint_city_lockdown_la.rds")




Enyc. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
Inyc. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- Enyc. - Inyc.,
                  E. = Inyc./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")


Ela. = pop_la*pop_age_structure_la*2e-06/incub.rate
Ila. = pop_la*pop_age_structure_la*2e-06
initials_la <- c(S. = pop_la*pop_age_structure_la- Ela. - Ila.,
                  E. = Ila./incub.rate,
                  I. = pop_la*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_la*pop_age_structure_la*2e-06)
saveRDS(initials_la,"initials_la.rds")


Edaegu. = pop_daegu*pop_age_structure_daegu*2e-06/incub.rate
Idaegu. = pop_daegu*pop_age_structure_daegu*2e-06
initials_daegu <- c(S. = pop_daegu*pop_age_structure_daegu- Edaegu. - Idaegu.,
                  E. = Idaegu./incub.rate,
                  I. = pop_daegu*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_daegu*pop_age_structure_daegu*2e-06)
saveRDS(initials_daegu,"initials_daegu.rds")

Enairobi. = pop_nairobi*pop_age_structure_nairobi*2e-06/incub.rate
Inairobi. = pop_nairobi*pop_age_structure_nairobi*2e-06
initials_nairobi <- c(S. = pop_nairobi*pop_age_structure_nairobi- Enairobi. - Inairobi.,
                  E. = Inairobi./incub.rate,
                  I. = pop_nairobi*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nairobi*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nairobi,"initials_nairobi.rds")


library(deSolve)
#no intervention

SEIHDQR_9age_simulation_nyc_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package1_nyc, constraint3 = constraint_package1_nyc, constraint4 = constraint_package1_nyc, constraint5 = constraint_package1_nyc, constraint6 = constraint_package1_nyc)

SEIHDQR_9age_simulation_nyc_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package2_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package2_nyc, constraint4 = constraint_package2_nyc, constraint5 = constraint_package2_nyc, constraint6 = constraint_package2_nyc)

SEIHDQR_9age_simulation_nyc_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package3_nyc, constraint2 = constraint_package3_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package3_nyc, constraint5 = constraint_package3_nyc, constraint6 = constraint_package3_nyc)

SEIHDQR_9age_simulation_nyc_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package4_nyc, constraint2 = constraint_package4_nyc, constraint3 = constraint_package4_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package4_nyc, constraint6 = constraint_package4_nyc)

SEIHDQR_9age_simulation_nyc_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package5_nyc, constraint2 = constraint_package5_nyc, constraint3 = constraint_package5_nyc, constraint4 = constraint_package5_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package5_nyc)

SEIHDQR_9age_simulation_nyc_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_quarantine10_nyc, constraint2 = constraint_quarantine10_nyc, constraint3 = constraint_quarantine10_nyc, constraint4 = constraint_quarantine10_nyc, constraint5 = constraint_quarantine10_nyc, constraint6 = constraint_quarantine10_nyc)


#SEIHDQR_9age_simulation_nyc_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_inter_borderclosure_nyc, constraint2 = constraint_inter_borderclosure_nyc, constraint3 = constraint_inter_borderclosure_nyc, constraint4 = constraint_inter_borderclosure_nyc, constraint5 = constraint_inter_borderclosure_nyc, constraint6 = constraint_inter_borderclosure_nyc)

SEIHDQR_9age_simulation_nyc_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_city_lockdown_nyc, constraint2 = constraint_city_lockdown_nyc, constraint3 = constraint_city_lockdown_nyc, constraint4 = constraint_city_lockdown_nyc, constraint5 = constraint_city_lockdown_nyc, constraint6 = constraint_city_lockdown_nyc)

SEIHDQR_9age_simulation_nyc_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package6_nyc, constraint2 = constraint_package6_nyc, constraint3 = constraint_package6_nyc, constraint4 = constraint_package6_nyc, constraint5 = constraint_package6_nyc, constraint6 = constraint_package6_nyc)

SEIHDQR_9age_simulation_nyc_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_no_intervention_nyc, constraint2 = constraint_no_intervention_nyc, constraint3 = constraint_no_intervention_nyc, constraint4 = constraint_no_intervention_nyc, constraint5 = constraint_no_intervention_nyc, constraint6 = constraint_no_intervention_nyc)

write.csv(SEIHDQR_9age_simulation_nyc_schoolclose,"SEIHDQR_9age_simulation_nyc_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_50work,"SEIHDQR_9age_simulation_nyc_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_80work,"SEIHDQR_9age_simulation_nyc_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_50other,"SEIHDQR_9age_simulation_nyc_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_20other,"SEIHDQR_9age_simulation_nyc_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_10quarantine,"SEIHDQR_9age_simulation_nyc_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_nyc_inter_borderclosure,"SEIHDQR_9age_simulation_nyc_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_city_lockdown,"SEIHDQR_9age_simulation_nyc_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_combined,"SEIHDQR_9age_simulation_nyc_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_nointer,"SEIHDQR_9age_simulation_nyc_nointer.csv",row.names = F)


SEIHDQR_9age_simulation_la_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package1_la, constraint3 = constraint_package1_la, constraint4 = constraint_package1_la, constraint5 = constraint_package1_la, constraint6 = constraint_package1_la)

SEIHDQR_9age_simulation_la_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package2_la, constraint2 = constraint_package2_la, constraint3 = constraint_package2_la, constraint4 = constraint_package2_la, constraint5 = constraint_package2_la, constraint6 = constraint_package2_la)

SEIHDQR_9age_simulation_la_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package3_la, constraint2 = constraint_package3_la, constraint3 = constraint_package3_la, constraint4 = constraint_package3_la, constraint5 = constraint_package3_la, constraint6 = constraint_package3_la)

SEIHDQR_9age_simulation_la_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package4_la, constraint2 = constraint_package4_la, constraint3 = constraint_package4_la, constraint4 = constraint_package4_la, constraint5 = constraint_package4_la, constraint6 = constraint_package4_la)

SEIHDQR_9age_simulation_la_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package5_la, constraint2 = constraint_package5_la, constraint3 = constraint_package5_la, constraint4 = constraint_package5_la, constraint5 = constraint_package5_la, constraint6 = constraint_package5_la)

SEIHDQR_9age_simulation_la_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_quarantine10_la, constraint2 = constraint_quarantine10_la, constraint3 = constraint_quarantine10_la, constraint4 = constraint_quarantine10_la, constraint5 = constraint_quarantine10_la, constraint6 = constraint_quarantine10_la)


#SEIHDQR_9age_simulation_la_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_inter_borderclosure_la, constraint2 = constraint_inter_borderclosure_la, constraint3 = constraint_inter_borderclosure_la, constraint4 = constraint_inter_borderclosure_la, constraint5 = constraint_inter_borderclosure_la, constraint6 = constraint_inter_borderclosure_la)

SEIHDQR_9age_simulation_la_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_city_lockdown_la, constraint2 = constraint_city_lockdown_la, constraint3 = constraint_city_lockdown_la, constraint4 = constraint_city_lockdown_la, constraint5 = constraint_city_lockdown_la, constraint6 = constraint_city_lockdown_la)

SEIHDQR_9age_simulation_la_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package6_la, constraint2 = constraint_package6_la, constraint3 = constraint_package6_la, constraint4 = constraint_package6_la, constraint5 = constraint_package6_la, constraint6 = constraint_package6_la)

SEIHDQR_9age_simulation_la_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_no_intervention_la, constraint2 = constraint_no_intervention_la, constraint3 = constraint_no_intervention_la, constraint4 = constraint_no_intervention_la, constraint5 = constraint_no_intervention_la, constraint6 = constraint_no_intervention_la)

write.csv(SEIHDQR_9age_simulation_la_schoolclose,"SEIHDQR_9age_simulation_la_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_50work,"SEIHDQR_9age_simulation_la_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_80work,"SEIHDQR_9age_simulation_la_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_50other,"SEIHDQR_9age_simulation_la_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_20other,"SEIHDQR_9age_simulation_la_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_10quarantine,"SEIHDQR_9age_simulation_la_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_la_inter_borderclosure,"SEIHDQR_9age_simulation_la_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_city_lockdown,"SEIHDQR_9age_simulation_la_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_combined,"SEIHDQR_9age_simulation_la_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_nointer,"SEIHDQR_9age_simulation_la_nointer.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package1_daegu, constraint3 = constraint_package1_daegu, constraint4 = constraint_package1_daegu, constraint5 = constraint_package1_daegu, constraint6 = constraint_package1_daegu)

SEIHDQR_9age_simulation_daegu_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package2_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package2_daegu, constraint4 = constraint_package2_daegu, constraint5 = constraint_package2_daegu, constraint6 = constraint_package2_daegu)

SEIHDQR_9age_simulation_daegu_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package3_daegu, constraint2 = constraint_package3_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package3_daegu, constraint5 = constraint_package3_daegu, constraint6 = constraint_package3_daegu)

SEIHDQR_9age_simulation_daegu_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package4_daegu, constraint2 = constraint_package4_daegu, constraint3 = constraint_package4_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package4_daegu, constraint6 = constraint_package4_daegu)

SEIHDQR_9age_simulation_daegu_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package5_daegu, constraint2 = constraint_package5_daegu, constraint3 = constraint_package5_daegu, constraint4 = constraint_package5_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package5_daegu)

SEIHDQR_9age_simulation_daegu_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_quarantine10_daegu, constraint2 = constraint_quarantine10_daegu, constraint3 = constraint_quarantine10_daegu, constraint4 = constraint_quarantine10_daegu, constraint5 = constraint_quarantine10_daegu, constraint6 = constraint_quarantine10_daegu)


#SEIHDQR_9age_simulation_daegu_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_inter_borderclosure_daegu, constraint2 = constraint_inter_borderclosure_daegu, constraint3 = constraint_inter_borderclosure_daegu, constraint4 = constraint_inter_borderclosure_daegu, constraint5 = constraint_inter_borderclosure_daegu, constraint6 = constraint_inter_borderclosure_daegu)

SEIHDQR_9age_simulation_daegu_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_city_lockdown_daegu, constraint2 = constraint_city_lockdown_daegu, constraint3 = constraint_city_lockdown_daegu, constraint4 = constraint_city_lockdown_daegu, constraint5 = constraint_city_lockdown_daegu, constraint6 = constraint_city_lockdown_daegu)

SEIHDQR_9age_simulation_daegu_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2020-12-19"), constraint1 = constraint_package6_daegu, constraint2 = constraint_package6_daegu, constraint3 = constraint_package6_daegu, constraint4 = constraint_package6_daegu, constraint5 = constraint_package6_daegu, constraint6 = constraint_package6_daegu)

SEIHDQR_9age_simulation_daegu_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_no_intervention_daegu, constraint2 = constraint_no_intervention_daegu, constraint3 = constraint_no_intervention_daegu, constraint4 = constraint_no_intervention_daegu, constraint5 = constraint_no_intervention_daegu, constraint6 = constraint_no_intervention_daegu)

write.csv(SEIHDQR_9age_simulation_daegu_schoolclose,"SEIHDQR_9age_simulation_daegu_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_50work,"SEIHDQR_9age_simulation_daegu_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_80work,"SEIHDQR_9age_simulation_daegu_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_50other,"SEIHDQR_9age_simulation_daegu_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_20other,"SEIHDQR_9age_simulation_daegu_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_10quarantine,"SEIHDQR_9age_simulation_daegu_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_daegu_inter_borderclosure,"SEIHDQR_9age_simulation_daegu_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_city_lockdown,"SEIHDQR_9age_simulation_daegu_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_combined,"SEIHDQR_9age_simulation_daegu_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_nointer,"SEIHDQR_9age_simulation_daegu_nointer.csv",row.names = F)

SEIHDQR_9age_simulation_nairobi_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package1_nairobi, constraint2 = constraint_package1_nairobi, constraint3 = constraint_package1_nairobi, constraint4 = constraint_package1_nairobi, constraint5 = constraint_package1_nairobi, constraint6 = constraint_package1_nairobi)

SEIHDQR_9age_simulation_nairobi_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package2_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package2_nairobi, constraint4 = constraint_package2_nairobi, constraint5 = constraint_package2_nairobi, constraint6 = constraint_package2_nairobi)

SEIHDQR_9age_simulation_nairobi_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package3_nairobi, constraint2 = constraint_package3_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package3_nairobi, constraint5 = constraint_package3_nairobi, constraint6 = constraint_package3_nairobi)

SEIHDQR_9age_simulation_nairobi_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package4_nairobi, constraint2 = constraint_package4_nairobi, constraint3 = constraint_package4_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package4_nairobi, constraint6 = constraint_package4_nairobi)

SEIHDQR_9age_simulation_nairobi_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package5_nairobi, constraint2 = constraint_package5_nairobi, constraint3 = constraint_package5_nairobi, constraint4 = constraint_package5_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package5_nairobi)

SEIHDQR_9age_simulation_nairobi_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_quarantine10_nairobi, constraint2 = constraint_quarantine10_nairobi, constraint3 = constraint_quarantine10_nairobi, constraint4 = constraint_quarantine10_nairobi, constraint5 = constraint_quarantine10_nairobi, constraint6 = constraint_quarantine10_nairobi)


#SEIHDQR_9age_simulation_nairobi_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_inter_borderclosure_nairobi, constraint2 = constraint_inter_borderclosure_nairobi, constraint3 = constraint_inter_borderclosure_nairobi, constraint4 = constraint_inter_borderclosure_nairobi, constraint5 = constraint_inter_borderclosure_nairobi, constraint6 = constraint_inter_borderclosure_nairobi)

SEIHDQR_9age_simulation_nairobi_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_city_lockdown_nairobi, constraint2 = constraint_city_lockdown_nairobi, constraint3 = constraint_city_lockdown_nairobi, constraint4 = constraint_city_lockdown_nairobi, constraint5 = constraint_city_lockdown_nairobi, constraint6 = constraint_city_lockdown_nairobi)

SEIHDQR_9age_simulation_nairobi_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package6_nairobi, constraint2 = constraint_package6_nairobi, constraint3 = constraint_package6_nairobi, constraint4 = constraint_package6_nairobi, constraint5 = constraint_package6_nairobi, constraint6 = constraint_package6_nairobi)

SEIHDQR_9age_simulation_nairobi_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_no_intervention_nairobi, constraint2 = constraint_no_intervention_nairobi, constraint3 = constraint_no_intervention_nairobi, constraint4 = constraint_no_intervention_nairobi, constraint5 = constraint_no_intervention_nairobi, constraint6 = constraint_no_intervention_nairobi)


write.csv(SEIHDQR_9age_simulation_nairobi_schoolclose,"SEIHDQR_9age_simulation_nairobi_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_50work,"SEIHDQR_9age_simulation_nairobi_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_80work,"SEIHDQR_9age_simulation_nairobi_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_50other,"SEIHDQR_9age_simulation_nairobi_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_20other,"SEIHDQR_9age_simulation_nairobi_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_10quarantine,"SEIHDQR_9age_simulation_nairobi_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_nairobi_inter_borderclosure,"SEIHDQR_9age_simulation_nairobi_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_city_lockdown,"SEIHDQR_9age_simulation_nairobi_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_combined,"SEIHDQR_9age_simulation_nairobi_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_nointer,"SEIHDQR_9age_simulation_nairobi_nointer.csv",row.names = F)



```



```{r plots for policy effects}
SEIHDQR_9age_simulation_nyc_schoolclose<-fread("SEIHDQR_9age_simulation_nyc_schoolclose.csv")
SEIHDQR_9age_simulation_nyc_50work<-fread("SEIHDQR_9age_simulation_nyc_50work.csv")
SEIHDQR_9age_simulation_nyc_80work<-fread("SEIHDQR_9age_simulation_nyc_80work.csv")
SEIHDQR_9age_simulation_nyc_50other<-fread("SEIHDQR_9age_simulation_nyc_50other.csv")
SEIHDQR_9age_simulation_nyc_20other<-fread("SEIHDQR_9age_simulation_nyc_20other.csv")
SEIHDQR_9age_simulation_nyc_10quarantine<-fread("SEIHDQR_9age_simulation_nyc_10quarantine.csv")
#SEIHDQR_9age_simulation_nyc_inter_borderclosure<-fread("SEIHDQR_9age_simulation_nyc_inter_borderclosure.csv")
SEIHDQR_9age_simulation_nyc_city_lockdown<-fread("SEIHDQR_9age_simulation_nyc_city_lockdown.csv")
SEIHDQR_9age_simulation_nyc_combined<-fread("SEIHDQR_9age_simulation_nyc_combined.csv")
SEIHDQR_9age_simulation_nyc_nointer<-fread("SEIHDQR_9age_simulation_nyc_nointer.csv")

#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_nyc_schoolclose_long <- SEIHDQR_9age_simulation_nyc_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_schoolclose_long <- cbind(SEIHDQR_9age_simulation_nyc_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_schoolclose_long,"SEIHDQR_9age_simulation_nyc_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_schoolclose_long<-fread("SEIHDQR_9age_simulation_nyc_schoolclose_long.csv")
#SEIHDQR_9age_simulation_nyc_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_nyc_schoolclose_long<-subset(SEIHDQR_9age_simulation_nyc_schoolclose_long, state=="I")#
Infected_9age_simulation_nyc_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_nyc_schoolclose_long,"Infected_9age_simulation_nyc_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_nyc_50work_long <- SEIHDQR_9age_simulation_nyc_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_50work_long <- cbind(SEIHDQR_9age_simulation_nyc_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_50work_long,"SEIHDQR_9age_simulation_nyc_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_50work_long<-fread("SEIHDQR_9age_simulation_nyc_50work_long.csv")

Infected_9age_simulation_nyc_50work_long<-subset(SEIHDQR_9age_simulation_nyc_50work_long, state=="I")#
Infected_9age_simulation_nyc_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_nyc_50work_long,"Infected_9age_simulation_nyc_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_nyc_80work_long <- SEIHDQR_9age_simulation_nyc_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_80work_long <- cbind(SEIHDQR_9age_simulation_nyc_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_80work_long,"SEIHDQR_9age_simulation_nyc_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_80work_long<-fread("SEIHDQR_9age_simulation_nyc_80work_long.csv")

Infected_9age_simulation_nyc_80work_long<-subset(SEIHDQR_9age_simulation_nyc_80work_long, state=="I")#
Infected_9age_simulation_nyc_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_nyc_80work_long,"Infected_9age_simulation_nyc_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_nyc_50other_long <- SEIHDQR_9age_simulation_nyc_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_50other_long <- cbind(SEIHDQR_9age_simulation_nyc_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_50other_long,"SEIHDQR_9age_simulation_nyc_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_50other_long<-fread("SEIHDQR_9age_simulation_nyc_50other_long.csv")

Infected_9age_simulation_nyc_50other_long<-subset(SEIHDQR_9age_simulation_nyc_50other_long, state=="I")#
Infected_9age_simulation_nyc_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_nyc_50other_long,"Infected_9age_simulation_nyc_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_nyc_20other_long <- SEIHDQR_9age_simulation_nyc_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_20other_long <- cbind(SEIHDQR_9age_simulation_nyc_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_20other_long,"SEIHDQR_9age_simulation_nyc_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_20other_long<-fread("SEIHDQR_9age_simulation_nyc_20other_long.csv")

Infected_9age_simulation_nyc_20other_long<-subset(SEIHDQR_9age_simulation_nyc_20other_long, state=="I")#
Infected_9age_simulation_nyc_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_nyc_20other_long,"Infected_9age_simulation_nyc_20other_long.csv",row.names = F)

#10quarantine plots
SEIHDQR_9age_simulation_nyc_10quarantine_long <- SEIHDQR_9age_simulation_nyc_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_10quarantine_long <- cbind(SEIHDQR_9age_simulation_nyc_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_10quarantine_long,"SEIHDQR_9age_simulation_nyc_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_10quarantine_long<-fread("SEIHDQR_9age_simulation_nyc_10quarantine_long.csv")

Infected_9age_simulation_nyc_10quarantine_long<-subset(SEIHDQR_9age_simulation_nyc_10quarantine_long, state=="I")#
Infected_9age_simulation_nyc_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_nyc_10quarantine_long,"Infected_9age_simulation_nyc_10quarantine_long.csv",row.names = F)

#borderclosure plots
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long <- SEIHDQR_9age_simulation_nyc_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long,"SEIHDQR_9age_simulation_nyc_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_nyc_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_nyc_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_nyc_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_nyc_inter_borderclosure_long,"Infected_9age_simulation_nyc_inter_borderclosure_long.csv",row.names = F)
# 
# #city lockdown plots
# SEIHDQR_9age_simulation_nyc_city_lockdown_long <- SEIHDQR_9age_simulation_nyc_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_city_lockdown_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_nyc_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_nyc_city_lockdown_long, state_age)
# write.csv(SEIHDQR_9age_simulation_nyc_city_lockdown_long,"SEIHDQR_9age_simulation_nyc_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_city_lockdown_long<-fread("SEIHDQR_9age_simulation_nyc_city_lockdown_long.csv")

Infected_9age_simulation_nyc_city_lockdown_long<-subset(SEIHDQR_9age_simulation_nyc_city_lockdown_long, state=="I")#
Infected_9age_simulation_nyc_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_nyc_city_lockdown_long,"Infected_9age_simulation_nyc_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_nyc_combined_long <- SEIHDQR_9age_simulation_nyc_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_combined_long <- cbind(SEIHDQR_9age_simulation_nyc_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_combined_long,"SEIHDQR_9age_simulation_nyc_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_combined_long<-fread("SEIHDQR_9age_simulation_nyc_combined_long.csv")
Infected_9age_simulation_nyc_combined_long<-subset(SEIHDQR_9age_simulation_nyc_combined_long, state=="I")#
Infected_9age_simulation_nyc_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_nyc_combined_long,"Infected_9age_simulation_nyc_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_nyc_nointer_long <- SEIHDQR_9age_simulation_nyc_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_nointer_long <- cbind(SEIHDQR_9age_simulation_nyc_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_nointer_long,"SEIHDQR_9age_simulation_nyc_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_nyc_nointer_long<-fread("SEIHDQR_9age_simulation_nyc_nointer_long.csv")
Infected_9age_simulation_nyc_nointer_long<-subset(SEIHDQR_9age_simulation_nyc_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_nyc_nointer_long,"Infected_9age_simulation_nyc_nointer_long.csv",row.names = F)


infected_9age_estimate_nyc_scenarios <- rbind(Infected_9age_simulation_nyc_schoolclose_long, Infected_9age_simulation_nyc_50work_long, Infected_9age_simulation_nyc_80work_long, Infected_9age_simulation_nyc_50other_long, Infected_9age_simulation_nyc_20other_long, Infected_9age_simulation_nyc_10quarantine_long,Infected_9age_simulation_nyc_city_lockdown_long, Infected_9age_simulation_nyc_combined_long)# Infected_9age_simulation_nyc_inter_borderclosure_long,

infected_9age_estimate_nyc_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_nyc_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_nyc_nointer_long$period <- NULL
Infected_9age_simulation_nyc_nointer_long$state<- NULL
names(Infected_9age_simulation_nyc_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_nyc_scenarios_nointer <- merge(infected_9age_estimate_nyc_scenarios, Infected_9age_simulation_nyc_nointer_long, by = c("time","age_group"))
infected_9age_estimate_nyc_scenarios_nointer$state <- NULL
infected_9age_estimate_nyc_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_nyc_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_nyc_scenarios_nointer_agg$policy)
infected_9age_estimate_nyc_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_nyc_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_nyc_scenarios_nointer_agg$estimate)/infected_9age_estimate_nyc_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_nyc_scenarios_nointer_agg,"infected_9age_estimate_nyc_scenarios_nointer_agg.csv",row.names = F)



SEIHDQR_9age_simulation_la_schoolclose<-fread("SEIHDQR_9age_simulation_la_schoolclose.csv")
SEIHDQR_9age_simulation_la_50work<-fread("SEIHDQR_9age_simulation_la_50work.csv")
SEIHDQR_9age_simulation_la_80work<-fread("SEIHDQR_9age_simulation_la_80work.csv")
SEIHDQR_9age_simulation_la_50other<-fread("SEIHDQR_9age_simulation_la_50other.csv")
SEIHDQR_9age_simulation_la_20other<-fread("SEIHDQR_9age_simulation_la_20other.csv")
SEIHDQR_9age_simulation_la_10quarantine<-fread("SEIHDQR_9age_simulation_la_10quarantine.csv")
#SEIHDQR_9age_simulation_la_inter_borderclosure<-fread("SEIHDQR_9age_simulation_la_inter_borderclosure.csv")
SEIHDQR_9age_simulation_la_city_lockdown<-fread("SEIHDQR_9age_simulation_la_city_lockdown.csv")
SEIHDQR_9age_simulation_la_combined<-fread("SEIHDQR_9age_simulation_la_combined.csv")
SEIHDQR_9age_simulation_la_nointer <- fread("SEIHDQR_9age_simulation_la_nointer.csv")

#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_la_schoolclose_long <- SEIHDQR_9age_simulation_la_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_schoolclose_long <- cbind(SEIHDQR_9age_simulation_la_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_schoolclose_long,"SEIHDQR_9age_simulation_la_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_schoolclose_long<-fread("SEIHDQR_9age_simulation_la_schoolclose_long.csv")
#SEIHDQR_9age_simulation_la_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_la_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_la_schoolclose_long<-subset(SEIHDQR_9age_simulation_la_schoolclose_long, state=="I")#
Infected_9age_simulation_la_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_la_schoolclose_long,"Infected_9age_simulation_la_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_la_50work_long <- SEIHDQR_9age_simulation_la_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_50work_long <- cbind(SEIHDQR_9age_simulation_la_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_50work_long,"SEIHDQR_9age_simulation_la_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_50work_long<-fread("SEIHDQR_9age_simulation_la_50work_long.csv")

Infected_9age_simulation_la_50work_long<-subset(SEIHDQR_9age_simulation_la_50work_long, state=="I")#
Infected_9age_simulation_la_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_la_50work_long,"Infected_9age_simulation_la_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_la_80work_long <- SEIHDQR_9age_simulation_la_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_80work_long <- cbind(SEIHDQR_9age_simulation_la_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_80work_long,"SEIHDQR_9age_simulation_la_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_80work_long<-fread("SEIHDQR_9age_simulation_la_80work_long.csv")

Infected_9age_simulation_la_80work_long<-subset(SEIHDQR_9age_simulation_la_80work_long, state=="I")#
Infected_9age_simulation_la_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_la_80work_long,"Infected_9age_simulation_la_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_la_50other_long <- SEIHDQR_9age_simulation_la_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_50other_long <- cbind(SEIHDQR_9age_simulation_la_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_50other_long,"SEIHDQR_9age_simulation_la_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_50other_long<-fread("SEIHDQR_9age_simulation_la_50other_long.csv")

Infected_9age_simulation_la_50other_long<-subset(SEIHDQR_9age_simulation_la_50other_long, state=="I")#
Infected_9age_simulation_la_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_la_50other_long,"Infected_9age_simulation_la_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_la_20other_long <- SEIHDQR_9age_simulation_la_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_20other_long <- cbind(SEIHDQR_9age_simulation_la_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_20other_long,"SEIHDQR_9age_simulation_la_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_20other_long<-fread("SEIHDQR_9age_simulation_la_20other_long.csv")

Infected_9age_simulation_la_20other_long<-subset(SEIHDQR_9age_simulation_la_20other_long, state=="I")#
Infected_9age_simulation_la_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_la_20other_long,"Infected_9age_simulation_la_20other_long.csv",row.names = F)


#10 quarantine plots
SEIHDQR_9age_simulation_la_10quarantine_long <- SEIHDQR_9age_simulation_la_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_10quarantine_long <- cbind(SEIHDQR_9age_simulation_la_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_10quarantine_long,"SEIHDQR_9age_simulation_la_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_10quarantine_long<-fread("SEIHDQR_9age_simulation_la_10quarantine_long.csv")

Infected_9age_simulation_la_10quarantine_long<-subset(SEIHDQR_9age_simulation_la_10quarantine_long, state=="I")#
Infected_9age_simulation_la_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_la_10quarantine_long,"Infected_9age_simulation_la_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_la_inter_borderclosure_long <- SEIHDQR_9age_simulation_la_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_la_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_la_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_la_inter_borderclosure_long,"SEIHDQR_9age_simulation_la_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_la_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_la_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_la_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_la_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_la_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_la_inter_borderclosure_long,"Infected_9age_simulation_la_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_la_city_lockdown_long <- SEIHDQR_9age_simulation_la_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_la_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_city_lockdown_long,"SEIHDQR_9age_simulation_la_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_city_lockdown_long<-fread("SEIHDQR_9age_simulation_la_city_lockdown_long.csv")

Infected_9age_simulation_la_city_lockdown_long<-subset(SEIHDQR_9age_simulation_la_city_lockdown_long, state=="I")#
Infected_9age_simulation_la_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_la_city_lockdown_long,"Infected_9age_simulation_la_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_la_combined_long <- SEIHDQR_9age_simulation_la_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_combined_long <- cbind(SEIHDQR_9age_simulation_la_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_combined_long,"SEIHDQR_9age_simulation_la_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_combined_long<-fread("SEIHDQR_9age_simulation_la_combined_long.csv")
Infected_9age_simulation_la_combined_long<-subset(SEIHDQR_9age_simulation_la_combined_long, state=="I")#
Infected_9age_simulation_la_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_la_combined_long,"Infected_9age_simulation_la_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_la_nointer_long <- SEIHDQR_9age_simulation_la_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_nointer_long <- cbind(SEIHDQR_9age_simulation_la_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_nointer_long,"SEIHDQR_9age_simulation_la_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_la_nointer_long<-fread("SEIHDQR_9age_simulation_la_nointer_long.csv")
Infected_9age_simulation_la_nointer_long<-subset(SEIHDQR_9age_simulation_la_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_la_nointer_long,"Infected_9age_simulation_la_nointer_long.csv",row.names = F)


infected_9age_estimate_la_scenarios <- rbind(Infected_9age_simulation_la_schoolclose_long, Infected_9age_simulation_la_50work_long, Infected_9age_simulation_la_80work_long, Infected_9age_simulation_la_50other_long, Infected_9age_simulation_la_20other_long, Infected_9age_simulation_la_10quarantine_long, Infected_9age_simulation_la_city_lockdown_long, Infected_9age_simulation_la_combined_long)# Infected_9age_simulation_la_inter_borderclosure_long,

infected_9age_estimate_la_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_la_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_la_nointer_long$period <- NULL
Infected_9age_simulation_la_nointer_long$state<- NULL
names(Infected_9age_simulation_la_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_la_scenarios_nointer <- merge(infected_9age_estimate_la_scenarios, Infected_9age_simulation_la_nointer_long, by = c("time","age_group"))
infected_9age_estimate_la_scenarios_nointer$state <- NULL
infected_9age_estimate_la_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_la_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_la_scenarios_nointer_agg$policy)
infected_9age_estimate_la_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_la_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_la_scenarios_nointer_agg$estimate)/infected_9age_estimate_la_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_la_scenarios_nointer_agg,"infected_9age_estimate_la_scenarios_nointer_agg.csv",row.names = F)



SEIHDQR_9age_simulation_daegu_schoolclose<-fread("SEIHDQR_9age_simulation_daegu_schoolclose.csv")
SEIHDQR_9age_simulation_daegu_50work<-fread("SEIHDQR_9age_simulation_daegu_50work.csv")
SEIHDQR_9age_simulation_daegu_80work<-fread("SEIHDQR_9age_simulation_daegu_80work.csv")
SEIHDQR_9age_simulation_daegu_50other<-fread("SEIHDQR_9age_simulation_daegu_50other.csv")
SEIHDQR_9age_simulation_daegu_20other<-fread("SEIHDQR_9age_simulation_daegu_20other.csv")
SEIHDQR_9age_simulation_daegu_10quarantine<-fread("SEIHDQR_9age_simulation_daegu_10quarantine.csv")
#SEIHDQR_9age_simulation_daegu_inter_borderclosure<-fread("SEIHDQR_9age_simulation_daegu_inter_borderclosure.csv")
SEIHDQR_9age_simulation_daegu_city_lockdown<-fread("SEIHDQR_9age_simulation_daegu_city_lockdown.csv")
SEIHDQR_9age_simulation_daegu_combined<-fread("SEIHDQR_9age_simulation_daegu_combined.csv")
SEIHDQR_9age_simulation_daegu_nointer <- fread("SEIHDQR_9age_simulation_daegu_nointer.csv")

#plot specific measure


#school close plots
SEIHDQR_9age_simulation_daegu_schoolclose_long <- SEIHDQR_9age_simulation_daegu_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_schoolclose_long <- cbind(SEIHDQR_9age_simulation_daegu_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_schoolclose_long,"SEIHDQR_9age_simulation_daegu_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_schoolclose_long<-fread("SEIHDQR_9age_simulation_daegu_schoolclose_long.csv")
#SEIHDQR_9age_simulation_daegu_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_daegu_schoolclose_long<-subset(SEIHDQR_9age_simulation_daegu_schoolclose_long, state=="I")#
Infected_9age_simulation_daegu_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_daegu_schoolclose_long,"Infected_9age_simulation_daegu_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_daegu_50work_long <- SEIHDQR_9age_simulation_daegu_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_50work_long <- cbind(SEIHDQR_9age_simulation_daegu_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_50work_long,"SEIHDQR_9age_simulation_daegu_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_50work_long<-fread("SEIHDQR_9age_simulation_daegu_50work_long.csv")

Infected_9age_simulation_daegu_50work_long<-subset(SEIHDQR_9age_simulation_daegu_50work_long, state=="I")#
Infected_9age_simulation_daegu_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_daegu_50work_long,"Infected_9age_simulation_daegu_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_daegu_80work_long <- SEIHDQR_9age_simulation_daegu_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_80work_long <- cbind(SEIHDQR_9age_simulation_daegu_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_80work_long,"SEIHDQR_9age_simulation_daegu_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_80work_long<-fread("SEIHDQR_9age_simulation_daegu_80work_long.csv")

Infected_9age_simulation_daegu_80work_long<-subset(SEIHDQR_9age_simulation_daegu_80work_long, state=="I")#
Infected_9age_simulation_daegu_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_daegu_80work_long,"Infected_9age_simulation_daegu_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_daegu_50other_long <- SEIHDQR_9age_simulation_daegu_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_50other_long <- cbind(SEIHDQR_9age_simulation_daegu_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_50other_long,"SEIHDQR_9age_simulation_daegu_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_50other_long<-fread("SEIHDQR_9age_simulation_daegu_50other_long.csv")

Infected_9age_simulation_daegu_50other_long<-subset(SEIHDQR_9age_simulation_daegu_50other_long, state=="I")#
Infected_9age_simulation_daegu_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_daegu_50other_long,"Infected_9age_simulation_daegu_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_daegu_20other_long <- SEIHDQR_9age_simulation_daegu_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_20other_long <- cbind(SEIHDQR_9age_simulation_daegu_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_20other_long,"SEIHDQR_9age_simulation_daegu_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_20other_long<-fread("SEIHDQR_9age_simulation_daegu_20other_long.csv")

Infected_9age_simulation_daegu_20other_long<-subset(SEIHDQR_9age_simulation_daegu_20other_long, state=="I")#
Infected_9age_simulation_daegu_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_daegu_20other_long,"Infected_9age_simulation_daegu_20other_long.csv",row.names = F)

#10 quarantine plots
SEIHDQR_9age_simulation_daegu_10quarantine_long <- SEIHDQR_9age_simulation_daegu_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_10quarantine_long <- cbind(SEIHDQR_9age_simulation_daegu_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_10quarantine_long,"SEIHDQR_9age_simulation_daegu_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_10quarantine_long<-fread("SEIHDQR_9age_simulation_daegu_10quarantine_long.csv")

Infected_9age_simulation_daegu_10quarantine_long<-subset(SEIHDQR_9age_simulation_daegu_10quarantine_long, state=="I")#
Infected_9age_simulation_daegu_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_daegu_10quarantine_long,"Infected_9age_simulation_daegu_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long <- SEIHDQR_9age_simulation_daegu_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long,"SEIHDQR_9age_simulation_daegu_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_daegu_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_daegu_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_daegu_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_daegu_inter_borderclosure_long,"Infected_9age_simulation_daegu_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_daegu_city_lockdown_long <- SEIHDQR_9age_simulation_daegu_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_daegu_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_city_lockdown_long,"SEIHDQR_9age_simulation_daegu_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_city_lockdown_long<-fread("SEIHDQR_9age_simulation_daegu_city_lockdown_long.csv")

Infected_9age_simulation_daegu_city_lockdown_long<-subset(SEIHDQR_9age_simulation_daegu_city_lockdown_long, state=="I")#
Infected_9age_simulation_daegu_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_daegu_city_lockdown_long,"Infected_9age_simulation_daegu_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_daegu_combined_long <- SEIHDQR_9age_simulation_daegu_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_combined_long <- cbind(SEIHDQR_9age_simulation_daegu_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_combined_long,"SEIHDQR_9age_simulation_daegu_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_combined_long<-fread("SEIHDQR_9age_simulation_daegu_combined_long.csv")
Infected_9age_simulation_daegu_combined_long<-subset(SEIHDQR_9age_simulation_daegu_combined_long, state=="I")#
Infected_9age_simulation_daegu_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_daegu_combined_long,"Infected_9age_simulation_daegu_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_daegu_nointer_long <- SEIHDQR_9age_simulation_daegu_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_nointer_long <- cbind(SEIHDQR_9age_simulation_daegu_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_nointer_long,"SEIHDQR_9age_simulation_daegu_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_daegu_nointer_long<-fread("SEIHDQR_9age_simulation_daegu_nointer_long.csv")
Infected_9age_simulation_daegu_nointer_long<-subset(SEIHDQR_9age_simulation_daegu_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_daegu_nointer_long,"Infected_9age_simulation_daegu_nointer_long.csv",row.names = F)


infected_9age_estimate_daegu_scenarios <- rbind(Infected_9age_simulation_daegu_schoolclose_long, Infected_9age_simulation_daegu_50work_long, Infected_9age_simulation_daegu_80work_long, Infected_9age_simulation_daegu_50other_long, Infected_9age_simulation_daegu_20other_long, Infected_9age_simulation_daegu_10quarantine_long, Infected_9age_simulation_daegu_city_lockdown_long, Infected_9age_simulation_daegu_combined_long) # Infected_9age_simulation_daegu_inter_borderclosure_long,

infected_9age_estimate_daegu_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_daegu_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_daegu_nointer_long$period <- NULL
Infected_9age_simulation_daegu_nointer_long$state<- NULL
names(Infected_9age_simulation_daegu_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_daegu_scenarios_nointer <- merge(infected_9age_estimate_daegu_scenarios, Infected_9age_simulation_daegu_nointer_long, by = c("time","age_group"))
infected_9age_estimate_daegu_scenarios_nointer$state <- NULL
infected_9age_estimate_daegu_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_daegu_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_daegu_scenarios_nointer_agg$policy)
infected_9age_estimate_daegu_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_daegu_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_daegu_scenarios_nointer_agg$estimate)/infected_9age_estimate_daegu_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_daegu_scenarios_nointer_agg,"infected_9age_estimate_daegu_scenarios_nointer_agg.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_schoolclose<-fread("SEIHDQR_9age_simulation_nairobi_schoolclose.csv")
SEIHDQR_9age_simulation_nairobi_50work<-fread("SEIHDQR_9age_simulation_nairobi_50work.csv")
SEIHDQR_9age_simulation_nairobi_80work<-fread("SEIHDQR_9age_simulation_nairobi_80work.csv")
SEIHDQR_9age_simulation_nairobi_50other<-fread("SEIHDQR_9age_simulation_nairobi_50other.csv")
SEIHDQR_9age_simulation_nairobi_20other<-fread("SEIHDQR_9age_simulation_nairobi_20other.csv")
SEIHDQR_9age_simulation_nairobi_10quarantine<-fread("SEIHDQR_9age_simulation_nairobi_10quarantine.csv")
#SEIHDQR_9age_simulation_nairobi_inter_borderclosure<-fread("SEIHDQR_9age_simulation_nairobi_inter_borderclosure.csv")
SEIHDQR_9age_simulation_nairobi_city_lockdown<-fread("SEIHDQR_9age_simulation_nairobi_city_lockdown.csv")
SEIHDQR_9age_simulation_nairobi_combined<-fread("SEIHDQR_9age_simulation_nairobi_combined.csv")
SEIHDQR_9age_simulation_nairobi_nointer <- fread("SEIHDQR_9age_simulation_nairobi_nointer.csv")
#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_nairobi_schoolclose_long <- SEIHDQR_9age_simulation_nairobi_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_schoolclose_long <- cbind(SEIHDQR_9age_simulation_nairobi_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_schoolclose_long,"SEIHDQR_9age_simulation_nairobi_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_schoolclose_long<-fread("SEIHDQR_9age_simulation_nairobi_schoolclose_long.csv")
#SEIHDQR_9age_simulation_nairobi_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_nairobi_schoolclose_long<-subset(SEIHDQR_9age_simulation_nairobi_schoolclose_long, state=="I")#
Infected_9age_simulation_nairobi_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_nairobi_schoolclose_long,"Infected_9age_simulation_nairobi_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_nairobi_50work_long <- SEIHDQR_9age_simulation_nairobi_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_50work_long <- cbind(SEIHDQR_9age_simulation_nairobi_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_50work_long,"SEIHDQR_9age_simulation_nairobi_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_50work_long<-fread("SEIHDQR_9age_simulation_nairobi_50work_long.csv")

Infected_9age_simulation_nairobi_50work_long<-subset(SEIHDQR_9age_simulation_nairobi_50work_long, state=="I")#
Infected_9age_simulation_nairobi_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_nairobi_50work_long,"Infected_9age_simulation_nairobi_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_nairobi_80work_long <- SEIHDQR_9age_simulation_nairobi_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_80work_long <- cbind(SEIHDQR_9age_simulation_nairobi_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_80work_long,"SEIHDQR_9age_simulation_nairobi_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_80work_long<-fread("SEIHDQR_9age_simulation_nairobi_80work_long.csv")

Infected_9age_simulation_nairobi_80work_long<-subset(SEIHDQR_9age_simulation_nairobi_80work_long, state=="I")#
Infected_9age_simulation_nairobi_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_nairobi_80work_long,"Infected_9age_simulation_nairobi_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_nairobi_50other_long <- SEIHDQR_9age_simulation_nairobi_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_50other_long <- cbind(SEIHDQR_9age_simulation_nairobi_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_50other_long,"SEIHDQR_9age_simulation_nairobi_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_50other_long<-fread("SEIHDQR_9age_simulation_nairobi_50other_long.csv")

Infected_9age_simulation_nairobi_50other_long<-subset(SEIHDQR_9age_simulation_nairobi_50other_long, state=="I")#
Infected_9age_simulation_nairobi_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_nairobi_50other_long,"Infected_9age_simulation_nairobi_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_nairobi_20other_long <- SEIHDQR_9age_simulation_nairobi_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_20other_long <- cbind(SEIHDQR_9age_simulation_nairobi_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_20other_long,"SEIHDQR_9age_simulation_nairobi_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_20other_long<-fread("SEIHDQR_9age_simulation_nairobi_20other_long.csv")

Infected_9age_simulation_nairobi_20other_long<-subset(SEIHDQR_9age_simulation_nairobi_20other_long, state=="I")#
Infected_9age_simulation_nairobi_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_nairobi_20other_long,"Infected_9age_simulation_nairobi_20other_long.csv",row.names = F)

#10 quarantine plots
SEIHDQR_9age_simulation_nairobi_10quarantine_long <- SEIHDQR_9age_simulation_nairobi_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_10quarantine_long <- cbind(SEIHDQR_9age_simulation_nairobi_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_10quarantine_long,"SEIHDQR_9age_simulation_nairobi_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_10quarantine_long<-fread("SEIHDQR_9age_simulation_nairobi_10quarantine_long.csv")

Infected_9age_simulation_nairobi_10quarantine_long<-subset(SEIHDQR_9age_simulation_nairobi_10quarantine_long, state=="I")#
Infected_9age_simulation_nairobi_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_nairobi_10quarantine_long,"Infected_9age_simulation_nairobi_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long <- SEIHDQR_9age_simulation_nairobi_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long,"SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_nairobi_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_nairobi_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_nairobi_inter_borderclosure_long,"Infected_9age_simulation_nairobi_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_nairobi_city_lockdown_long <- SEIHDQR_9age_simulation_nairobi_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_nairobi_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_city_lockdown_long,"SEIHDQR_9age_simulation_nairobi_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_city_lockdown_long<-fread("SEIHDQR_9age_simulation_nairobi_city_lockdown_long.csv")

Infected_9age_simulation_nairobi_city_lockdown_long<-subset(SEIHDQR_9age_simulation_nairobi_city_lockdown_long, state=="I")#
Infected_9age_simulation_nairobi_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_nairobi_city_lockdown_long,"Infected_9age_simulation_nairobi_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_nairobi_combined_long <- SEIHDQR_9age_simulation_nairobi_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_combined_long <- cbind(SEIHDQR_9age_simulation_nairobi_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_combined_long,"SEIHDQR_9age_simulation_nairobi_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_combined_long<-fread("SEIHDQR_9age_simulation_nairobi_combined_long.csv")
Infected_9age_simulation_nairobi_combined_long<-subset(SEIHDQR_9age_simulation_nairobi_combined_long, state=="I")#
Infected_9age_simulation_nairobi_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_nairobi_combined_long,"Infected_9age_simulation_nairobi_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_nairobi_nointer_long <- SEIHDQR_9age_simulation_nairobi_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_nointer_long <- cbind(SEIHDQR_9age_simulation_nairobi_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_nointer_long,"SEIHDQR_9age_simulation_nairobi_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_nairobi_nointer_long<-fread("SEIHDQR_9age_simulation_nairobi_nointer_long.csv")
Infected_9age_simulation_nairobi_nointer_long<-subset(SEIHDQR_9age_simulation_nairobi_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_nairobi_nointer_long,"Infected_9age_simulation_nairobi_nointer_long.csv",row.names = F)


infected_9age_estimate_nairobi_scenarios <- rbind(Infected_9age_simulation_nairobi_schoolclose_long, Infected_9age_simulation_nairobi_50work_long, Infected_9age_simulation_nairobi_80work_long, Infected_9age_simulation_nairobi_50other_long, Infected_9age_simulation_nairobi_20other_long, Infected_9age_simulation_nairobi_10quarantine_long, Infected_9age_simulation_nairobi_city_lockdown_long, Infected_9age_simulation_nairobi_combined_long)#Infected_9age_simulation_nairobi_inter_borderclosure_long,

infected_9age_estimate_nairobi_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_nairobi_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_nairobi_nointer_long$period <- NULL
Infected_9age_simulation_nairobi_nointer_long$state<- NULL
names(Infected_9age_simulation_nairobi_nointer_long)[2] <- "estimate_nointer"
Infected_9age_simulation_nairobi_nointer_long$age_group <- as.integer(Infected_9age_simulation_nairobi_nointer_long$age_group)
infected_9age_estimate_nairobi_scenarios$age_group <- as.integer(infected_9age_estimate_nairobi_scenarios$age_group)
infected_9age_estimate_nairobi_scenarios_nointer <- merge(infected_9age_estimate_nairobi_scenarios, Infected_9age_simulation_nairobi_nointer_long, by = c("time","age_group"))
infected_9age_estimate_nairobi_scenarios_nointer$state <- NULL
infected_9age_estimate_nairobi_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_nairobi_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_nairobi_scenarios_nointer_agg$policy)
infected_9age_estimate_nairobi_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate)/infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_nairobi_scenarios_nointer_agg,"infected_9age_estimate_nairobi_scenarios_nointer_agg.csv",row.names = F)





infected_9age_estimate_nyc_scenarios_nointer_agg<-fread("infected_9age_estimate_nyc_scenarios_nointer_agg.csv")
infected_9age_estimate_la_scenarios_nointer_agg<-fread("infected_9age_estimate_la_scenarios_nointer_agg.csv")
infected_9age_estimate_daegu_scenarios_nointer_agg<-fread("infected_9age_estimate_daegu_scenarios_nointer_agg.csv")
infected_9age_estimate_nairobi_scenarios_nointer_agg<-fread("infected_9age_estimate_nairobi_scenarios_nointer_agg.csv")
infected_9age_estimate_nyc_scenarios_nointer_agg$city <- "New York"
infected_9age_estimate_la_scenarios_nointer_agg$city <- "Los Angeles"
infected_9age_estimate_daegu_scenarios_nointer_agg$city <- "Daegu"
infected_9age_estimate_nairobi_scenarios_nointer_agg$city <- "Nairobi"

#unique(infected_9age_estimate_scenario_fourcities$policy)

infected_9age_estimate_scenario_fourcities <- rbind(infected_9age_estimate_nyc_scenarios_nointer_agg,infected_9age_estimate_la_scenarios_nointer_agg,infected_9age_estimate_daegu_scenarios_nointer_agg,infected_9age_estimate_nairobi_scenarios_nointer_agg)
neworder<-c("School close","50% working from home","80% working from home","50% other mobility","20% other mobility","10% quarantine", "City lockdown","Combined policy")#"Border closure",
neworder_age<-c(1,2,3,4,5,6,7,8,9)


library(viridis)
infected_9age_estimate_scenario_fourcities$policy<-factor(infected_9age_estimate_scenario_fourcities$policy, levels=neworder)
infected_9age_estimate_scenario_fourcities$age_group<-factor(infected_9age_estimate_scenario_fourcities$age_group, levels=neworder_age, labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
# infected_9age_estimate_scenario_fourcities$avoided_effect <- ifelse(infected_9age_estimate_scenario_fourcities$avoided_effect<0,0,infected_9age_estimate_scenario_fourcities$avoided_effect)
infected_9age_estimate_scenario_fourcities_agg<- aggregate(avoided_effect~city+policy, FUN=mean, infected_9age_estimate_scenario_fourcities)
matrix_plot_infected_9age_estimate_scenario_fourcities_effectiveness <- ggplot(infected_9age_estimate_scenario_fourcities, aes(x=policy, y= age_group, fill=avoided_effect))+
  geom_tile()+
  geom_text(aes(label=round(avoided_effect,2)), color = "black", size=8)+
  #scale_fill_gradient(low="orange", high="white", limits=c(0, 1), na.value = "transparent")+
  scale_fill_viridis_c(direction = -1, option = "plasma", begin = 0.1, end = 1, name="Effectiveness") +
  scale_x_discrete(name = "Policy")+
  scale_y_discrete(name = "Age")+
  theme(axis.title = element_text(size = 18),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 16,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=20, angle = 90),
        axis.text.y = element_text(size=20, angle = 0))+

  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  #guides(fill=guide_legend())+
  facet_wrap(.~city,nrow=2, strip.position = "left")
ggsave("matrix_plot_infected_9age_estimate_scenario_fourcities_effectiveness.pdf", width = 18, height = 16)


library(ggplot2)
library(ggsci)

infected_9age_estimate_nyc_scenarios$city <- "New York"
infected_9age_estimate_la_scenarios$city <- "Los Angeles"
infected_9age_estimate_daegu_scenarios$city <- "Daegu"
infected_9age_estimate_nairobi_scenarios$city <- "Nairobi"
infected_9age_estimate_nyc_scenarios$time<-as.Date(infected_9age_estimate_nyc_scenarios$time, origin = "2020-03-02")
infected_9age_estimate_la_scenarios$time<-as.Date(infected_9age_estimate_la_scenarios$time, origin = "2020-01-26")
infected_9age_estimate_daegu_scenarios$time<-as.Date(infected_9age_estimate_daegu_scenarios$time, origin = "2020-01-20")
infected_9age_estimate_nairobi_scenarios$time<-as.Date(infected_9age_estimate_nairobi_scenarios$time, origin = "2020-03-13")

neworder<-c("School close","50% working from home","80% working from home","50% other mobility","20% other mobility","10% quarantine", "City lockdown","Combined policy")
unique(infected_9age_estimate_nairobi_scenarios$policy)
infected_9age_estimate_nairobi_scenarios$policy<-factor(infected_9age_estimate_nairobi_scenarios$policy, levels=neworder)


infected_9age_estimate_nyc_la_nairobi_daegu_scenarios <- rbind(infected_9age_estimate_nyc_scenarios,infected_9age_estimate_la_scenarios,infected_9age_estimate_daegu_scenarios,infected_9age_estimate_nairobi_scenarios)
lineplot_infected_9age_estimate_nyc_la_nairobi_daegu_scenarios <- ggplot(infected_9age_estimate_nyc_la_nairobi_daegu_scenarios, aes(x= as.Date(time), y= estimate,  color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.4, size=1.2)+
  
  scale_y_continuous(position = "right")+
  scale_x_date(date_breaks = "2 month", date_minor_breaks = "1 day", date_labels ="%Y-%m-%d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 14),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        strip.text = element_text(size = 10,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=14),#legend text
        axis.title.x = element_text(size=14, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=14, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=14, angle = 90),
        axis.text.y = element_text(size=14, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per million population")+
  facet_grid(policy~city, scales = "free")+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"), linetype = FALSE)+
  ggtitle("Intervention comparison")
ggsave("lineplot_infected_9age_estimate_nyc_la_nairobi_daegu_scenarios.pdf", width = 16, height = 20)

```



```{r interventions effects of school closure/working home/other mobility/quarantine targeting the older adults}


#contact matrix package
contact_matrix_9age_nyc <-readRDS("contact_matrix_9age_ny.rds")
contact_matrix_9age_la <-readRDS("contact_matrix_9age_la.rds")
contact_matrix_9age_daegu <-readRDS("contact_matrix_9age_daegu.rds")
contact_matrix_9age_nairobi <-readRDS("contact_matrix_9age_nairobi.rds")

#=============================protect the old strategy================================
library(gdata)
#contact matrix policy package 1: school close
#create block matrix
m1 <- matrix(1,nrow= 6, ncol=6)
m2 <- matrix(0.5, nrow=6, ncol=3)
m3 <- matrix(0.5, nrow=3, ncol=6)
m4 <- matrix(0.5, nrow=3, ncol=3)
age_matrix0.5_1 <- cbindX(m1,m2)
age_matrix0.5_2 <- cbindX(m3,m4)
age_matrix0.5 <- rbind(age_matrix0.5_1,age_matrix0.5_2)


contact.matrix_package1_nairobi<-list(contact_matrix_9age_nairobi$home *age_matrix0.5,contact_matrix_9age_nairobi$school*0*age_matrix0.5,contact_matrix_9age_nairobi$work*age_matrix0.5,contact_matrix_9age_nairobi$other*age_matrix0.5)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_nairobi<-list(contact_matrix_9age_nairobi$home*age_matrix0.5,contact_matrix_9age_nairobi$school*age_matrix0.5,contact_matrix_9age_nairobi$work*0.5*age_matrix0.5,contact_matrix_9age_nairobi$other*age_matrix0.5)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_nairobi<-list(contact_matrix_9age_nairobi$home*age_matrix0.5,contact_matrix_9age_nairobi$school*age_matrix0.5,contact_matrix_9age_nairobi$work*0.2*age_matrix0.5,contact_matrix_9age_nairobi$other*age_matrix0.5)
#contact matrix policy package 4: 50% other
contact.matrix_package4_nairobi<-list(contact_matrix_9age_nairobi$home*age_matrix0.5,contact_matrix_9age_nairobi$school*age_matrix0.5,contact_matrix_9age_nairobi$work*age_matrix0.5,contact_matrix_9age_nairobi$other*0.5*age_matrix0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_nairobi<-list(contact_matrix_9age_nairobi$home*age_matrix0.5,contact_matrix_9age_nairobi$school*age_matrix0.5,contact_matrix_9age_nairobi$work*age_matrix0.5,contact_matrix_9age_nairobi$other*0.2*age_matrix0.5)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_nairobi<-list(contact_matrix_9age_nairobi$home*age_matrix0.5,contact_matrix_9age_nairobi$school*0*age_matrix0.5,contact_matrix_9age_nairobi$work*0.5*age_matrix0.5,contact_matrix_9age_nairobi$other*0.5*age_matrix0.5)
#contact matrix policy package 7: 
contact.matrix_10quarantine_nairobi<-list(contact_matrix_9age_nairobi$home*age_matrix0.5,contact_matrix_9age_nairobi$school*age_matrix0.5,contact_matrix_9age_nairobi$work*age_matrix0.5,contact_matrix_9age_nairobi$other*age_matrix0.5)


#contact matrix policy package 8: 
contact.matrix_city_lockdown_nairobi<-list(contact_matrix_9age_nairobi$home*age_matrix0.5,contact_matrix_9age_nairobi$school*age_matrix0.5,contact_matrix_9age_nairobi$work*age_matrix0.5,contact_matrix_9age_nairobi$other*age_matrix0.5)
#contact matrix policy package 9: 
contact.matrix_nointer_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other)


#contact matrix for the nyc

#contact matrix policy package 1: school close
contact.matrix_package1_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*0*age_matrix0.5,contact_matrix_9age_nyc$work*age_matrix0.5,contact_matrix_9age_nyc$other*age_matrix0.5)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*age_matrix0.5,contact_matrix_9age_nyc$work*0.5*age_matrix0.5,contact_matrix_9age_nyc$other*age_matrix0.5)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*age_matrix0.5,contact_matrix_9age_nyc$work*0.2*age_matrix0.5,contact_matrix_9age_nyc$other*age_matrix0.5)
#contact matrix policy package 4: 50% other
contact.matrix_package4_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*age_matrix0.5,contact_matrix_9age_nyc$work*age_matrix0.5,contact_matrix_9age_nyc$other*0.5*age_matrix0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*age_matrix0.5,contact_matrix_9age_nyc$work*age_matrix0.5,contact_matrix_9age_nyc$other*0.2*age_matrix0.5)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*0*age_matrix0.5,contact_matrix_9age_nyc$work*0.5*age_matrix0.5,contact_matrix_9age_nyc$other*0.5*age_matrix0.5)
#contact matrix policy package 7: 
contact.matrix_10quarantine_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*age_matrix0.5,contact_matrix_9age_nyc$work*age_matrix0.5,contact_matrix_9age_nyc$other*age_matrix0.5)
#contact matrix policy package 8: 
contact.matrix_city_lockdown_nyc<-list(contact_matrix_9age_nyc$home*age_matrix0.5,contact_matrix_9age_nyc$school*age_matrix0.5,contact_matrix_9age_nyc$work*age_matrix0.5,contact_matrix_9age_nyc$other*age_matrix0.5)
#contact matrix policy package 8: 
contact.matrix_nointer_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work,contact_matrix_9age_nyc$other)

#contact matrix for the la

#contact matrix policy package 1: school close
contact.matrix_package1_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*0*age_matrix0.5,contact_matrix_9age_la$work*age_matrix0.5,contact_matrix_9age_la$other*age_matrix0.5)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*age_matrix0.5,contact_matrix_9age_la$work*0.5*age_matrix0.5,contact_matrix_9age_la$other*age_matrix0.5)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*age_matrix0.5,contact_matrix_9age_la$work*0.2*age_matrix0.5,contact_matrix_9age_la$other*age_matrix0.5)
#contact matrix policy package 4: 50% other
contact.matrix_package4_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*age_matrix0.5,contact_matrix_9age_la$work*age_matrix0.5,contact_matrix_9age_la$other*0.5*age_matrix0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*age_matrix0.5,contact_matrix_9age_la$work*age_matrix0.5,contact_matrix_9age_la$other*0.2*age_matrix0.5)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*0*age_matrix0.5,contact_matrix_9age_la$work*0.5*age_matrix0.5, contact_matrix_9age_la$other*0.5*age_matrix0.5)
#contact matrix policy package 7: 
contact.matrix_10quarantine_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*age_matrix0.5,contact_matrix_9age_la$work*age_matrix0.5,contact_matrix_9age_la$other*age_matrix0.5)
#contact matrix policy package 8: 
contact.matrix_city_lockdown_la<-list(contact_matrix_9age_la$home*age_matrix0.5,contact_matrix_9age_la$school*age_matrix0.5,contact_matrix_9age_la$work*age_matrix0.5,contact_matrix_9age_la$other*age_matrix0.5)
#contact matrix policy package 8: 
contact.matrix_nointer_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other)

#contact matrix for the daegu

#contact matrix policy package 1: school close
contact.matrix_package1_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*0*age_matrix0.5,contact_matrix_9age_daegu$work*age_matrix0.5,contact_matrix_9age_daegu$other*age_matrix0.5)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*age_matrix0.5,contact_matrix_9age_daegu$work*0.5*age_matrix0.5,contact_matrix_9age_daegu$other*age_matrix0.5)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*age_matrix0.5,contact_matrix_9age_daegu$work*0.2*age_matrix0.5,contact_matrix_9age_daegu$other*age_matrix0.5)
#contact matrix policy package 4: 50% other
contact.matrix_package4_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*age_matrix0.5,contact_matrix_9age_daegu$work*age_matrix0.5,contact_matrix_9age_daegu$other*0.5*age_matrix0.5)
#contact matrix policy package 5: 20% other
contact.matrix_package5_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*age_matrix0.5,contact_matrix_9age_daegu$work*age_matrix0.5,contact_matrix_9age_daegu$other*0.2*age_matrix0.5)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*0*age_matrix0.5,contact_matrix_9age_daegu$work*0.5*age_matrix0.5,contact_matrix_9age_daegu$other*0.5*age_matrix0.5)
#contact matrix policy package 7: 
contact.matrix_10quarantine_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*age_matrix0.5,contact_matrix_9age_daegu$work*age_matrix0.5,contact_matrix_9age_daegu$other*age_matrix0.5)
#contact matrix policy package 8: 
contact.matrix_city_lockdown_daegu<-list(contact_matrix_9age_daegu$home*age_matrix0.5,contact_matrix_9age_daegu$school*age_matrix0.5,contact_matrix_9age_daegu$work*age_matrix0.5,contact_matrix_9age_daegu$other*age_matrix0.5)
#contact matrix policy package 8: 
contact.matrix_nointer_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other)

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.



#transmissibility
transmissibility_9age_nairobi <- calculate_transimissibility(R0t = R0t_nairobi, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nairobi, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_nairobi)

transmissibility_9age_nyc <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nyc, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_nyc)

transmissibility_9age_la <- calculate_transimissibility(R0t = R0t_la, recov.rate = recov.rate, pop_age_structure = pop_age_structure_la, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_la)

transmissibility_9age_daegu <- calculate_transimissibility(R0t = R0t_daegu, recov.rate = recov.rate, pop_age_structure = pop_age_structure_daegu, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_daegu)


###transmission rate
transm.rate_without_intervention_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_nointer_nairobi)
saveRDS(transm.rate_without_intervention_nairobi,"transm.rate_without_intervention_nairobi_age_effect.rds")
transm.rate_package1_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package1_nairobi)
saveRDS(transm.rate_package1_nairobi,"transm.rate_package1_nairobi_age_effect.rds")
transm.rate_package2_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package2_nairobi)
saveRDS(transm.rate_package2_nairobi,"transm.rate_package2_nairobi_age_effect.rds")
transm.rate_package3_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package3_nairobi)
saveRDS(transm.rate_package3_nairobi,"transm.rate_package3_nairobi_age_effect.rds")
transm.rate_package4_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package4_nairobi)
saveRDS(transm.rate_package4_nairobi,"transm.rate_package4_nairobi_age_effect.rds")
transm.rate_package5_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package5_nairobi)
saveRDS(transm.rate_package5_nairobi,"transm.rate_package5_nairobi_age_effect.rds")
transm.rate_package6_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package6_nairobi)
saveRDS(transm.rate_package6_nairobi,"transm.rate_package6_nairobi_age_effect.rds")
transm.rate_quarantine10_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_10quarantine_nairobi)
saveRDS(transm.rate_quarantine10_nairobi,"transm.rate_quarantine10_nairobi_age_effect.rds")
transm.rate_city_lockdown_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_city_lockdown_nairobi)
saveRDS(transm.rate_city_lockdown_nairobi,"transm.rate_city_lockdown_nairobi_age_effect.rds")


###transmission rate
transm.rate_without_intervention_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_nointer_daegu)
saveRDS(transm.rate_without_intervention_daegu,"transm.rate_without_intervention_daegu_age_effect.rds")
transm.rate_package1_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package1_daegu)
saveRDS(transm.rate_package1_daegu,"transm.rate_package1_daegu_age_effect.rds")
transm.rate_package2_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package2_daegu)
saveRDS(transm.rate_package2_daegu,"transm.rate_package2_daegu_age_effect.rds")
transm.rate_package3_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package3_daegu)
saveRDS(transm.rate_package3_daegu,"transm.rate_package3_daegu_age_effect.rds")
transm.rate_package4_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package4_daegu)
saveRDS(transm.rate_package4_daegu,"transm.rate_package4_daegu_age_effect.rds")
transm.rate_package5_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package5_daegu)
saveRDS(transm.rate_package5_daegu,"transm.rate_package5_daegu_age_effect.rds")
transm.rate_package6_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package6_daegu)
saveRDS(transm.rate_package6_daegu,"transm.rate_package6_daegu_age_effect.rds")
transm.rate_quarantine10_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_10quarantine_daegu)
saveRDS(transm.rate_quarantine10_daegu,"transm.rate_quarantine10_daegu_age_effect.rds")
transm.rate_city_lockdown_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_city_lockdown_daegu)
saveRDS(transm.rate_city_lockdown_daegu,"transm.rate_city_lockdown_daegu_age_effect.rds")

###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_nointer_nyc)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc_age_effect.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package1_nyc)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc_age_effect.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package2_nyc)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc_age_effect.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package3_nyc)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc_age_effect.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package4_nyc)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc_age_effect.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package5_nyc)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc_age_effect.rds")
transm.rate_package6_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package6_nyc)
saveRDS(transm.rate_package6_nyc,"transm.rate_package6_nyc_age_effect.rds")
transm.rate_quarantine10_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_10quarantine_nyc)
saveRDS(transm.rate_quarantine10_nyc,"transm.rate_quarantine10_nyc_age_effect.rds")
transm.rate_city_lockdown_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_city_lockdown_nyc)
saveRDS(transm.rate_city_lockdown_nyc,"transm.rate_city_lockdown_nyc_age_effect.rds")



###transmission rate
transm.rate_without_intervention_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_nointer_la)
saveRDS(transm.rate_without_intervention_la,"transm.rate_without_intervention_la_age_effect.rds")
transm.rate_package1_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package1_la)
saveRDS(transm.rate_package1_la,"transm.rate_package1_la_age_effect.rds")
transm.rate_package2_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package2_la)
saveRDS(transm.rate_package2_la,"transm.rate_package2_la_age_effect.rds")
transm.rate_package3_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package3_la)
saveRDS(transm.rate_package3_la,"transm.rate_package3_la_age_effect.rds")
transm.rate_package4_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package4_la)
saveRDS(transm.rate_package4_la,"transm.rate_package4_la_age_effect.rds")
transm.rate_package5_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package5_la)
saveRDS(transm.rate_package5_la,"transm.rate_package5_la_age_effect.rds")
transm.rate_package6_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package6_la)
saveRDS(transm.rate_package6_la,"transm.rate_package6_la_age_effect.rds")
transm.rate_quarantine10_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_10quarantine_la)
saveRDS(transm.rate_quarantine10_la,"transm.rate_quarantine10_la_age_effect.rds")
transm.rate_city_lockdown_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_city_lockdown_la)
saveRDS(transm.rate_city_lockdown_la,"transm.rate_city_lockdown_la_age_effect.rds")


birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")




#para 9
hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis


tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)
#para 11
quar.rate_nairobi =c(rep(0.0001,9))
quar.rate_daegu =c(rep(0.0001,9))
quar.rate_nyc =c(rep(0.0001,9))
quar.rate_la =c(rep(0.0001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06


#without intervention
parameters_nairobi_age_effect <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)
saveRDS(parameters_nairobi_age_effect,"parameters_nairobi_age_effect.rds")

#without intervention
parameters_daegu_age_effect <- list(i.import=daegu_int_travel_import_data*tourism_age_structure,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu,
                       i.export=daegu_int_travel_export_data*tourism_age_structure,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)
saveRDS(parameters_daegu_age_effect,"parameters_daegu_age_effect.rds")

#without intervention
parameters_nyc_age_effect <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


saveRDS(parameters_nyc_age_effect,"parameters_nyc_age_effect.rds")


#without intervention
parameters_la_age_effect <- list(i.import=la_int_travel_import_data*tourism_age_structure,
                       d.import=la_dom_travel_import_data*pop_age_structure_la,
                       i.export=la_int_travel_export_data*tourism_age_structure,
                       d.export=la_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.1)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)
saveRDS(parameters_la_age_effect,"parameters_la_age_effect.rds")


#No intervention
constraint_no_intervention_nairobi<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nairobi,"constraint_no_intervention_nairobi.rds")



constraint_no_intervention_daegu<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_daegu,"constraint_no_intervention_daegu.rds")


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

constraint_no_intervention_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_la,"constraint_no_intervention_la.rds")



#intervention constraint package1
constraint_package1_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package1_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_nairobi,"constraint_package1_nairobi.rds")


constraint_package1_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package1_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_daegu,"constraint_package1_daegu.rds")

constraint_package1_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package1_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")

constraint_package1_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = transm.rate_package1_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_la,"constraint_package1_la.rds")



#intervention constraint package2

constraint_package2_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package2_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_nairobi,"constraint_package2_nairobi.rds")



constraint_package2_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package2_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_daegu,"constraint_package2_daegu.rds")

constraint_package2_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

constraint_package2_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package2_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_la,"constraint_package2_la.rds")




#intervention constraint package3

constraint_package3_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package3_nairobi/transm.rate_without_intervention_nairobi,
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_nairobi,"constraint_package3_nairobi.rds")


constraint_package3_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package3_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_daegu,"constraint_package3_daegu.rds")

constraint_package3_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

constraint_package3_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_la,"constraint_package3_la.rds")





#intervention constraint package4

constraint_package4_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package4_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_nairobi,"constraint_package4_nairobi.rds")


constraint_package4_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package4_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_daegu,"constraint_package4_daegu.rds")

constraint_package4_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

constraint_package4_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package4_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_la,"constraint_package4_la.rds")


#intervention constraint package5

constraint_package5_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package5_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_nairobi,"constraint_package5_nairobi.rds")


constraint_package5_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package5_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_daegu,"constraint_package5_daegu.rds")

constraint_package5_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")

constraint_package5_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package5_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_la,"constraint_package5_la.rds")


#intervention constraint package6

constraint_package6_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package6_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_nairobi,"constraint_package6_nairobi.rds")


constraint_package6_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package6_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_daegu,"constraint_package6_daegu.rds")

constraint_package6_nyc <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package6_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")

constraint_package6_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package6_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_la,"constraint_package6_la.rds")


#intervention constraint quarantine10

constraint_quarantine10_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_quarantine10_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_nairobi,"constraint_quarantine10_nairobi.rds")


constraint_quarantine10_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_quarantine10_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_daegu,"constraint_quarantine10_daegu.rds")

constraint_quarantine10_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_quarantine10_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_nyc,"constraint_quarantine10_nyc.rds")

constraint_quarantine10_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_quarantine10_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_la,"constraint_quarantine10_la.rds")


#intervention constraint city borderclosure

constraint_inter_borderclosure_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_nairobi,"constraint_inter_borderclosure_nairobi.rds")


constraint_inter_borderclosure_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_daegu,"constraint_inter_borderclosure_daegu.rds")

constraint_inter_borderclosure_nyc <- list(i.import = c(rep(0,9)),
                                     d.import = c(rep(1,9)),
                                     i.export = c(rep(0,9)),
                                     d.export = c(rep(1,9)),
                                     i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_nyc,"constraint_inter_borderclosure_nyc.rds")

constraint_inter_borderclosure_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_la,"constraint_inter_borderclosure_la.rds")



#intervention constraint city lockdown

constraint_city_lockdown_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_city_lockdown_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_nairobi,"constraint_city_lockdown_nairobi.rds")


constraint_city_lockdown_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_city_lockdown_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_daegu,"constraint_city_lockdown_daegu.rds")

constraint_city_lockdown_nyc <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                     i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_city_lockdown_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_nyc,"constraint_city_lockdown_nyc.rds")

constraint_city_lockdown_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_city_lockdown_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_la,"constraint_city_lockdown_la.rds")






Enyc. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
Inyc. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- Enyc. - Inyc.,
                  E. = Inyc./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")


Ela. = pop_la*pop_age_structure_la*2e-06/incub.rate
Ila. = pop_la*pop_age_structure_la*2e-06
initials_la <- c(S. = pop_la*pop_age_structure_la- Ela. - Ila.,
                  E. = Ila./incub.rate,
                  I. = pop_la*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_la*pop_age_structure_la*2e-06)
saveRDS(initials_la,"initials_la.rds")


Edaegu. = pop_daegu*pop_age_structure_daegu*2e-06/incub.rate
Idaegu. = pop_daegu*pop_age_structure_daegu*2e-06
initials_daegu <- c(S. = pop_daegu*pop_age_structure_daegu- Edaegu. - Idaegu.,
                  E. = Idaegu./incub.rate,
                  I. = pop_daegu*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_daegu*pop_age_structure_daegu*2e-06)
saveRDS(initials_daegu,"initials_daegu.rds")

Enairobi. = pop_nairobi*pop_age_structure_nairobi*2e-06/incub.rate
Inairobi. = pop_nairobi*pop_age_structure_nairobi*2e-06
initials_nairobi <- c(S. = pop_nairobi*pop_age_structure_nairobi- Enairobi. - Inairobi.,
                  E. = Inairobi./incub.rate,
                  I. = pop_nairobi*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nairobi*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nairobi,"initials_nairobi.rds")


library(deSolve)
#no intervention

SEIHDQR_9age_simulation_nyc_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package1_nyc, constraint3 = constraint_package1_nyc, constraint4 = constraint_package1_nyc, constraint5 = constraint_package1_nyc, constraint6 = constraint_package1_nyc)

SEIHDQR_9age_simulation_nyc_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package2_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package2_nyc, constraint4 = constraint_package2_nyc, constraint5 = constraint_package2_nyc, constraint6 = constraint_package2_nyc)

SEIHDQR_9age_simulation_nyc_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package3_nyc, constraint2 = constraint_package3_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package3_nyc, constraint5 = constraint_package3_nyc, constraint6 = constraint_package3_nyc)

SEIHDQR_9age_simulation_nyc_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package4_nyc, constraint2 = constraint_package4_nyc, constraint3 = constraint_package4_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package4_nyc, constraint6 = constraint_package4_nyc)

SEIHDQR_9age_simulation_nyc_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package5_nyc, constraint2 = constraint_package5_nyc, constraint3 = constraint_package5_nyc, constraint4 = constraint_package5_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package5_nyc)

SEIHDQR_9age_simulation_nyc_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_quarantine10_nyc, constraint2 = constraint_quarantine10_nyc, constraint3 = constraint_quarantine10_nyc, constraint4 = constraint_quarantine10_nyc, constraint5 = constraint_quarantine10_nyc, constraint6 = constraint_quarantine10_nyc)


#SEIHDQR_9age_simulation_nyc_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_inter_borderclosure_nyc, constraint2 = constraint_inter_borderclosure_nyc, constraint3 = constraint_inter_borderclosure_nyc, constraint4 = constraint_inter_borderclosure_nyc, constraint5 = constraint_inter_borderclosure_nyc, constraint6 = constraint_inter_borderclosure_nyc)

SEIHDQR_9age_simulation_nyc_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_city_lockdown_nyc, constraint2 = constraint_city_lockdown_nyc, constraint3 = constraint_city_lockdown_nyc, constraint4 = constraint_city_lockdown_nyc, constraint5 = constraint_city_lockdown_nyc, constraint6 = constraint_city_lockdown_nyc)

SEIHDQR_9age_simulation_nyc_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package6_nyc, constraint2 = constraint_package6_nyc, constraint3 = constraint_package6_nyc, constraint4 = constraint_package6_nyc, constraint5 = constraint_package6_nyc, constraint6 = constraint_package6_nyc)

SEIHDQR_9age_simulation_nyc_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_no_intervention_nyc, constraint2 = constraint_no_intervention_nyc, constraint3 = constraint_no_intervention_nyc, constraint4 = constraint_no_intervention_nyc, constraint5 = constraint_no_intervention_nyc, constraint6 = constraint_no_intervention_nyc)

write.csv(SEIHDQR_9age_simulation_nyc_schoolclose,"SEIHDQR_9age_simulation_nyc_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_50work,"SEIHDQR_9age_simulation_nyc_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_80work,"SEIHDQR_9age_simulation_nyc_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_50other,"SEIHDQR_9age_simulation_nyc_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_20other,"SEIHDQR_9age_simulation_nyc_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_10quarantine,"SEIHDQR_9age_simulation_nyc_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_nyc_inter_borderclosure,"SEIHDQR_9age_simulation_nyc_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_city_lockdown,"SEIHDQR_9age_simulation_nyc_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_combined,"SEIHDQR_9age_simulation_nyc_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_nointer,"SEIHDQR_9age_simulation_nyc_nointer.csv",row.names = F)


SEIHDQR_9age_simulation_la_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package1_la, constraint3 = constraint_package1_la, constraint4 = constraint_package1_la, constraint5 = constraint_package1_la, constraint6 = constraint_package1_la)

SEIHDQR_9age_simulation_la_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package2_la, constraint2 = constraint_package2_la, constraint3 = constraint_package2_la, constraint4 = constraint_package2_la, constraint5 = constraint_package2_la, constraint6 = constraint_package2_la)

SEIHDQR_9age_simulation_la_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package3_la, constraint2 = constraint_package3_la, constraint3 = constraint_package3_la, constraint4 = constraint_package3_la, constraint5 = constraint_package3_la, constraint6 = constraint_package3_la)

SEIHDQR_9age_simulation_la_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package4_la, constraint2 = constraint_package4_la, constraint3 = constraint_package4_la, constraint4 = constraint_package4_la, constraint5 = constraint_package4_la, constraint6 = constraint_package4_la)

SEIHDQR_9age_simulation_la_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package5_la, constraint2 = constraint_package5_la, constraint3 = constraint_package5_la, constraint4 = constraint_package5_la, constraint5 = constraint_package5_la, constraint6 = constraint_package5_la)

SEIHDQR_9age_simulation_la_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_quarantine10_la, constraint2 = constraint_quarantine10_la, constraint3 = constraint_quarantine10_la, constraint4 = constraint_quarantine10_la, constraint5 = constraint_quarantine10_la, constraint6 = constraint_quarantine10_la)


#SEIHDQR_9age_simulation_la_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_inter_borderclosure_la, constraint2 = constraint_inter_borderclosure_la, constraint3 = constraint_inter_borderclosure_la, constraint4 = constraint_inter_borderclosure_la, constraint5 = constraint_inter_borderclosure_la, constraint6 = constraint_inter_borderclosure_la)

SEIHDQR_9age_simulation_la_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_city_lockdown_la, constraint2 = constraint_city_lockdown_la, constraint3 = constraint_city_lockdown_la, constraint4 = constraint_city_lockdown_la, constraint5 = constraint_city_lockdown_la, constraint6 = constraint_city_lockdown_la)

SEIHDQR_9age_simulation_la_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package6_la, constraint2 = constraint_package6_la, constraint3 = constraint_package6_la, constraint4 = constraint_package6_la, constraint5 = constraint_package6_la, constraint6 = constraint_package6_la)

SEIHDQR_9age_simulation_la_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_no_intervention_la, constraint2 = constraint_no_intervention_la, constraint3 = constraint_no_intervention_la, constraint4 = constraint_no_intervention_la, constraint5 = constraint_no_intervention_la, constraint6 = constraint_no_intervention_la)

write.csv(SEIHDQR_9age_simulation_la_schoolclose,"SEIHDQR_9age_simulation_la_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_50work,"SEIHDQR_9age_simulation_la_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_80work,"SEIHDQR_9age_simulation_la_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_50other,"SEIHDQR_9age_simulation_la_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_20other,"SEIHDQR_9age_simulation_la_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_10quarantine,"SEIHDQR_9age_simulation_la_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_la_inter_borderclosure,"SEIHDQR_9age_simulation_la_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_city_lockdown,"SEIHDQR_9age_simulation_la_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_combined,"SEIHDQR_9age_simulation_la_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_nointer,"SEIHDQR_9age_simulation_la_nointer.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package1_daegu, constraint3 = constraint_package1_daegu, constraint4 = constraint_package1_daegu, constraint5 = constraint_package1_daegu, constraint6 = constraint_package1_daegu)

SEIHDQR_9age_simulation_daegu_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package2_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package2_daegu, constraint4 = constraint_package2_daegu, constraint5 = constraint_package2_daegu, constraint6 = constraint_package2_daegu)

SEIHDQR_9age_simulation_daegu_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package3_daegu, constraint2 = constraint_package3_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package3_daegu, constraint5 = constraint_package3_daegu, constraint6 = constraint_package3_daegu)

SEIHDQR_9age_simulation_daegu_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package4_daegu, constraint2 = constraint_package4_daegu, constraint3 = constraint_package4_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package4_daegu, constraint6 = constraint_package4_daegu)

SEIHDQR_9age_simulation_daegu_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package5_daegu, constraint2 = constraint_package5_daegu, constraint3 = constraint_package5_daegu, constraint4 = constraint_package5_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package5_daegu)

SEIHDQR_9age_simulation_daegu_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_quarantine10_daegu, constraint2 = constraint_quarantine10_daegu, constraint3 = constraint_quarantine10_daegu, constraint4 = constraint_quarantine10_daegu, constraint5 = constraint_quarantine10_daegu, constraint6 = constraint_quarantine10_daegu)


#SEIHDQR_9age_simulation_daegu_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_inter_borderclosure_daegu, constraint2 = constraint_inter_borderclosure_daegu, constraint3 = constraint_inter_borderclosure_daegu, constraint4 = constraint_inter_borderclosure_daegu, constraint5 = constraint_inter_borderclosure_daegu, constraint6 = constraint_inter_borderclosure_daegu)

SEIHDQR_9age_simulation_daegu_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_city_lockdown_daegu, constraint2 = constraint_city_lockdown_daegu, constraint3 = constraint_city_lockdown_daegu, constraint4 = constraint_city_lockdown_daegu, constraint5 = constraint_city_lockdown_daegu, constraint6 = constraint_city_lockdown_daegu)

SEIHDQR_9age_simulation_daegu_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2020-12-19"), constraint1 = constraint_package6_daegu, constraint2 = constraint_package6_daegu, constraint3 = constraint_package6_daegu, constraint4 = constraint_package6_daegu, constraint5 = constraint_package6_daegu, constraint6 = constraint_package6_daegu)

SEIHDQR_9age_simulation_daegu_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_no_intervention_daegu, constraint2 = constraint_no_intervention_daegu, constraint3 = constraint_no_intervention_daegu, constraint4 = constraint_no_intervention_daegu, constraint5 = constraint_no_intervention_daegu, constraint6 = constraint_no_intervention_daegu)

write.csv(SEIHDQR_9age_simulation_daegu_schoolclose,"SEIHDQR_9age_simulation_daegu_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_50work,"SEIHDQR_9age_simulation_daegu_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_80work,"SEIHDQR_9age_simulation_daegu_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_50other,"SEIHDQR_9age_simulation_daegu_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_20other,"SEIHDQR_9age_simulation_daegu_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_10quarantine,"SEIHDQR_9age_simulation_daegu_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_daegu_inter_borderclosure,"SEIHDQR_9age_simulation_daegu_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_city_lockdown,"SEIHDQR_9age_simulation_daegu_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_combined,"SEIHDQR_9age_simulation_daegu_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_nointer,"SEIHDQR_9age_simulation_daegu_nointer.csv",row.names = F)

SEIHDQR_9age_simulation_nairobi_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package1_nairobi, constraint2 = constraint_package1_nairobi, constraint3 = constraint_package1_nairobi, constraint4 = constraint_package1_nairobi, constraint5 = constraint_package1_nairobi, constraint6 = constraint_package1_nairobi)

SEIHDQR_9age_simulation_nairobi_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package2_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package2_nairobi, constraint4 = constraint_package2_nairobi, constraint5 = constraint_package2_nairobi, constraint6 = constraint_package2_nairobi)

SEIHDQR_9age_simulation_nairobi_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package3_nairobi, constraint2 = constraint_package3_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package3_nairobi, constraint5 = constraint_package3_nairobi, constraint6 = constraint_package3_nairobi)

SEIHDQR_9age_simulation_nairobi_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package4_nairobi, constraint2 = constraint_package4_nairobi, constraint3 = constraint_package4_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package4_nairobi, constraint6 = constraint_package4_nairobi)

SEIHDQR_9age_simulation_nairobi_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package5_nairobi, constraint2 = constraint_package5_nairobi, constraint3 = constraint_package5_nairobi, constraint4 = constraint_package5_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package5_nairobi)

SEIHDQR_9age_simulation_nairobi_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_quarantine10_nairobi, constraint2 = constraint_quarantine10_nairobi, constraint3 = constraint_quarantine10_nairobi, constraint4 = constraint_quarantine10_nairobi, constraint5 = constraint_quarantine10_nairobi, constraint6 = constraint_quarantine10_nairobi)


#SEIHDQR_9age_simulation_nairobi_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_inter_borderclosure_nairobi, constraint2 = constraint_inter_borderclosure_nairobi, constraint3 = constraint_inter_borderclosure_nairobi, constraint4 = constraint_inter_borderclosure_nairobi, constraint5 = constraint_inter_borderclosure_nairobi, constraint6 = constraint_inter_borderclosure_nairobi)

SEIHDQR_9age_simulation_nairobi_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_city_lockdown_nairobi, constraint2 = constraint_city_lockdown_nairobi, constraint3 = constraint_city_lockdown_nairobi, constraint4 = constraint_city_lockdown_nairobi, constraint5 = constraint_city_lockdown_nairobi, constraint6 = constraint_city_lockdown_nairobi)

SEIHDQR_9age_simulation_nairobi_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package6_nairobi, constraint2 = constraint_package6_nairobi, constraint3 = constraint_package6_nairobi, constraint4 = constraint_package6_nairobi, constraint5 = constraint_package6_nairobi, constraint6 = constraint_package6_nairobi)

SEIHDQR_9age_simulation_nairobi_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_no_intervention_nairobi, constraint2 = constraint_no_intervention_nairobi, constraint3 = constraint_no_intervention_nairobi, constraint4 = constraint_no_intervention_nairobi, constraint5 = constraint_no_intervention_nairobi, constraint6 = constraint_no_intervention_nairobi)


write.csv(SEIHDQR_9age_simulation_nairobi_schoolclose,"SEIHDQR_9age_simulation_nairobi_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_50work,"SEIHDQR_9age_simulation_nairobi_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_80work,"SEIHDQR_9age_simulation_nairobi_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_50other,"SEIHDQR_9age_simulation_nairobi_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_20other,"SEIHDQR_9age_simulation_nairobi_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_10quarantine,"SEIHDQR_9age_simulation_nairobi_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_nairobi_inter_borderclosure,"SEIHDQR_9age_simulation_nairobi_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_city_lockdown,"SEIHDQR_9age_simulation_nairobi_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_combined,"SEIHDQR_9age_simulation_nairobi_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_nointer,"SEIHDQR_9age_simulation_nairobi_nointer.csv",row.names = F)



```



```{r plots for age-specific policy effects}

SEIHDQR_9age_simulation_nyc_schoolclose<-fread("SEIHDQR_9age_simulation_nyc_schoolclose.csv")
SEIHDQR_9age_simulation_nyc_50work<-fread("SEIHDQR_9age_simulation_nyc_50work.csv")
SEIHDQR_9age_simulation_nyc_80work<-fread("SEIHDQR_9age_simulation_nyc_80work.csv")
SEIHDQR_9age_simulation_nyc_50other<-fread("SEIHDQR_9age_simulation_nyc_50other.csv")
SEIHDQR_9age_simulation_nyc_20other<-fread("SEIHDQR_9age_simulation_nyc_20other.csv")
SEIHDQR_9age_simulation_nyc_10quarantine<-fread("SEIHDQR_9age_simulation_nyc_10quarantine.csv")
#SEIHDQR_9age_simulation_nyc_inter_borderclosure<-fread("SEIHDQR_9age_simulation_nyc_inter_borderclosure.csv")
SEIHDQR_9age_simulation_nyc_city_lockdown<-fread("SEIHDQR_9age_simulation_nyc_city_lockdown.csv")
SEIHDQR_9age_simulation_nyc_combined<-fread("SEIHDQR_9age_simulation_nyc_combined.csv")
SEIHDQR_9age_simulation_nyc_nointer<-fread("SEIHDQR_9age_simulation_nyc_nointer.csv")

#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_nyc_schoolclose_long <- SEIHDQR_9age_simulation_nyc_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_schoolclose_long <- cbind(SEIHDQR_9age_simulation_nyc_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_schoolclose_long,"SEIHDQR_9age_simulation_nyc_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_schoolclose_long<-fread("SEIHDQR_9age_simulation_nyc_schoolclose_long.csv")
#SEIHDQR_9age_simulation_nyc_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_nyc_schoolclose_long<-subset(SEIHDQR_9age_simulation_nyc_schoolclose_long, state=="I")#
Infected_9age_simulation_nyc_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_nyc_schoolclose_long,"Infected_9age_simulation_nyc_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_nyc_50work_long <- SEIHDQR_9age_simulation_nyc_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_50work_long <- cbind(SEIHDQR_9age_simulation_nyc_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_50work_long,"SEIHDQR_9age_simulation_nyc_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_50work_long<-fread("SEIHDQR_9age_simulation_nyc_50work_long.csv")

Infected_9age_simulation_nyc_50work_long<-subset(SEIHDQR_9age_simulation_nyc_50work_long, state=="I")#
Infected_9age_simulation_nyc_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_nyc_50work_long,"Infected_9age_simulation_nyc_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_nyc_80work_long <- SEIHDQR_9age_simulation_nyc_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_80work_long <- cbind(SEIHDQR_9age_simulation_nyc_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_80work_long,"SEIHDQR_9age_simulation_nyc_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_80work_long<-fread("SEIHDQR_9age_simulation_nyc_80work_long.csv")

Infected_9age_simulation_nyc_80work_long<-subset(SEIHDQR_9age_simulation_nyc_80work_long, state=="I")#
Infected_9age_simulation_nyc_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_nyc_80work_long,"Infected_9age_simulation_nyc_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_nyc_50other_long <- SEIHDQR_9age_simulation_nyc_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_50other_long <- cbind(SEIHDQR_9age_simulation_nyc_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_50other_long,"SEIHDQR_9age_simulation_nyc_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_50other_long<-fread("SEIHDQR_9age_simulation_nyc_50other_long.csv")

Infected_9age_simulation_nyc_50other_long<-subset(SEIHDQR_9age_simulation_nyc_50other_long, state=="I")#
Infected_9age_simulation_nyc_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_nyc_50other_long,"Infected_9age_simulation_nyc_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_nyc_20other_long <- SEIHDQR_9age_simulation_nyc_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_20other_long <- cbind(SEIHDQR_9age_simulation_nyc_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_20other_long,"SEIHDQR_9age_simulation_nyc_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_20other_long<-fread("SEIHDQR_9age_simulation_nyc_20other_long.csv")

Infected_9age_simulation_nyc_20other_long<-subset(SEIHDQR_9age_simulation_nyc_20other_long, state=="I")#
Infected_9age_simulation_nyc_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_nyc_20other_long,"Infected_9age_simulation_nyc_20other_long.csv",row.names = F)

#10quarantine plots
SEIHDQR_9age_simulation_nyc_10quarantine_long <- SEIHDQR_9age_simulation_nyc_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_10quarantine_long <- cbind(SEIHDQR_9age_simulation_nyc_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_10quarantine_long,"SEIHDQR_9age_simulation_nyc_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_10quarantine_long<-fread("SEIHDQR_9age_simulation_nyc_10quarantine_long.csv")

Infected_9age_simulation_nyc_10quarantine_long<-subset(SEIHDQR_9age_simulation_nyc_10quarantine_long, state=="I")#
Infected_9age_simulation_nyc_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_nyc_10quarantine_long,"Infected_9age_simulation_nyc_10quarantine_long.csv",row.names = F)

#borderclosure plots
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long <- SEIHDQR_9age_simulation_nyc_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long,"SEIHDQR_9age_simulation_nyc_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_nyc_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_nyc_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_nyc_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_nyc_inter_borderclosure_long,"Infected_9age_simulation_nyc_inter_borderclosure_long.csv",row.names = F)
# 
#city lockdown plots
SEIHDQR_9age_simulation_nyc_city_lockdown_long <- SEIHDQR_9age_simulation_nyc_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_nyc_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_city_lockdown_long,"SEIHDQR_9age_simulation_nyc_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_city_lockdown_long<-fread("SEIHDQR_9age_simulation_nyc_city_lockdown_long.csv")

Infected_9age_simulation_nyc_city_lockdown_long<-subset(SEIHDQR_9age_simulation_nyc_city_lockdown_long, state=="I")#
Infected_9age_simulation_nyc_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_nyc_city_lockdown_long,"Infected_9age_simulation_nyc_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_nyc_combined_long <- SEIHDQR_9age_simulation_nyc_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_combined_long <- cbind(SEIHDQR_9age_simulation_nyc_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_combined_long,"SEIHDQR_9age_simulation_nyc_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_combined_long<-fread("SEIHDQR_9age_simulation_nyc_combined_long.csv")
Infected_9age_simulation_nyc_combined_long<-subset(SEIHDQR_9age_simulation_nyc_combined_long, state=="I")#
Infected_9age_simulation_nyc_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_nyc_combined_long,"Infected_9age_simulation_nyc_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_nyc_nointer_long <- SEIHDQR_9age_simulation_nyc_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_nointer_long <- cbind(SEIHDQR_9age_simulation_nyc_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_nointer_long,"SEIHDQR_9age_simulation_nyc_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_nyc_nointer_long<-fread("SEIHDQR_9age_simulation_nyc_nointer_long.csv")
Infected_9age_simulation_nyc_nointer_long<-subset(SEIHDQR_9age_simulation_nyc_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_nyc_nointer_long,"Infected_9age_simulation_nyc_nointer_long.csv",row.names = F)


infected_9age_estimate_nyc_scenarios <- rbind(Infected_9age_simulation_nyc_schoolclose_long, Infected_9age_simulation_nyc_50work_long, Infected_9age_simulation_nyc_80work_long, Infected_9age_simulation_nyc_50other_long, Infected_9age_simulation_nyc_20other_long, Infected_9age_simulation_nyc_10quarantine_long,Infected_9age_simulation_nyc_city_lockdown_long, Infected_9age_simulation_nyc_combined_long)# Infected_9age_simulation_nyc_inter_borderclosure_long,

infected_9age_estimate_nyc_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_nyc_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_nyc_nointer_long$period <- NULL
Infected_9age_simulation_nyc_nointer_long$state<- NULL
names(Infected_9age_simulation_nyc_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_nyc_scenarios_nointer <- merge(infected_9age_estimate_nyc_scenarios, Infected_9age_simulation_nyc_nointer_long, by = c("time","age_group"))
infected_9age_estimate_nyc_scenarios_nointer$state <- NULL
infected_9age_estimate_nyc_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_nyc_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_nyc_scenarios_nointer_agg$policy)
infected_9age_estimate_nyc_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_nyc_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_nyc_scenarios_nointer_agg$estimate)/infected_9age_estimate_nyc_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_nyc_scenarios_nointer_agg,"infected_9age_estimate_nyc_scenarios_nointer_agg.csv",row.names = F)



SEIHDQR_9age_simulation_la_schoolclose<-fread("SEIHDQR_9age_simulation_la_schoolclose.csv")
SEIHDQR_9age_simulation_la_50work<-fread("SEIHDQR_9age_simulation_la_50work.csv")
SEIHDQR_9age_simulation_la_80work<-fread("SEIHDQR_9age_simulation_la_80work.csv")
SEIHDQR_9age_simulation_la_50other<-fread("SEIHDQR_9age_simulation_la_50other.csv")
SEIHDQR_9age_simulation_la_20other<-fread("SEIHDQR_9age_simulation_la_20other.csv")
SEIHDQR_9age_simulation_la_10quarantine<-fread("SEIHDQR_9age_simulation_la_10quarantine.csv")
#SEIHDQR_9age_simulation_la_inter_borderclosure<-fread("SEIHDQR_9age_simulation_la_inter_borderclosure.csv")
SEIHDQR_9age_simulation_la_city_lockdown<-fread("SEIHDQR_9age_simulation_la_city_lockdown.csv")
SEIHDQR_9age_simulation_la_combined<-fread("SEIHDQR_9age_simulation_la_combined.csv")
SEIHDQR_9age_simulation_la_nointer <- fread("SEIHDQR_9age_simulation_la_nointer.csv")

#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_la_schoolclose_long <- SEIHDQR_9age_simulation_la_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_schoolclose_long <- cbind(SEIHDQR_9age_simulation_la_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_schoolclose_long,"SEIHDQR_9age_simulation_la_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_schoolclose_long<-fread("SEIHDQR_9age_simulation_la_schoolclose_long.csv")
#SEIHDQR_9age_simulation_la_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_la_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_la_schoolclose_long<-subset(SEIHDQR_9age_simulation_la_schoolclose_long, state=="I")#
Infected_9age_simulation_la_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_la_schoolclose_long,"Infected_9age_simulation_la_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_la_50work_long <- SEIHDQR_9age_simulation_la_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_50work_long <- cbind(SEIHDQR_9age_simulation_la_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_50work_long,"SEIHDQR_9age_simulation_la_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_50work_long<-fread("SEIHDQR_9age_simulation_la_50work_long.csv")

Infected_9age_simulation_la_50work_long<-subset(SEIHDQR_9age_simulation_la_50work_long, state=="I")#
Infected_9age_simulation_la_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_la_50work_long,"Infected_9age_simulation_la_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_la_80work_long <- SEIHDQR_9age_simulation_la_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_80work_long <- cbind(SEIHDQR_9age_simulation_la_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_80work_long,"SEIHDQR_9age_simulation_la_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_80work_long<-fread("SEIHDQR_9age_simulation_la_80work_long.csv")

Infected_9age_simulation_la_80work_long<-subset(SEIHDQR_9age_simulation_la_80work_long, state=="I")#
Infected_9age_simulation_la_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_la_80work_long,"Infected_9age_simulation_la_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_la_50other_long <- SEIHDQR_9age_simulation_la_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_50other_long <- cbind(SEIHDQR_9age_simulation_la_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_50other_long,"SEIHDQR_9age_simulation_la_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_50other_long<-fread("SEIHDQR_9age_simulation_la_50other_long.csv")

Infected_9age_simulation_la_50other_long<-subset(SEIHDQR_9age_simulation_la_50other_long, state=="I")#
Infected_9age_simulation_la_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_la_50other_long,"Infected_9age_simulation_la_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_la_20other_long <- SEIHDQR_9age_simulation_la_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_20other_long <- cbind(SEIHDQR_9age_simulation_la_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_20other_long,"SEIHDQR_9age_simulation_la_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_20other_long<-fread("SEIHDQR_9age_simulation_la_20other_long.csv")

Infected_9age_simulation_la_20other_long<-subset(SEIHDQR_9age_simulation_la_20other_long, state=="I")#
Infected_9age_simulation_la_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_la_20other_long,"Infected_9age_simulation_la_20other_long.csv",row.names = F)


#10 quarantine plots
SEIHDQR_9age_simulation_la_10quarantine_long <- SEIHDQR_9age_simulation_la_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_10quarantine_long <- cbind(SEIHDQR_9age_simulation_la_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_10quarantine_long,"SEIHDQR_9age_simulation_la_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_10quarantine_long<-fread("SEIHDQR_9age_simulation_la_10quarantine_long.csv")

Infected_9age_simulation_la_10quarantine_long<-subset(SEIHDQR_9age_simulation_la_10quarantine_long, state=="I")#
Infected_9age_simulation_la_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_la_10quarantine_long,"Infected_9age_simulation_la_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_la_inter_borderclosure_long <- SEIHDQR_9age_simulation_la_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_la_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_la_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_la_inter_borderclosure_long,"SEIHDQR_9age_simulation_la_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_la_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_la_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_la_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_la_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_la_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_la_inter_borderclosure_long,"Infected_9age_simulation_la_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_la_city_lockdown_long <- SEIHDQR_9age_simulation_la_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_la_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_city_lockdown_long,"SEIHDQR_9age_simulation_la_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_city_lockdown_long<-fread("SEIHDQR_9age_simulation_la_city_lockdown_long.csv")

Infected_9age_simulation_la_city_lockdown_long<-subset(SEIHDQR_9age_simulation_la_city_lockdown_long, state=="I")#
Infected_9age_simulation_la_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_la_city_lockdown_long,"Infected_9age_simulation_la_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_la_combined_long <- SEIHDQR_9age_simulation_la_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_combined_long <- cbind(SEIHDQR_9age_simulation_la_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_combined_long,"SEIHDQR_9age_simulation_la_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_combined_long<-fread("SEIHDQR_9age_simulation_la_combined_long.csv")
Infected_9age_simulation_la_combined_long<-subset(SEIHDQR_9age_simulation_la_combined_long, state=="I")#
Infected_9age_simulation_la_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_la_combined_long,"Infected_9age_simulation_la_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_la_nointer_long <- SEIHDQR_9age_simulation_la_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_nointer_long <- cbind(SEIHDQR_9age_simulation_la_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_nointer_long,"SEIHDQR_9age_simulation_la_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_la_nointer_long<-fread("SEIHDQR_9age_simulation_la_nointer_long.csv")
Infected_9age_simulation_la_nointer_long<-subset(SEIHDQR_9age_simulation_la_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_la_nointer_long,"Infected_9age_simulation_la_nointer_long.csv",row.names = F)


infected_9age_estimate_la_scenarios <- rbind(Infected_9age_simulation_la_schoolclose_long, Infected_9age_simulation_la_50work_long, Infected_9age_simulation_la_80work_long, Infected_9age_simulation_la_50other_long, Infected_9age_simulation_la_20other_long, Infected_9age_simulation_la_10quarantine_long, Infected_9age_simulation_la_city_lockdown_long, Infected_9age_simulation_la_combined_long)# Infected_9age_simulation_la_inter_borderclosure_long,

infected_9age_estimate_la_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_la_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_la_nointer_long$period <- NULL
Infected_9age_simulation_la_nointer_long$state<- NULL
names(Infected_9age_simulation_la_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_la_scenarios_nointer <- merge(infected_9age_estimate_la_scenarios, Infected_9age_simulation_la_nointer_long, by = c("time","age_group"))
infected_9age_estimate_la_scenarios_nointer$state <- NULL
infected_9age_estimate_la_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_la_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_la_scenarios_nointer_agg$policy)
infected_9age_estimate_la_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_la_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_la_scenarios_nointer_agg$estimate)/infected_9age_estimate_la_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_la_scenarios_nointer_agg,"infected_9age_estimate_la_scenarios_nointer_agg.csv",row.names = F)



SEIHDQR_9age_simulation_daegu_schoolclose<-fread("SEIHDQR_9age_simulation_daegu_schoolclose.csv")
SEIHDQR_9age_simulation_daegu_50work<-fread("SEIHDQR_9age_simulation_daegu_50work.csv")
SEIHDQR_9age_simulation_daegu_80work<-fread("SEIHDQR_9age_simulation_daegu_80work.csv")
SEIHDQR_9age_simulation_daegu_50other<-fread("SEIHDQR_9age_simulation_daegu_50other.csv")
SEIHDQR_9age_simulation_daegu_20other<-fread("SEIHDQR_9age_simulation_daegu_20other.csv")
SEIHDQR_9age_simulation_daegu_10quarantine<-fread("SEIHDQR_9age_simulation_daegu_10quarantine.csv")
#SEIHDQR_9age_simulation_daegu_inter_borderclosure<-fread("SEIHDQR_9age_simulation_daegu_inter_borderclosure.csv")
SEIHDQR_9age_simulation_daegu_city_lockdown<-fread("SEIHDQR_9age_simulation_daegu_city_lockdown.csv")
SEIHDQR_9age_simulation_daegu_combined<-fread("SEIHDQR_9age_simulation_daegu_combined.csv")
SEIHDQR_9age_simulation_daegu_nointer <- fread("SEIHDQR_9age_simulation_daegu_nointer.csv")

#plot specific measure


#school close plots
SEIHDQR_9age_simulation_daegu_schoolclose_long <- SEIHDQR_9age_simulation_daegu_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_schoolclose_long <- cbind(SEIHDQR_9age_simulation_daegu_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_schoolclose_long,"SEIHDQR_9age_simulation_daegu_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_schoolclose_long<-fread("SEIHDQR_9age_simulation_daegu_schoolclose_long.csv")
#SEIHDQR_9age_simulation_daegu_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_daegu_schoolclose_long<-subset(SEIHDQR_9age_simulation_daegu_schoolclose_long, state=="I")#
Infected_9age_simulation_daegu_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_daegu_schoolclose_long,"Infected_9age_simulation_daegu_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_daegu_50work_long <- SEIHDQR_9age_simulation_daegu_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_50work_long <- cbind(SEIHDQR_9age_simulation_daegu_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_50work_long,"SEIHDQR_9age_simulation_daegu_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_50work_long<-fread("SEIHDQR_9age_simulation_daegu_50work_long.csv")

Infected_9age_simulation_daegu_50work_long<-subset(SEIHDQR_9age_simulation_daegu_50work_long, state=="I")#
Infected_9age_simulation_daegu_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_daegu_50work_long,"Infected_9age_simulation_daegu_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_daegu_80work_long <- SEIHDQR_9age_simulation_daegu_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_80work_long <- cbind(SEIHDQR_9age_simulation_daegu_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_80work_long,"SEIHDQR_9age_simulation_daegu_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_80work_long<-fread("SEIHDQR_9age_simulation_daegu_80work_long.csv")

Infected_9age_simulation_daegu_80work_long<-subset(SEIHDQR_9age_simulation_daegu_80work_long, state=="I")#
Infected_9age_simulation_daegu_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_daegu_80work_long,"Infected_9age_simulation_daegu_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_daegu_50other_long <- SEIHDQR_9age_simulation_daegu_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_50other_long <- cbind(SEIHDQR_9age_simulation_daegu_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_50other_long,"SEIHDQR_9age_simulation_daegu_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_50other_long<-fread("SEIHDQR_9age_simulation_daegu_50other_long.csv")

Infected_9age_simulation_daegu_50other_long<-subset(SEIHDQR_9age_simulation_daegu_50other_long, state=="I")#
Infected_9age_simulation_daegu_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_daegu_50other_long,"Infected_9age_simulation_daegu_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_daegu_20other_long <- SEIHDQR_9age_simulation_daegu_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_20other_long <- cbind(SEIHDQR_9age_simulation_daegu_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_20other_long,"SEIHDQR_9age_simulation_daegu_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_20other_long<-fread("SEIHDQR_9age_simulation_daegu_20other_long.csv")

Infected_9age_simulation_daegu_20other_long<-subset(SEIHDQR_9age_simulation_daegu_20other_long, state=="I")#
Infected_9age_simulation_daegu_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_daegu_20other_long,"Infected_9age_simulation_daegu_20other_long.csv",row.names = F)

#10 quarantine plots
SEIHDQR_9age_simulation_daegu_10quarantine_long <- SEIHDQR_9age_simulation_daegu_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_10quarantine_long <- cbind(SEIHDQR_9age_simulation_daegu_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_10quarantine_long,"SEIHDQR_9age_simulation_daegu_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_10quarantine_long<-fread("SEIHDQR_9age_simulation_daegu_10quarantine_long.csv")

Infected_9age_simulation_daegu_10quarantine_long<-subset(SEIHDQR_9age_simulation_daegu_10quarantine_long, state=="I")#
Infected_9age_simulation_daegu_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_daegu_10quarantine_long,"Infected_9age_simulation_daegu_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long <- SEIHDQR_9age_simulation_daegu_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long,"SEIHDQR_9age_simulation_daegu_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_daegu_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_daegu_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_daegu_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_daegu_inter_borderclosure_long,"Infected_9age_simulation_daegu_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_daegu_city_lockdown_long <- SEIHDQR_9age_simulation_daegu_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_daegu_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_city_lockdown_long,"SEIHDQR_9age_simulation_daegu_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_city_lockdown_long<-fread("SEIHDQR_9age_simulation_daegu_city_lockdown_long.csv")

Infected_9age_simulation_daegu_city_lockdown_long<-subset(SEIHDQR_9age_simulation_daegu_city_lockdown_long, state=="I")#
Infected_9age_simulation_daegu_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_daegu_city_lockdown_long,"Infected_9age_simulation_daegu_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_daegu_combined_long <- SEIHDQR_9age_simulation_daegu_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_combined_long <- cbind(SEIHDQR_9age_simulation_daegu_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_combined_long,"SEIHDQR_9age_simulation_daegu_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_combined_long<-fread("SEIHDQR_9age_simulation_daegu_combined_long.csv")
Infected_9age_simulation_daegu_combined_long<-subset(SEIHDQR_9age_simulation_daegu_combined_long, state=="I")#
Infected_9age_simulation_daegu_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_daegu_combined_long,"Infected_9age_simulation_daegu_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_daegu_nointer_long <- SEIHDQR_9age_simulation_daegu_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_nointer_long <- cbind(SEIHDQR_9age_simulation_daegu_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_nointer_long,"SEIHDQR_9age_simulation_daegu_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_daegu_nointer_long<-fread("SEIHDQR_9age_simulation_daegu_nointer_long.csv")
Infected_9age_simulation_daegu_nointer_long<-subset(SEIHDQR_9age_simulation_daegu_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_daegu_nointer_long,"Infected_9age_simulation_daegu_nointer_long.csv",row.names = F)


infected_9age_estimate_daegu_scenarios <- rbind(Infected_9age_simulation_daegu_schoolclose_long, Infected_9age_simulation_daegu_50work_long, Infected_9age_simulation_daegu_80work_long, Infected_9age_simulation_daegu_50other_long, Infected_9age_simulation_daegu_20other_long, Infected_9age_simulation_daegu_10quarantine_long, Infected_9age_simulation_daegu_city_lockdown_long, Infected_9age_simulation_daegu_combined_long) # Infected_9age_simulation_daegu_inter_borderclosure_long,

infected_9age_estimate_daegu_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_daegu_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_daegu_nointer_long$period <- NULL
Infected_9age_simulation_daegu_nointer_long$state<- NULL
names(Infected_9age_simulation_daegu_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_daegu_scenarios_nointer <- merge(infected_9age_estimate_daegu_scenarios, Infected_9age_simulation_daegu_nointer_long, by = c("time","age_group"))
infected_9age_estimate_daegu_scenarios_nointer$state <- NULL
infected_9age_estimate_daegu_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_daegu_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_daegu_scenarios_nointer_agg$policy)
infected_9age_estimate_daegu_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_daegu_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_daegu_scenarios_nointer_agg$estimate)/infected_9age_estimate_daegu_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_daegu_scenarios_nointer_agg,"infected_9age_estimate_daegu_scenarios_nointer_agg.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_schoolclose<-fread("SEIHDQR_9age_simulation_nairobi_schoolclose.csv")
SEIHDQR_9age_simulation_nairobi_50work<-fread("SEIHDQR_9age_simulation_nairobi_50work.csv")
SEIHDQR_9age_simulation_nairobi_80work<-fread("SEIHDQR_9age_simulation_nairobi_80work.csv")
SEIHDQR_9age_simulation_nairobi_50other<-fread("SEIHDQR_9age_simulation_nairobi_50other.csv")
SEIHDQR_9age_simulation_nairobi_20other<-fread("SEIHDQR_9age_simulation_nairobi_20other.csv")
SEIHDQR_9age_simulation_nairobi_10quarantine<-fread("SEIHDQR_9age_simulation_nairobi_10quarantine.csv")
#SEIHDQR_9age_simulation_nairobi_inter_borderclosure<-fread("SEIHDQR_9age_simulation_nairobi_inter_borderclosure.csv")
SEIHDQR_9age_simulation_nairobi_city_lockdown<-fread("SEIHDQR_9age_simulation_nairobi_city_lockdown.csv")
SEIHDQR_9age_simulation_nairobi_combined<-fread("SEIHDQR_9age_simulation_nairobi_combined.csv")
SEIHDQR_9age_simulation_nairobi_nointer <- fread("SEIHDQR_9age_simulation_nairobi_nointer.csv")
#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_nairobi_schoolclose_long <- SEIHDQR_9age_simulation_nairobi_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_schoolclose_long <- cbind(SEIHDQR_9age_simulation_nairobi_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_schoolclose_long,"SEIHDQR_9age_simulation_nairobi_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_schoolclose_long<-fread("SEIHDQR_9age_simulation_nairobi_schoolclose_long.csv")
#SEIHDQR_9age_simulation_nairobi_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_nairobi_schoolclose_long<-subset(SEIHDQR_9age_simulation_nairobi_schoolclose_long, state=="I")#
Infected_9age_simulation_nairobi_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_nairobi_schoolclose_long,"Infected_9age_simulation_nairobi_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_nairobi_50work_long <- SEIHDQR_9age_simulation_nairobi_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_50work_long <- cbind(SEIHDQR_9age_simulation_nairobi_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_50work_long,"SEIHDQR_9age_simulation_nairobi_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_50work_long<-fread("SEIHDQR_9age_simulation_nairobi_50work_long.csv")

Infected_9age_simulation_nairobi_50work_long<-subset(SEIHDQR_9age_simulation_nairobi_50work_long, state=="I")#
Infected_9age_simulation_nairobi_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_nairobi_50work_long,"Infected_9age_simulation_nairobi_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_nairobi_80work_long <- SEIHDQR_9age_simulation_nairobi_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_80work_long <- cbind(SEIHDQR_9age_simulation_nairobi_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_80work_long,"SEIHDQR_9age_simulation_nairobi_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_80work_long<-fread("SEIHDQR_9age_simulation_nairobi_80work_long.csv")

Infected_9age_simulation_nairobi_80work_long<-subset(SEIHDQR_9age_simulation_nairobi_80work_long, state=="I")#
Infected_9age_simulation_nairobi_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_nairobi_80work_long,"Infected_9age_simulation_nairobi_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_nairobi_50other_long <- SEIHDQR_9age_simulation_nairobi_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_50other_long <- cbind(SEIHDQR_9age_simulation_nairobi_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_50other_long,"SEIHDQR_9age_simulation_nairobi_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_50other_long<-fread("SEIHDQR_9age_simulation_nairobi_50other_long.csv")

Infected_9age_simulation_nairobi_50other_long<-subset(SEIHDQR_9age_simulation_nairobi_50other_long, state=="I")#
Infected_9age_simulation_nairobi_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_nairobi_50other_long,"Infected_9age_simulation_nairobi_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_nairobi_20other_long <- SEIHDQR_9age_simulation_nairobi_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_20other_long <- cbind(SEIHDQR_9age_simulation_nairobi_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_20other_long,"SEIHDQR_9age_simulation_nairobi_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_20other_long<-fread("SEIHDQR_9age_simulation_nairobi_20other_long.csv")

Infected_9age_simulation_nairobi_20other_long<-subset(SEIHDQR_9age_simulation_nairobi_20other_long, state=="I")#
Infected_9age_simulation_nairobi_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_nairobi_20other_long,"Infected_9age_simulation_nairobi_20other_long.csv",row.names = F)

#10 quarantine plots
SEIHDQR_9age_simulation_nairobi_10quarantine_long <- SEIHDQR_9age_simulation_nairobi_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_10quarantine_long <- cbind(SEIHDQR_9age_simulation_nairobi_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_10quarantine_long,"SEIHDQR_9age_simulation_nairobi_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_10quarantine_long<-fread("SEIHDQR_9age_simulation_nairobi_10quarantine_long.csv")

Infected_9age_simulation_nairobi_10quarantine_long<-subset(SEIHDQR_9age_simulation_nairobi_10quarantine_long, state=="I")#
Infected_9age_simulation_nairobi_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_nairobi_10quarantine_long,"Infected_9age_simulation_nairobi_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long <- SEIHDQR_9age_simulation_nairobi_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long,"SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_nairobi_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_nairobi_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_nairobi_inter_borderclosure_long,"Infected_9age_simulation_nairobi_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_nairobi_city_lockdown_long <- SEIHDQR_9age_simulation_nairobi_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_nairobi_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_city_lockdown_long,"SEIHDQR_9age_simulation_nairobi_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_city_lockdown_long<-fread("SEIHDQR_9age_simulation_nairobi_city_lockdown_long.csv")

Infected_9age_simulation_nairobi_city_lockdown_long<-subset(SEIHDQR_9age_simulation_nairobi_city_lockdown_long, state=="I")#
Infected_9age_simulation_nairobi_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_nairobi_city_lockdown_long,"Infected_9age_simulation_nairobi_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_nairobi_combined_long <- SEIHDQR_9age_simulation_nairobi_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_combined_long <- cbind(SEIHDQR_9age_simulation_nairobi_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_combined_long,"SEIHDQR_9age_simulation_nairobi_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_combined_long<-fread("SEIHDQR_9age_simulation_nairobi_combined_long.csv")
Infected_9age_simulation_nairobi_combined_long<-subset(SEIHDQR_9age_simulation_nairobi_combined_long, state=="I")#
Infected_9age_simulation_nairobi_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_nairobi_combined_long,"Infected_9age_simulation_nairobi_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_nairobi_nointer_long <- SEIHDQR_9age_simulation_nairobi_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_nointer_long <- cbind(SEIHDQR_9age_simulation_nairobi_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_nointer_long,"SEIHDQR_9age_simulation_nairobi_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_nairobi_nointer_long<-fread("SEIHDQR_9age_simulation_nairobi_nointer_long.csv")
Infected_9age_simulation_nairobi_nointer_long<-subset(SEIHDQR_9age_simulation_nairobi_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_nairobi_nointer_long,"Infected_9age_simulation_nairobi_nointer_long.csv",row.names = F)


infected_9age_estimate_nairobi_scenarios <- rbind(Infected_9age_simulation_nairobi_schoolclose_long, Infected_9age_simulation_nairobi_50work_long, Infected_9age_simulation_nairobi_80work_long, Infected_9age_simulation_nairobi_50other_long, Infected_9age_simulation_nairobi_20other_long, Infected_9age_simulation_nairobi_10quarantine_long, Infected_9age_simulation_nairobi_city_lockdown_long, Infected_9age_simulation_nairobi_combined_long)#Infected_9age_simulation_nairobi_inter_borderclosure_long,

infected_9age_estimate_nairobi_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_nairobi_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_nairobi_nointer_long$period <- NULL
Infected_9age_simulation_nairobi_nointer_long$state<- NULL
names(Infected_9age_simulation_nairobi_nointer_long)[2] <- "estimate_nointer"
Infected_9age_simulation_nairobi_nointer_long$age_group <- as.integer(Infected_9age_simulation_nairobi_nointer_long$age_group)
infected_9age_estimate_nairobi_scenarios$age_group <- as.integer(infected_9age_estimate_nairobi_scenarios$age_group)
infected_9age_estimate_nairobi_scenarios_nointer <- merge(infected_9age_estimate_nairobi_scenarios, Infected_9age_simulation_nairobi_nointer_long, by = c("time","age_group"))
infected_9age_estimate_nairobi_scenarios_nointer$state <- NULL
infected_9age_estimate_nairobi_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_nairobi_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_nairobi_scenarios_nointer_agg$policy)
infected_9age_estimate_nairobi_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate)/infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_nairobi_scenarios_nointer_agg,"infected_9age_estimate_nairobi_scenarios_nointer_agg.csv",row.names = F)





infected_9age_estimate_nyc_scenarios_nointer_agg<-fread("infected_9age_estimate_nyc_scenarios_nointer_agg.csv")
infected_9age_estimate_la_scenarios_nointer_agg<-fread("infected_9age_estimate_la_scenarios_nointer_agg.csv")
infected_9age_estimate_daegu_scenarios_nointer_agg<-fread("infected_9age_estimate_daegu_scenarios_nointer_agg.csv")
infected_9age_estimate_nairobi_scenarios_nointer_agg<-fread("infected_9age_estimate_nairobi_scenarios_nointer_agg.csv")
infected_9age_estimate_nyc_scenarios_nointer_agg$city <- "New York"
infected_9age_estimate_la_scenarios_nointer_agg$city <- "Los Angeles"
infected_9age_estimate_daegu_scenarios_nointer_agg$city <- "Daegu"
infected_9age_estimate_nairobi_scenarios_nointer_agg$city <- "Nairobi"

#unique(infected_9age_estimate_scenario_fourcities$policy)

infected_9age_estimate_scenario_fourcities <- rbind(infected_9age_estimate_nyc_scenarios_nointer_agg,infected_9age_estimate_la_scenarios_nointer_agg,infected_9age_estimate_daegu_scenarios_nointer_agg,infected_9age_estimate_nairobi_scenarios_nointer_agg)
neworder<-c("School close","50% working from home","80% working from home","50% other mobility","20% other mobility","10% quarantine", "City lockdown","Combined policy")#"Border closure",
neworder_age<-c(1,2,3,4,5,6,7,8,9)

infected_9age_estimate_scenario_fourcities_old <- infected_9age_estimate_scenario_fourcities
infected_9age_estimate_scenario_fourcities_old$scenario <- "50% contact reduction in the old"
write.csv(infected_9age_estimate_scenario_fourcities_old,"infected_9age_estimate_scenario_fourcities_old.csv",row.names = F)

library(viridis)
infected_9age_estimate_scenario_fourcities$policy<-factor(infected_9age_estimate_scenario_fourcities$policy, levels=neworder)
infected_9age_estimate_scenario_fourcities$age_group<-factor(infected_9age_estimate_scenario_fourcities$age_group, levels=neworder_age, labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
# infected_9age_estimate_scenario_fourcities$avoided_effect <- ifelse(infected_9age_estimate_scenario_fourcities$avoided_effect<0,0,infected_9age_estimate_scenario_fourcities$avoided_effect)
infected_9age_estimate_scenario_fourcities_agg<- aggregate(avoided_effect~city+policy, FUN=mean, infected_9age_estimate_scenario_fourcities)
matrix_plot_infected_9age_estimate_scenario_fourcities_effectiveness <- ggplot(infected_9age_estimate_scenario_fourcities, aes(x=policy, y= age_group, fill=avoided_effect))+
  geom_tile()+
  geom_text(aes(label=round(avoided_effect,2)), color = "black", size=8)+
  #scale_fill_gradient(low="orange", high="white", limits=c(0, 1), na.value = "transparent")+
  scale_fill_viridis_c(direction = -1, option = "plasma", begin = 0.1, end = 1,limits=c(-0.2, 1), name="Effectiveness") +
  scale_x_discrete(name = "Policy")+
  scale_y_discrete(name = "Age")+
  theme(axis.title = element_text(size = 18),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 16,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=20, angle = 90),
        axis.text.y = element_text(size=20, angle = 0))+

  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  #guides(fill=guide_legend())+
  facet_wrap(.~city,nrow=2, strip.position = "left")
ggsave("matrix_plot_infected_9age_estimate_scenario_fourcities_effectiveness_old.pdf", width = 18, height = 16)


```



```{r interventions effects of school closure/working home/other mobility/quarantine targeting old and young}

#contact matrix package
contact_matrix_9age_nyc <-readRDS("contact_matrix_9age_ny.rds")
contact_matrix_9age_la <-readRDS("contact_matrix_9age_la.rds")
contact_matrix_9age_daegu <-readRDS("contact_matrix_9age_daegu.rds")
contact_matrix_9age_nairobi <-readRDS("contact_matrix_9age_nairobi.rds")

#=============================protect the young+old strategy================================
library(gdata)
#contact matrix policy package 1: school close
#create block matrix


mm1 <- matrix(0.5, nrow=2, ncol=2)
mm2 <- matrix(1, nrow = 4, ncol=2)
mm3 <- matrix(0.5, nrow = 3, ncol=2)
mm4 <- matrix(1, nrow=6, ncol=4)
mm5 <- matrix(0.5, nrow=3, ncol=4)
mm6 <- matrix(0.5, nrow=9, ncol=3)
old_young_matrix1 <- rbind(mm1,mm2,mm3)
old_young_matrix2 <- rbind(mm4, mm5)
old_young_matrix <- cbind(old_young_matrix1,old_young_matrix2,mm6)


contact.matrix_package1_nairobi<-list(contact_matrix_9age_nairobi$home *old_young_matrix,contact_matrix_9age_nairobi$school*0*old_young_matrix,contact_matrix_9age_nairobi$work*old_young_matrix,contact_matrix_9age_nairobi$other*old_young_matrix)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_nairobi<-list(contact_matrix_9age_nairobi$home*old_young_matrix,contact_matrix_9age_nairobi$school*old_young_matrix,contact_matrix_9age_nairobi$work*0.5*old_young_matrix,contact_matrix_9age_nairobi$other*old_young_matrix)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_nairobi<-list(contact_matrix_9age_nairobi$home*old_young_matrix,contact_matrix_9age_nairobi$school*old_young_matrix,contact_matrix_9age_nairobi$work*0.2*old_young_matrix,contact_matrix_9age_nairobi$other*old_young_matrix)
#contact matrix policy package 4: 50% other
contact.matrix_package4_nairobi<-list(contact_matrix_9age_nairobi$home*old_young_matrix,contact_matrix_9age_nairobi$school*old_young_matrix,contact_matrix_9age_nairobi$work*old_young_matrix,contact_matrix_9age_nairobi$other*0.5*old_young_matrix)
#contact matrix policy package 5: 20% other
contact.matrix_package5_nairobi<-list(contact_matrix_9age_nairobi$home*old_young_matrix,contact_matrix_9age_nairobi$school*old_young_matrix,contact_matrix_9age_nairobi$work*old_young_matrix,contact_matrix_9age_nairobi$other*0.2*old_young_matrix)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_nairobi<-list(contact_matrix_9age_nairobi$home*old_young_matrix,contact_matrix_9age_nairobi$school*0*old_young_matrix,contact_matrix_9age_nairobi$work*0.5*old_young_matrix,contact_matrix_9age_nairobi$other*0.5*old_young_matrix)
#contact matrix policy package 7: 
contact.matrix_10quarantine_nairobi<-list(contact_matrix_9age_nairobi$home*old_young_matrix,contact_matrix_9age_nairobi$school*old_young_matrix,contact_matrix_9age_nairobi$work*old_young_matrix,contact_matrix_9age_nairobi$other*old_young_matrix)


#contact matrix policy package 8: 
contact.matrix_city_lockdown_nairobi<-list(contact_matrix_9age_nairobi$home*old_young_matrix,contact_matrix_9age_nairobi$school*old_young_matrix,contact_matrix_9age_nairobi$work*old_young_matrix,contact_matrix_9age_nairobi$other*old_young_matrix)
#contact matrix policy package 9: 
contact.matrix_nointer_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other)


#contact matrix for the nyc

#contact matrix policy package 1: school close
contact.matrix_package1_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*0*old_young_matrix,contact_matrix_9age_nyc$work*old_young_matrix,contact_matrix_9age_nyc$other*old_young_matrix)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*old_young_matrix,contact_matrix_9age_nyc$work*0.5*old_young_matrix,contact_matrix_9age_nyc$other*old_young_matrix)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*old_young_matrix,contact_matrix_9age_nyc$work*0.2*old_young_matrix,contact_matrix_9age_nyc$other*old_young_matrix)
#contact matrix policy package 4: 50% other
contact.matrix_package4_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*old_young_matrix,contact_matrix_9age_nyc$work*old_young_matrix,contact_matrix_9age_nyc$other*0.5*old_young_matrix)
#contact matrix policy package 5: 20% other
contact.matrix_package5_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*old_young_matrix,contact_matrix_9age_nyc$work*old_young_matrix,contact_matrix_9age_nyc$other*0.2*old_young_matrix)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*0*old_young_matrix,contact_matrix_9age_nyc$work*0.5*old_young_matrix,contact_matrix_9age_nyc$other*0.5*old_young_matrix)
#contact matrix policy package 7: 
contact.matrix_10quarantine_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*old_young_matrix,contact_matrix_9age_nyc$work*old_young_matrix,contact_matrix_9age_nyc$other*old_young_matrix)
#contact matrix policy package 8: 
contact.matrix_city_lockdown_nyc<-list(contact_matrix_9age_nyc$home*old_young_matrix,contact_matrix_9age_nyc$school*old_young_matrix,contact_matrix_9age_nyc$work*old_young_matrix,contact_matrix_9age_nyc$other*old_young_matrix)
#contact matrix policy package 8: 
contact.matrix_nointer_nyc<-list(contact_matrix_9age_nyc$home,contact_matrix_9age_nyc$school,contact_matrix_9age_nyc$work,contact_matrix_9age_nyc$other)

#contact matrix for the la

#contact matrix policy package 1: school close
contact.matrix_package1_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*0*old_young_matrix,contact_matrix_9age_la$work*old_young_matrix,contact_matrix_9age_la$other*old_young_matrix)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*old_young_matrix,contact_matrix_9age_la$work*0.5*old_young_matrix,contact_matrix_9age_la$other*old_young_matrix)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*old_young_matrix,contact_matrix_9age_la$work*0.2*old_young_matrix,contact_matrix_9age_la$other*old_young_matrix)
#contact matrix policy package 4: 50% other
contact.matrix_package4_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*old_young_matrix,contact_matrix_9age_la$work*old_young_matrix,contact_matrix_9age_la$other*0.5*old_young_matrix)
#contact matrix policy package 5: 20% other
contact.matrix_package5_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*old_young_matrix,contact_matrix_9age_la$work*old_young_matrix,contact_matrix_9age_la$other*0.2*old_young_matrix)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*0*old_young_matrix,contact_matrix_9age_la$work*0.5*old_young_matrix, contact_matrix_9age_la$other*0.5*old_young_matrix)
#contact matrix policy package 7: 
contact.matrix_10quarantine_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*old_young_matrix,contact_matrix_9age_la$work*old_young_matrix,contact_matrix_9age_la$other*old_young_matrix)
#contact matrix policy package 8: 
contact.matrix_city_lockdown_la<-list(contact_matrix_9age_la$home*old_young_matrix,contact_matrix_9age_la$school*old_young_matrix,contact_matrix_9age_la$work*old_young_matrix,contact_matrix_9age_la$other*old_young_matrix)
#contact matrix policy package 8: 
contact.matrix_nointer_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other)

#contact matrix for the daegu

#contact matrix policy package 1: school close
contact.matrix_package1_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*0*old_young_matrix,contact_matrix_9age_daegu$work*old_young_matrix,contact_matrix_9age_daegu$other*old_young_matrix)
#contact matrix policy package 2: 50% working from home
contact.matrix_package2_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*old_young_matrix,contact_matrix_9age_daegu$work*0.5*old_young_matrix,contact_matrix_9age_daegu$other*old_young_matrix)
#contact matrix policy package 3: 80% working from home
contact.matrix_package3_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*old_young_matrix,contact_matrix_9age_daegu$work*0.2*old_young_matrix,contact_matrix_9age_daegu$other*old_young_matrix)
#contact matrix policy package 4: 50% other
contact.matrix_package4_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*old_young_matrix,contact_matrix_9age_daegu$work*old_young_matrix,contact_matrix_9age_daegu$other*0.5*old_young_matrix)
#contact matrix policy package 5: 20% other
contact.matrix_package5_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*old_young_matrix,contact_matrix_9age_daegu$work*old_young_matrix,contact_matrix_9age_daegu$other*0.2*old_young_matrix)
#contact matrix policy package 6: school close+50% working from home + 50% other mobility
contact.matrix_package6_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*0*old_young_matrix,contact_matrix_9age_daegu$work*0.5*old_young_matrix,contact_matrix_9age_daegu$other*0.5*old_young_matrix)
#contact matrix policy package 7: 
contact.matrix_10quarantine_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*old_young_matrix,contact_matrix_9age_daegu$work*old_young_matrix,contact_matrix_9age_daegu$other*old_young_matrix)
#contact matrix policy package 8: 
contact.matrix_city_lockdown_daegu<-list(contact_matrix_9age_daegu$home*old_young_matrix,contact_matrix_9age_daegu$school*old_young_matrix,contact_matrix_9age_daegu$work*old_young_matrix,contact_matrix_9age_daegu$other*old_young_matrix)
#contact matrix policy package 8: 
contact.matrix_nointer_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other)

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.



#transmissibility
transmissibility_9age_nairobi <- calculate_transimissibility(R0t = R0t_nairobi, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nairobi, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_nairobi)

transmissibility_9age_nyc <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nyc, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_nyc)

transmissibility_9age_la <- calculate_transimissibility(R0t = R0t_la, recov.rate = recov.rate, pop_age_structure = pop_age_structure_la, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_la)

transmissibility_9age_daegu <- calculate_transimissibility(R0t = R0t_daegu, recov.rate = recov.rate, pop_age_structure = pop_age_structure_daegu, calculate_transmission_probability = 1, contact.matrix = contact.matrix_nointer_daegu)


###transmission rate
transm.rate_without_intervention_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_nointer_nairobi)
saveRDS(transm.rate_without_intervention_nairobi,"transm.rate_without_intervention_nairobi_age_effect.rds")
transm.rate_package1_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package1_nairobi)
saveRDS(transm.rate_package1_nairobi,"transm.rate_package1_nairobi_age_effect.rds")
transm.rate_package2_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package2_nairobi)
saveRDS(transm.rate_package2_nairobi,"transm.rate_package2_nairobi_age_effect.rds")
transm.rate_package3_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package3_nairobi)
saveRDS(transm.rate_package3_nairobi,"transm.rate_package3_nairobi_age_effect.rds")
transm.rate_package4_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package4_nairobi)
saveRDS(transm.rate_package4_nairobi,"transm.rate_package4_nairobi_age_effect.rds")
transm.rate_package5_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package5_nairobi)
saveRDS(transm.rate_package5_nairobi,"transm.rate_package5_nairobi_age_effect.rds")
transm.rate_package6_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_package6_nairobi)
saveRDS(transm.rate_package6_nairobi,"transm.rate_package6_nairobi_age_effect.rds")
transm.rate_quarantine10_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_10quarantine_nairobi)
saveRDS(transm.rate_quarantine10_nairobi,"transm.rate_quarantine10_nairobi_age_effect.rds")
transm.rate_city_lockdown_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_city_lockdown_nairobi)
saveRDS(transm.rate_city_lockdown_nairobi,"transm.rate_city_lockdown_nairobi_age_effect.rds")

###transmission rate
transm.rate_without_intervention_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_nointer_daegu)
saveRDS(transm.rate_without_intervention_daegu,"transm.rate_without_intervention_daegu_age_effect.rds")
transm.rate_package1_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package1_daegu)
saveRDS(transm.rate_package1_daegu,"transm.rate_package1_daegu_age_effect.rds")
transm.rate_package2_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package2_daegu)
saveRDS(transm.rate_package2_daegu,"transm.rate_package2_daegu_age_effect.rds")
transm.rate_package3_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package3_daegu)
saveRDS(transm.rate_package3_daegu,"transm.rate_package3_daegu_age_effect.rds")
transm.rate_package4_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package4_daegu)
saveRDS(transm.rate_package4_daegu,"transm.rate_package4_daegu_age_effect.rds")
transm.rate_package5_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package5_daegu)
saveRDS(transm.rate_package5_daegu,"transm.rate_package5_daegu_age_effect.rds")
transm.rate_package6_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_package6_daegu)
saveRDS(transm.rate_package6_daegu,"transm.rate_package6_daegu_age_effect.rds")
transm.rate_quarantine10_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_10quarantine_daegu)
saveRDS(transm.rate_quarantine10_daegu,"transm.rate_quarantine10_daegu_age_effect.rds")
transm.rate_city_lockdown_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_city_lockdown_daegu)
saveRDS(transm.rate_city_lockdown_daegu,"transm.rate_city_lockdown_daegu_age_effect.rds")

###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_nointer_nyc)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc_age_effect.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package1_nyc)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc_age_effect.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package2_nyc)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc_age_effect.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package3_nyc)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc_age_effect.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package4_nyc)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc_age_effect.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package5_nyc)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc_age_effect.rds")
transm.rate_package6_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_package6_nyc)
saveRDS(transm.rate_package6_nyc,"transm.rate_package6_nyc_age_effect.rds")
transm.rate_quarantine10_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_10quarantine_nyc)
saveRDS(transm.rate_quarantine10_nyc,"transm.rate_quarantine10_nyc_age_effect.rds")
transm.rate_city_lockdown_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_city_lockdown_nyc)
saveRDS(transm.rate_city_lockdown_nyc,"transm.rate_city_lockdown_nyc_age_effect.rds")



###transmission rate
transm.rate_without_intervention_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_nointer_la)
saveRDS(transm.rate_without_intervention_la,"transm.rate_without_intervention_la_age_effect.rds")
transm.rate_package1_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package1_la)
saveRDS(transm.rate_package1_la,"transm.rate_package1_la_age_effect.rds")
transm.rate_package2_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package2_la)
saveRDS(transm.rate_package2_la,"transm.rate_package2_la_age_effect.rds")
transm.rate_package3_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package3_la)
saveRDS(transm.rate_package3_la,"transm.rate_package3_la_age_effect.rds")
transm.rate_package4_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package4_la)
saveRDS(transm.rate_package4_la,"transm.rate_package4_la_age_effect.rds")
transm.rate_package5_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package5_la)
saveRDS(transm.rate_package5_la,"transm.rate_package5_la_age_effect.rds")
transm.rate_package6_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_package6_la)
saveRDS(transm.rate_package6_la,"transm.rate_package6_la_age_effect.rds")
transm.rate_quarantine10_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_10quarantine_la)
saveRDS(transm.rate_quarantine10_la,"transm.rate_quarantine10_la_age_effect.rds")
transm.rate_city_lockdown_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_city_lockdown_la)
saveRDS(transm.rate_city_lockdown_la,"transm.rate_city_lockdown_la_age_effect.rds")


birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")




#para 9
hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis


tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)
#para 11
quar.rate_nairobi =c(rep(0.0001,9))
quar.rate_daegu =c(rep(0.0001,9))
quar.rate_nyc =c(rep(0.0001,9))
quar.rate_la =c(rep(0.0001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06


#without intervention
parameters_nairobi_age_effect <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)
saveRDS(parameters_nairobi_age_effect,"parameters_nairobi_age_effect.rds")

#without intervention
parameters_daegu_age_effect <- list(i.import=daegu_int_travel_import_data*tourism_age_structure,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu,
                       i.export=daegu_int_travel_export_data*tourism_age_structure,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)
saveRDS(parameters_daegu_age_effect,"parameters_daegu_age_effect.rds")

#without intervention
parameters_nyc_age_effect <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


saveRDS(parameters_nyc_age_effect,"parameters_nyc_age_effect.rds")


#without intervention
parameters_la_age_effect <- list(i.import=la_int_travel_import_data*tourism_age_structure,
                       d.import=la_dom_travel_import_data*pop_age_structure_la,
                       i.export=la_int_travel_export_data*tourism_age_structure,
                       d.export=la_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.1)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)
saveRDS(parameters_la_age_effect,"parameters_la_age_effect.rds")


#No intervention
constraint_no_intervention_nairobi<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nairobi,"constraint_no_intervention_nairobi.rds")



constraint_no_intervention_daegu<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_daegu,"constraint_no_intervention_daegu.rds")


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

constraint_no_intervention_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_la,"constraint_no_intervention_la.rds")



#intervention constraint package1
constraint_package1_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package1_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_nairobi,"constraint_package1_nairobi.rds")


constraint_package1_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package1_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_daegu,"constraint_package1_daegu.rds")

constraint_package1_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package1_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")

constraint_package1_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = transm.rate_package1_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package1_la,"constraint_package1_la.rds")



#intervention constraint package2

constraint_package2_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package2_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_nairobi,"constraint_package2_nairobi.rds")



constraint_package2_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package2_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_daegu,"constraint_package2_daegu.rds")

constraint_package2_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

constraint_package2_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package2_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package2_la,"constraint_package2_la.rds")




#intervention constraint package3

constraint_package3_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package3_nairobi/transm.rate_without_intervention_nairobi,
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_nairobi,"constraint_package3_nairobi.rds")


constraint_package3_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package3_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_daegu,"constraint_package3_daegu.rds")

constraint_package3_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

constraint_package3_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package3_la,"constraint_package3_la.rds")





#intervention constraint package4

constraint_package4_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package4_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_nairobi,"constraint_package4_nairobi.rds")


constraint_package4_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package4_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_daegu,"constraint_package4_daegu.rds")

constraint_package4_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

constraint_package4_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package4_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package4_la,"constraint_package4_la.rds")


#intervention constraint package5

constraint_package5_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package5_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_nairobi,"constraint_package5_nairobi.rds")


constraint_package5_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package5_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_daegu,"constraint_package5_daegu.rds")

constraint_package5_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")

constraint_package5_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package5_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package5_la,"constraint_package5_la.rds")


#intervention constraint package6

constraint_package6_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_package6_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_nairobi,"constraint_package6_nairobi.rds")


constraint_package6_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_package6_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_daegu,"constraint_package6_daegu.rds")

constraint_package6_nyc <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_package6_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")

constraint_package6_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_package6_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_package6_la,"constraint_package6_la.rds")


#intervention constraint quarantine10

constraint_quarantine10_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_quarantine10_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_nairobi,"constraint_quarantine10_nairobi.rds")


constraint_quarantine10_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_quarantine10_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_daegu,"constraint_quarantine10_daegu.rds")

constraint_quarantine10_nyc <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_quarantine10_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_nyc,"constraint_quarantine10_nyc.rds")

constraint_quarantine10_la <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_quarantine10_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1e04*0.1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_quarantine10_la,"constraint_quarantine10_la.rds")


#intervention constraint city borderclosure

constraint_inter_borderclosure_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_nairobi,"constraint_inter_borderclosure_nairobi.rds")


constraint_inter_borderclosure_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_daegu,"constraint_inter_borderclosure_daegu.rds")

constraint_inter_borderclosure_nyc <- list(i.import = c(rep(0,9)),
                                     d.import = c(rep(1,9)),
                                     i.export = c(rep(0,9)),
                                     d.export = c(rep(1,9)),
                                     i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_nyc,"constraint_inter_borderclosure_nyc.rds")

constraint_inter_borderclosure_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = matrix(1,9,9),#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_inter_borderclosure_la,"constraint_inter_borderclosure_la.rds")



#intervention constraint city lockdown

constraint_city_lockdown_nairobi <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                    transm.rate = transm.rate_city_lockdown_nairobi/transm.rate_without_intervention_nairobi,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_nairobi,"constraint_city_lockdown_nairobi.rds")


constraint_city_lockdown_daegu <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                  transm.rate = transm.rate_city_lockdown_daegu/transm.rate_without_intervention_daegu,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_daegu,"constraint_city_lockdown_daegu.rds")

constraint_city_lockdown_nyc <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                     i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                transm.rate = transm.rate_city_lockdown_nyc/transm.rate_without_intervention_nyc,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_nyc,"constraint_city_lockdown_nyc.rds")

constraint_city_lockdown_la <- list(i.import = c(rep(0,9)),
                                      d.import = c(rep(0,9)),
                                      i.export = c(rep(0,9)),
                                      d.export = c(rep(0,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                               transm.rate = transm.rate_city_lockdown_la/transm.rate_without_intervention_la,#transmission rate
                                         incub.rate = c(rep(1,9)),#
                                         recov.rate = c(rep(1,9)),
                                         hosp.rate = c(rep(1,9)),#hospitalization rate
                                         fatal.rate = c(rep(1,9)),
                                         quar.rate = c(rep(1,9)),
                                         death.rate = c(rep(1,9)), #death.rate,
                                         birth.rate = c(rep(1,9)),
                                         n = c(rep(1,9)))
saveRDS(constraint_city_lockdown_la,"constraint_city_lockdown_la.rds")




Enyc. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
Inyc. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- Enyc. - Inyc.,
                  E. = Inyc./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")


Ela. = pop_la*pop_age_structure_la*2e-06/incub.rate
Ila. = pop_la*pop_age_structure_la*2e-06
initials_la <- c(S. = pop_la*pop_age_structure_la- Ela. - Ila.,
                  E. = Ila./incub.rate,
                  I. = pop_la*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_la*pop_age_structure_la*2e-06)
saveRDS(initials_la,"initials_la.rds")


Edaegu. = pop_daegu*pop_age_structure_daegu*2e-06/incub.rate
Idaegu. = pop_daegu*pop_age_structure_daegu*2e-06
initials_daegu <- c(S. = pop_daegu*pop_age_structure_daegu- Edaegu. - Idaegu.,
                  E. = Idaegu./incub.rate,
                  I. = pop_daegu*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_daegu*pop_age_structure_daegu*2e-06)
saveRDS(initials_daegu,"initials_daegu.rds")

Enairobi. = pop_nairobi*pop_age_structure_nairobi*2e-06/incub.rate
Inairobi. = pop_nairobi*pop_age_structure_nairobi*2e-06
initials_nairobi <- c(S. = pop_nairobi*pop_age_structure_nairobi- Enairobi. - Inairobi.,
                  E. = Inairobi./incub.rate,
                  I. = pop_nairobi*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nairobi*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nairobi,"initials_nairobi.rds")


library(deSolve)
#no intervention

SEIHDQR_9age_simulation_nyc_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package1_nyc, constraint3 = constraint_package1_nyc, constraint4 = constraint_package1_nyc, constraint5 = constraint_package1_nyc, constraint6 = constraint_package1_nyc)

SEIHDQR_9age_simulation_nyc_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package2_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package2_nyc, constraint4 = constraint_package2_nyc, constraint5 = constraint_package2_nyc, constraint6 = constraint_package2_nyc)

SEIHDQR_9age_simulation_nyc_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package3_nyc, constraint2 = constraint_package3_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package3_nyc, constraint5 = constraint_package3_nyc, constraint6 = constraint_package3_nyc)

SEIHDQR_9age_simulation_nyc_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package4_nyc, constraint2 = constraint_package4_nyc, constraint3 = constraint_package4_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package4_nyc, constraint6 = constraint_package4_nyc)

SEIHDQR_9age_simulation_nyc_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package5_nyc, constraint2 = constraint_package5_nyc, constraint3 = constraint_package5_nyc, constraint4 = constraint_package5_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package5_nyc)

SEIHDQR_9age_simulation_nyc_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_quarantine10_nyc, constraint2 = constraint_quarantine10_nyc, constraint3 = constraint_quarantine10_nyc, constraint4 = constraint_quarantine10_nyc, constraint5 = constraint_quarantine10_nyc, constraint6 = constraint_quarantine10_nyc)


#SEIHDQR_9age_simulation_nyc_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_inter_borderclosure_nyc, constraint2 = constraint_inter_borderclosure_nyc, constraint3 = constraint_inter_borderclosure_nyc, constraint4 = constraint_inter_borderclosure_nyc, constraint5 = constraint_inter_borderclosure_nyc, constraint6 = constraint_inter_borderclosure_nyc)

SEIHDQR_9age_simulation_nyc_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_city_lockdown_nyc, constraint2 = constraint_city_lockdown_nyc, constraint3 = constraint_city_lockdown_nyc, constraint4 = constraint_city_lockdown_nyc, constraint5 = constraint_city_lockdown_nyc, constraint6 = constraint_city_lockdown_nyc)

SEIHDQR_9age_simulation_nyc_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package6_nyc, constraint2 = constraint_package6_nyc, constraint3 = constraint_package6_nyc, constraint4 = constraint_package6_nyc, constraint5 = constraint_package6_nyc, constraint6 = constraint_package6_nyc)

SEIHDQR_9age_simulation_nyc_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_age_effect, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-04-16"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_no_intervention_nyc, constraint2 = constraint_no_intervention_nyc, constraint3 = constraint_no_intervention_nyc, constraint4 = constraint_no_intervention_nyc, constraint5 = constraint_no_intervention_nyc, constraint6 = constraint_no_intervention_nyc)

write.csv(SEIHDQR_9age_simulation_nyc_schoolclose,"SEIHDQR_9age_simulation_nyc_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_50work,"SEIHDQR_9age_simulation_nyc_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_80work,"SEIHDQR_9age_simulation_nyc_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_50other,"SEIHDQR_9age_simulation_nyc_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_20other,"SEIHDQR_9age_simulation_nyc_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_10quarantine,"SEIHDQR_9age_simulation_nyc_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_nyc_inter_borderclosure,"SEIHDQR_9age_simulation_nyc_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_city_lockdown,"SEIHDQR_9age_simulation_nyc_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_combined,"SEIHDQR_9age_simulation_nyc_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nyc_nointer,"SEIHDQR_9age_simulation_nyc_nointer.csv",row.names = F)


SEIHDQR_9age_simulation_la_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package1_la, constraint3 = constraint_package1_la, constraint4 = constraint_package1_la, constraint5 = constraint_package1_la, constraint6 = constraint_package1_la)

SEIHDQR_9age_simulation_la_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package2_la, constraint2 = constraint_package2_la, constraint3 = constraint_package2_la, constraint4 = constraint_package2_la, constraint5 = constraint_package2_la, constraint6 = constraint_package2_la)

SEIHDQR_9age_simulation_la_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package3_la, constraint2 = constraint_package3_la, constraint3 = constraint_package3_la, constraint4 = constraint_package3_la, constraint5 = constraint_package3_la, constraint6 = constraint_package3_la)

SEIHDQR_9age_simulation_la_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package4_la, constraint2 = constraint_package4_la, constraint3 = constraint_package4_la, constraint4 = constraint_package4_la, constraint5 = constraint_package4_la, constraint6 = constraint_package4_la)

SEIHDQR_9age_simulation_la_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package5_la, constraint2 = constraint_package5_la, constraint3 = constraint_package5_la, constraint4 = constraint_package5_la, constraint5 = constraint_package5_la, constraint6 = constraint_package5_la)

SEIHDQR_9age_simulation_la_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_quarantine10_la, constraint2 = constraint_quarantine10_la, constraint3 = constraint_quarantine10_la, constraint4 = constraint_quarantine10_la, constraint5 = constraint_quarantine10_la, constraint6 = constraint_quarantine10_la)


#SEIHDQR_9age_simulation_la_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_inter_borderclosure_la, constraint2 = constraint_inter_borderclosure_la, constraint3 = constraint_inter_borderclosure_la, constraint4 = constraint_inter_borderclosure_la, constraint5 = constraint_inter_borderclosure_la, constraint6 = constraint_inter_borderclosure_la)

SEIHDQR_9age_simulation_la_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_city_lockdown_la, constraint2 = constraint_city_lockdown_la, constraint3 = constraint_city_lockdown_la, constraint4 = constraint_city_lockdown_la, constraint5 = constraint_city_lockdown_la, constraint6 = constraint_city_lockdown_la)

SEIHDQR_9age_simulation_la_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package6_la, constraint2 = constraint_package6_la, constraint3 = constraint_package6_la, constraint4 = constraint_package6_la, constraint5 = constraint_package6_la, constraint6 = constraint_package6_la)

SEIHDQR_9age_simulation_la_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_age_effect, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_no_intervention_la, constraint2 = constraint_no_intervention_la, constraint3 = constraint_no_intervention_la, constraint4 = constraint_no_intervention_la, constraint5 = constraint_no_intervention_la, constraint6 = constraint_no_intervention_la)

write.csv(SEIHDQR_9age_simulation_la_schoolclose,"SEIHDQR_9age_simulation_la_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_50work,"SEIHDQR_9age_simulation_la_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_80work,"SEIHDQR_9age_simulation_la_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_50other,"SEIHDQR_9age_simulation_la_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_20other,"SEIHDQR_9age_simulation_la_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_10quarantine,"SEIHDQR_9age_simulation_la_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_la_inter_borderclosure,"SEIHDQR_9age_simulation_la_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_city_lockdown,"SEIHDQR_9age_simulation_la_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_combined,"SEIHDQR_9age_simulation_la_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_la_nointer,"SEIHDQR_9age_simulation_la_nointer.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package1_daegu, constraint3 = constraint_package1_daegu, constraint4 = constraint_package1_daegu, constraint5 = constraint_package1_daegu, constraint6 = constraint_package1_daegu)

SEIHDQR_9age_simulation_daegu_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package2_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package2_daegu, constraint4 = constraint_package2_daegu, constraint5 = constraint_package2_daegu, constraint6 = constraint_package2_daegu)

SEIHDQR_9age_simulation_daegu_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package3_daegu, constraint2 = constraint_package3_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package3_daegu, constraint5 = constraint_package3_daegu, constraint6 = constraint_package3_daegu)

SEIHDQR_9age_simulation_daegu_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package4_daegu, constraint2 = constraint_package4_daegu, constraint3 = constraint_package4_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package4_daegu, constraint6 = constraint_package4_daegu)

SEIHDQR_9age_simulation_daegu_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_package5_daegu, constraint2 = constraint_package5_daegu, constraint3 = constraint_package5_daegu, constraint4 = constraint_package5_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package5_daegu)

SEIHDQR_9age_simulation_daegu_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_quarantine10_daegu, constraint2 = constraint_quarantine10_daegu, constraint3 = constraint_quarantine10_daegu, constraint4 = constraint_quarantine10_daegu, constraint5 = constraint_quarantine10_daegu, constraint6 = constraint_quarantine10_daegu)


#SEIHDQR_9age_simulation_daegu_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_inter_borderclosure_daegu, constraint2 = constraint_inter_borderclosure_daegu, constraint3 = constraint_inter_borderclosure_daegu, constraint4 = constraint_inter_borderclosure_daegu, constraint5 = constraint_inter_borderclosure_daegu, constraint6 = constraint_inter_borderclosure_daegu)

SEIHDQR_9age_simulation_daegu_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_city_lockdown_daegu, constraint2 = constraint_city_lockdown_daegu, constraint3 = constraint_city_lockdown_daegu, constraint4 = constraint_city_lockdown_daegu, constraint5 = constraint_city_lockdown_daegu, constraint6 = constraint_city_lockdown_daegu)

SEIHDQR_9age_simulation_daegu_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2020-12-19"), constraint1 = constraint_package6_daegu, constraint2 = constraint_package6_daegu, constraint3 = constraint_package6_daegu, constraint4 = constraint_package6_daegu, constraint5 = constraint_package6_daegu, constraint6 = constraint_package6_daegu)

SEIHDQR_9age_simulation_daegu_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_age_effect, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-27'), inter_start_date2 = as.Date("2020-02-04"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-19"), constraint1 = constraint_no_intervention_daegu, constraint2 = constraint_no_intervention_daegu, constraint3 = constraint_no_intervention_daegu, constraint4 = constraint_no_intervention_daegu, constraint5 = constraint_no_intervention_daegu, constraint6 = constraint_no_intervention_daegu)

write.csv(SEIHDQR_9age_simulation_daegu_schoolclose,"SEIHDQR_9age_simulation_daegu_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_50work,"SEIHDQR_9age_simulation_daegu_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_80work,"SEIHDQR_9age_simulation_daegu_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_50other,"SEIHDQR_9age_simulation_daegu_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_20other,"SEIHDQR_9age_simulation_daegu_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_10quarantine,"SEIHDQR_9age_simulation_daegu_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_daegu_inter_borderclosure,"SEIHDQR_9age_simulation_daegu_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_city_lockdown,"SEIHDQR_9age_simulation_daegu_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_combined,"SEIHDQR_9age_simulation_daegu_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_daegu_nointer,"SEIHDQR_9age_simulation_daegu_nointer.csv",row.names = F)

SEIHDQR_9age_simulation_nairobi_schoolclose <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package1_nairobi, constraint2 = constraint_package1_nairobi, constraint3 = constraint_package1_nairobi, constraint4 = constraint_package1_nairobi, constraint5 = constraint_package1_nairobi, constraint6 = constraint_package1_nairobi)

SEIHDQR_9age_simulation_nairobi_50work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package2_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package2_nairobi, constraint4 = constraint_package2_nairobi, constraint5 = constraint_package2_nairobi, constraint6 = constraint_package2_nairobi)

SEIHDQR_9age_simulation_nairobi_80work <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package3_nairobi, constraint2 = constraint_package3_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package3_nairobi, constraint5 = constraint_package3_nairobi, constraint6 = constraint_package3_nairobi)

SEIHDQR_9age_simulation_nairobi_50other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package4_nairobi, constraint2 = constraint_package4_nairobi, constraint3 = constraint_package4_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package4_nairobi, constraint6 = constraint_package4_nairobi)

SEIHDQR_9age_simulation_nairobi_20other <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package5_nairobi, constraint2 = constraint_package5_nairobi, constraint3 = constraint_package5_nairobi, constraint4 = constraint_package5_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package5_nairobi)

SEIHDQR_9age_simulation_nairobi_10quarantine <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_quarantine10_nairobi, constraint2 = constraint_quarantine10_nairobi, constraint3 = constraint_quarantine10_nairobi, constraint4 = constraint_quarantine10_nairobi, constraint5 = constraint_quarantine10_nairobi, constraint6 = constraint_quarantine10_nairobi)


#SEIHDQR_9age_simulation_nairobi_inter_borderclosure <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_inter_borderclosure_nairobi, constraint2 = constraint_inter_borderclosure_nairobi, constraint3 = constraint_inter_borderclosure_nairobi, constraint4 = constraint_inter_borderclosure_nairobi, constraint5 = constraint_inter_borderclosure_nairobi, constraint6 = constraint_inter_borderclosure_nairobi)

SEIHDQR_9age_simulation_nairobi_city_lockdown <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_city_lockdown_nairobi, constraint2 = constraint_city_lockdown_nairobi, constraint3 = constraint_city_lockdown_nairobi, constraint4 = constraint_city_lockdown_nairobi, constraint5 = constraint_city_lockdown_nairobi, constraint6 = constraint_city_lockdown_nairobi)

SEIHDQR_9age_simulation_nairobi_combined <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_package6_nairobi, constraint2 = constraint_package6_nairobi, constraint3 = constraint_package6_nairobi, constraint4 = constraint_package6_nairobi, constraint5 = constraint_package6_nairobi, constraint6 = constraint_package6_nairobi)

SEIHDQR_9age_simulation_nairobi_nointer <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_age_effect, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-20'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-01"),inter_end_date6 = as.Date("2021-03-12"), constraint1 = constraint_no_intervention_nairobi, constraint2 = constraint_no_intervention_nairobi, constraint3 = constraint_no_intervention_nairobi, constraint4 = constraint_no_intervention_nairobi, constraint5 = constraint_no_intervention_nairobi, constraint6 = constraint_no_intervention_nairobi)


write.csv(SEIHDQR_9age_simulation_nairobi_schoolclose,"SEIHDQR_9age_simulation_nairobi_schoolclose.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_50work,"SEIHDQR_9age_simulation_nairobi_50work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_80work,"SEIHDQR_9age_simulation_nairobi_80work.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_50other,"SEIHDQR_9age_simulation_nairobi_50other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_20other,"SEIHDQR_9age_simulation_nairobi_20other.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_10quarantine,"SEIHDQR_9age_simulation_nairobi_10quarantine.csv",row.names = F)
#write.csv(SEIHDQR_9age_simulation_nairobi_inter_borderclosure,"SEIHDQR_9age_simulation_nairobi_inter_borderclosure.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_city_lockdown,"SEIHDQR_9age_simulation_nairobi_city_lockdown.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_combined,"SEIHDQR_9age_simulation_nairobi_combined.csv",row.names = F)
write.csv(SEIHDQR_9age_simulation_nairobi_nointer,"SEIHDQR_9age_simulation_nairobi_nointer.csv",row.names = F)



```



```{r young+old  plots for age-specific policy effects}


SEIHDQR_9age_simulation_nyc_schoolclose<-fread("SEIHDQR_9age_simulation_nyc_schoolclose.csv")
SEIHDQR_9age_simulation_nyc_50work<-fread("SEIHDQR_9age_simulation_nyc_50work.csv")
SEIHDQR_9age_simulation_nyc_80work<-fread("SEIHDQR_9age_simulation_nyc_80work.csv")
SEIHDQR_9age_simulation_nyc_50other<-fread("SEIHDQR_9age_simulation_nyc_50other.csv")
SEIHDQR_9age_simulation_nyc_20other<-fread("SEIHDQR_9age_simulation_nyc_20other.csv")
SEIHDQR_9age_simulation_nyc_10quarantine<-fread("SEIHDQR_9age_simulation_nyc_10quarantine.csv")
#SEIHDQR_9age_simulation_nyc_inter_borderclosure<-fread("SEIHDQR_9age_simulation_nyc_inter_borderclosure.csv")
SEIHDQR_9age_simulation_nyc_city_lockdown<-fread("SEIHDQR_9age_simulation_nyc_city_lockdown.csv")
SEIHDQR_9age_simulation_nyc_combined<-fread("SEIHDQR_9age_simulation_nyc_combined.csv")
SEIHDQR_9age_simulation_nyc_nointer<-fread("SEIHDQR_9age_simulation_nyc_nointer.csv")

#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_nyc_schoolclose_long <- SEIHDQR_9age_simulation_nyc_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_schoolclose_long <- cbind(SEIHDQR_9age_simulation_nyc_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_schoolclose_long,"SEIHDQR_9age_simulation_nyc_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_schoolclose_long<-fread("SEIHDQR_9age_simulation_nyc_schoolclose_long.csv")
#SEIHDQR_9age_simulation_nyc_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_nyc_schoolclose_long<-subset(SEIHDQR_9age_simulation_nyc_schoolclose_long, state=="I")#
Infected_9age_simulation_nyc_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_nyc_schoolclose_long,"Infected_9age_simulation_nyc_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_nyc_50work_long <- SEIHDQR_9age_simulation_nyc_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_50work_long <- cbind(SEIHDQR_9age_simulation_nyc_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_50work_long,"SEIHDQR_9age_simulation_nyc_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_50work_long<-fread("SEIHDQR_9age_simulation_nyc_50work_long.csv")

Infected_9age_simulation_nyc_50work_long<-subset(SEIHDQR_9age_simulation_nyc_50work_long, state=="I")#
Infected_9age_simulation_nyc_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_nyc_50work_long,"Infected_9age_simulation_nyc_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_nyc_80work_long <- SEIHDQR_9age_simulation_nyc_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_80work_long <- cbind(SEIHDQR_9age_simulation_nyc_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_80work_long,"SEIHDQR_9age_simulation_nyc_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_80work_long<-fread("SEIHDQR_9age_simulation_nyc_80work_long.csv")

Infected_9age_simulation_nyc_80work_long<-subset(SEIHDQR_9age_simulation_nyc_80work_long, state=="I")#
Infected_9age_simulation_nyc_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_nyc_80work_long,"Infected_9age_simulation_nyc_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_nyc_50other_long <- SEIHDQR_9age_simulation_nyc_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_50other_long <- cbind(SEIHDQR_9age_simulation_nyc_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_50other_long,"SEIHDQR_9age_simulation_nyc_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_50other_long<-fread("SEIHDQR_9age_simulation_nyc_50other_long.csv")

Infected_9age_simulation_nyc_50other_long<-subset(SEIHDQR_9age_simulation_nyc_50other_long, state=="I")#
Infected_9age_simulation_nyc_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_nyc_50other_long,"Infected_9age_simulation_nyc_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_nyc_20other_long <- SEIHDQR_9age_simulation_nyc_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_20other_long <- cbind(SEIHDQR_9age_simulation_nyc_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_20other_long,"SEIHDQR_9age_simulation_nyc_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_20other_long<-fread("SEIHDQR_9age_simulation_nyc_20other_long.csv")

Infected_9age_simulation_nyc_20other_long<-subset(SEIHDQR_9age_simulation_nyc_20other_long, state=="I")#
Infected_9age_simulation_nyc_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_nyc_20other_long,"Infected_9age_simulation_nyc_20other_long.csv",row.names = F)

#10quarantine plots
SEIHDQR_9age_simulation_nyc_10quarantine_long <- SEIHDQR_9age_simulation_nyc_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_10quarantine_long <- cbind(SEIHDQR_9age_simulation_nyc_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_10quarantine_long,"SEIHDQR_9age_simulation_nyc_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_10quarantine_long<-fread("SEIHDQR_9age_simulation_nyc_10quarantine_long.csv")

Infected_9age_simulation_nyc_10quarantine_long<-subset(SEIHDQR_9age_simulation_nyc_10quarantine_long, state=="I")#
Infected_9age_simulation_nyc_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_nyc_10quarantine_long,"Infected_9age_simulation_nyc_10quarantine_long.csv",row.names = F)

#borderclosure plots
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long <- SEIHDQR_9age_simulation_nyc_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long,"SEIHDQR_9age_simulation_nyc_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_nyc_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_nyc_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_nyc_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_nyc_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_nyc_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_nyc_inter_borderclosure_long,"Infected_9age_simulation_nyc_inter_borderclosure_long.csv",row.names = F)
# 
#city lockdown plots
SEIHDQR_9age_simulation_nyc_city_lockdown_long <- SEIHDQR_9age_simulation_nyc_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_nyc_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_city_lockdown_long,"SEIHDQR_9age_simulation_nyc_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_city_lockdown_long<-fread("SEIHDQR_9age_simulation_nyc_city_lockdown_long.csv")

Infected_9age_simulation_nyc_city_lockdown_long<-subset(SEIHDQR_9age_simulation_nyc_city_lockdown_long, state=="I")#
Infected_9age_simulation_nyc_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_nyc_city_lockdown_long,"Infected_9age_simulation_nyc_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_nyc_combined_long <- SEIHDQR_9age_simulation_nyc_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_combined_long <- cbind(SEIHDQR_9age_simulation_nyc_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_combined_long,"SEIHDQR_9age_simulation_nyc_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_combined_long<-fread("SEIHDQR_9age_simulation_nyc_combined_long.csv")
Infected_9age_simulation_nyc_combined_long<-subset(SEIHDQR_9age_simulation_nyc_combined_long, state=="I")#
Infected_9age_simulation_nyc_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_nyc_combined_long,"Infected_9age_simulation_nyc_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_nyc_nointer_long <- SEIHDQR_9age_simulation_nyc_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_nointer_long <- cbind(SEIHDQR_9age_simulation_nyc_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_nointer_long,"SEIHDQR_9age_simulation_nyc_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_nyc_nointer_long<-fread("SEIHDQR_9age_simulation_nyc_nointer_long.csv")
Infected_9age_simulation_nyc_nointer_long<-subset(SEIHDQR_9age_simulation_nyc_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_nyc_nointer_long,"Infected_9age_simulation_nyc_nointer_long.csv",row.names = F)


infected_9age_estimate_nyc_scenarios <- rbind(Infected_9age_simulation_nyc_schoolclose_long, Infected_9age_simulation_nyc_50work_long, Infected_9age_simulation_nyc_80work_long, Infected_9age_simulation_nyc_50other_long, Infected_9age_simulation_nyc_20other_long, Infected_9age_simulation_nyc_10quarantine_long,Infected_9age_simulation_nyc_city_lockdown_long, Infected_9age_simulation_nyc_combined_long)# Infected_9age_simulation_nyc_inter_borderclosure_long,

infected_9age_estimate_nyc_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_nyc_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_nyc_nointer_long$period <- NULL
Infected_9age_simulation_nyc_nointer_long$state<- NULL
names(Infected_9age_simulation_nyc_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_nyc_scenarios_nointer <- merge(infected_9age_estimate_nyc_scenarios, Infected_9age_simulation_nyc_nointer_long, by = c("time","age_group"))
infected_9age_estimate_nyc_scenarios_nointer$state <- NULL
infected_9age_estimate_nyc_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_nyc_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_nyc_scenarios_nointer_agg$policy)
infected_9age_estimate_nyc_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_nyc_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_nyc_scenarios_nointer_agg$estimate)/infected_9age_estimate_nyc_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_nyc_scenarios_nointer_agg,"infected_9age_estimate_nyc_scenarios_nointer_agg.csv",row.names = F)



SEIHDQR_9age_simulation_la_schoolclose<-fread("SEIHDQR_9age_simulation_la_schoolclose.csv")
SEIHDQR_9age_simulation_la_50work<-fread("SEIHDQR_9age_simulation_la_50work.csv")
SEIHDQR_9age_simulation_la_80work<-fread("SEIHDQR_9age_simulation_la_80work.csv")
SEIHDQR_9age_simulation_la_50other<-fread("SEIHDQR_9age_simulation_la_50other.csv")
SEIHDQR_9age_simulation_la_20other<-fread("SEIHDQR_9age_simulation_la_20other.csv")
SEIHDQR_9age_simulation_la_10quarantine<-fread("SEIHDQR_9age_simulation_la_10quarantine.csv")
#SEIHDQR_9age_simulation_la_inter_borderclosure<-fread("SEIHDQR_9age_simulation_la_inter_borderclosure.csv")
SEIHDQR_9age_simulation_la_city_lockdown<-fread("SEIHDQR_9age_simulation_la_city_lockdown.csv")
SEIHDQR_9age_simulation_la_combined<-fread("SEIHDQR_9age_simulation_la_combined.csv")
SEIHDQR_9age_simulation_la_nointer <- fread("SEIHDQR_9age_simulation_la_nointer.csv")

#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_la_schoolclose_long <- SEIHDQR_9age_simulation_la_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_schoolclose_long <- cbind(SEIHDQR_9age_simulation_la_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_schoolclose_long,"SEIHDQR_9age_simulation_la_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_schoolclose_long<-fread("SEIHDQR_9age_simulation_la_schoolclose_long.csv")
#SEIHDQR_9age_simulation_la_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_la_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_la_schoolclose_long<-subset(SEIHDQR_9age_simulation_la_schoolclose_long, state=="I")#
Infected_9age_simulation_la_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_la_schoolclose_long,"Infected_9age_simulation_la_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_la_50work_long <- SEIHDQR_9age_simulation_la_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_50work_long <- cbind(SEIHDQR_9age_simulation_la_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_50work_long,"SEIHDQR_9age_simulation_la_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_50work_long<-fread("SEIHDQR_9age_simulation_la_50work_long.csv")

Infected_9age_simulation_la_50work_long<-subset(SEIHDQR_9age_simulation_la_50work_long, state=="I")#
Infected_9age_simulation_la_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_la_50work_long,"Infected_9age_simulation_la_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_la_80work_long <- SEIHDQR_9age_simulation_la_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_80work_long <- cbind(SEIHDQR_9age_simulation_la_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_80work_long,"SEIHDQR_9age_simulation_la_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_80work_long<-fread("SEIHDQR_9age_simulation_la_80work_long.csv")

Infected_9age_simulation_la_80work_long<-subset(SEIHDQR_9age_simulation_la_80work_long, state=="I")#
Infected_9age_simulation_la_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_la_80work_long,"Infected_9age_simulation_la_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_la_50other_long <- SEIHDQR_9age_simulation_la_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_50other_long <- cbind(SEIHDQR_9age_simulation_la_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_50other_long,"SEIHDQR_9age_simulation_la_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_50other_long<-fread("SEIHDQR_9age_simulation_la_50other_long.csv")

Infected_9age_simulation_la_50other_long<-subset(SEIHDQR_9age_simulation_la_50other_long, state=="I")#
Infected_9age_simulation_la_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_la_50other_long,"Infected_9age_simulation_la_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_la_20other_long <- SEIHDQR_9age_simulation_la_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_20other_long <- cbind(SEIHDQR_9age_simulation_la_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_20other_long,"SEIHDQR_9age_simulation_la_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_20other_long<-fread("SEIHDQR_9age_simulation_la_20other_long.csv")

Infected_9age_simulation_la_20other_long<-subset(SEIHDQR_9age_simulation_la_20other_long, state=="I")#
Infected_9age_simulation_la_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_la_20other_long,"Infected_9age_simulation_la_20other_long.csv",row.names = F)


#10 quarantine plots
SEIHDQR_9age_simulation_la_10quarantine_long <- SEIHDQR_9age_simulation_la_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_10quarantine_long <- cbind(SEIHDQR_9age_simulation_la_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_10quarantine_long,"SEIHDQR_9age_simulation_la_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_10quarantine_long<-fread("SEIHDQR_9age_simulation_la_10quarantine_long.csv")

Infected_9age_simulation_la_10quarantine_long<-subset(SEIHDQR_9age_simulation_la_10quarantine_long, state=="I")#
Infected_9age_simulation_la_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_la_10quarantine_long,"Infected_9age_simulation_la_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_la_inter_borderclosure_long <- SEIHDQR_9age_simulation_la_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_la_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_la_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_la_inter_borderclosure_long,"SEIHDQR_9age_simulation_la_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_la_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_la_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_la_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_la_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_la_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_la_inter_borderclosure_long,"Infected_9age_simulation_la_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_la_city_lockdown_long <- SEIHDQR_9age_simulation_la_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_la_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_city_lockdown_long,"SEIHDQR_9age_simulation_la_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_city_lockdown_long<-fread("SEIHDQR_9age_simulation_la_city_lockdown_long.csv")

Infected_9age_simulation_la_city_lockdown_long<-subset(SEIHDQR_9age_simulation_la_city_lockdown_long, state=="I")#
Infected_9age_simulation_la_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_la_city_lockdown_long,"Infected_9age_simulation_la_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_la_combined_long <- SEIHDQR_9age_simulation_la_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_combined_long <- cbind(SEIHDQR_9age_simulation_la_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_combined_long,"SEIHDQR_9age_simulation_la_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_combined_long<-fread("SEIHDQR_9age_simulation_la_combined_long.csv")
Infected_9age_simulation_la_combined_long<-subset(SEIHDQR_9age_simulation_la_combined_long, state=="I")#
Infected_9age_simulation_la_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_la_combined_long,"Infected_9age_simulation_la_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_la_nointer_long <- SEIHDQR_9age_simulation_la_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_nointer_long <- cbind(SEIHDQR_9age_simulation_la_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_nointer_long,"SEIHDQR_9age_simulation_la_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_la_nointer_long<-fread("SEIHDQR_9age_simulation_la_nointer_long.csv")
Infected_9age_simulation_la_nointer_long<-subset(SEIHDQR_9age_simulation_la_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_la_nointer_long,"Infected_9age_simulation_la_nointer_long.csv",row.names = F)


infected_9age_estimate_la_scenarios <- rbind(Infected_9age_simulation_la_schoolclose_long, Infected_9age_simulation_la_50work_long, Infected_9age_simulation_la_80work_long, Infected_9age_simulation_la_50other_long, Infected_9age_simulation_la_20other_long, Infected_9age_simulation_la_10quarantine_long, Infected_9age_simulation_la_city_lockdown_long, Infected_9age_simulation_la_combined_long)# Infected_9age_simulation_la_inter_borderclosure_long,

infected_9age_estimate_la_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_la_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_la_nointer_long$period <- NULL
Infected_9age_simulation_la_nointer_long$state<- NULL
names(Infected_9age_simulation_la_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_la_scenarios_nointer <- merge(infected_9age_estimate_la_scenarios, Infected_9age_simulation_la_nointer_long, by = c("time","age_group"))
infected_9age_estimate_la_scenarios_nointer$state <- NULL
infected_9age_estimate_la_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_la_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_la_scenarios_nointer_agg$policy)
infected_9age_estimate_la_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_la_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_la_scenarios_nointer_agg$estimate)/infected_9age_estimate_la_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_la_scenarios_nointer_agg,"infected_9age_estimate_la_scenarios_nointer_agg.csv",row.names = F)



SEIHDQR_9age_simulation_daegu_schoolclose<-fread("SEIHDQR_9age_simulation_daegu_schoolclose.csv")
SEIHDQR_9age_simulation_daegu_50work<-fread("SEIHDQR_9age_simulation_daegu_50work.csv")
SEIHDQR_9age_simulation_daegu_80work<-fread("SEIHDQR_9age_simulation_daegu_80work.csv")
SEIHDQR_9age_simulation_daegu_50other<-fread("SEIHDQR_9age_simulation_daegu_50other.csv")
SEIHDQR_9age_simulation_daegu_20other<-fread("SEIHDQR_9age_simulation_daegu_20other.csv")
SEIHDQR_9age_simulation_daegu_10quarantine<-fread("SEIHDQR_9age_simulation_daegu_10quarantine.csv")
#SEIHDQR_9age_simulation_daegu_inter_borderclosure<-fread("SEIHDQR_9age_simulation_daegu_inter_borderclosure.csv")
SEIHDQR_9age_simulation_daegu_city_lockdown<-fread("SEIHDQR_9age_simulation_daegu_city_lockdown.csv")
SEIHDQR_9age_simulation_daegu_combined<-fread("SEIHDQR_9age_simulation_daegu_combined.csv")
SEIHDQR_9age_simulation_daegu_nointer <- fread("SEIHDQR_9age_simulation_daegu_nointer.csv")

#plot specific measure


#school close plots
SEIHDQR_9age_simulation_daegu_schoolclose_long <- SEIHDQR_9age_simulation_daegu_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_schoolclose_long <- cbind(SEIHDQR_9age_simulation_daegu_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_schoolclose_long,"SEIHDQR_9age_simulation_daegu_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_schoolclose_long<-fread("SEIHDQR_9age_simulation_daegu_schoolclose_long.csv")
#SEIHDQR_9age_simulation_daegu_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_daegu_schoolclose_long<-subset(SEIHDQR_9age_simulation_daegu_schoolclose_long, state=="I")#
Infected_9age_simulation_daegu_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_daegu_schoolclose_long,"Infected_9age_simulation_daegu_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_daegu_50work_long <- SEIHDQR_9age_simulation_daegu_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_50work_long <- cbind(SEIHDQR_9age_simulation_daegu_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_50work_long,"SEIHDQR_9age_simulation_daegu_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_50work_long<-fread("SEIHDQR_9age_simulation_daegu_50work_long.csv")

Infected_9age_simulation_daegu_50work_long<-subset(SEIHDQR_9age_simulation_daegu_50work_long, state=="I")#
Infected_9age_simulation_daegu_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_daegu_50work_long,"Infected_9age_simulation_daegu_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_daegu_80work_long <- SEIHDQR_9age_simulation_daegu_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_80work_long <- cbind(SEIHDQR_9age_simulation_daegu_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_80work_long,"SEIHDQR_9age_simulation_daegu_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_80work_long<-fread("SEIHDQR_9age_simulation_daegu_80work_long.csv")

Infected_9age_simulation_daegu_80work_long<-subset(SEIHDQR_9age_simulation_daegu_80work_long, state=="I")#
Infected_9age_simulation_daegu_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_daegu_80work_long,"Infected_9age_simulation_daegu_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_daegu_50other_long <- SEIHDQR_9age_simulation_daegu_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_50other_long <- cbind(SEIHDQR_9age_simulation_daegu_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_50other_long,"SEIHDQR_9age_simulation_daegu_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_50other_long<-fread("SEIHDQR_9age_simulation_daegu_50other_long.csv")

Infected_9age_simulation_daegu_50other_long<-subset(SEIHDQR_9age_simulation_daegu_50other_long, state=="I")#
Infected_9age_simulation_daegu_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_daegu_50other_long,"Infected_9age_simulation_daegu_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_daegu_20other_long <- SEIHDQR_9age_simulation_daegu_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_20other_long <- cbind(SEIHDQR_9age_simulation_daegu_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_20other_long,"SEIHDQR_9age_simulation_daegu_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_20other_long<-fread("SEIHDQR_9age_simulation_daegu_20other_long.csv")

Infected_9age_simulation_daegu_20other_long<-subset(SEIHDQR_9age_simulation_daegu_20other_long, state=="I")#
Infected_9age_simulation_daegu_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_daegu_20other_long,"Infected_9age_simulation_daegu_20other_long.csv",row.names = F)

#10 quarantine plots
SEIHDQR_9age_simulation_daegu_10quarantine_long <- SEIHDQR_9age_simulation_daegu_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_10quarantine_long <- cbind(SEIHDQR_9age_simulation_daegu_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_10quarantine_long,"SEIHDQR_9age_simulation_daegu_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_10quarantine_long<-fread("SEIHDQR_9age_simulation_daegu_10quarantine_long.csv")

Infected_9age_simulation_daegu_10quarantine_long<-subset(SEIHDQR_9age_simulation_daegu_10quarantine_long, state=="I")#
Infected_9age_simulation_daegu_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_daegu_10quarantine_long,"Infected_9age_simulation_daegu_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long <- SEIHDQR_9age_simulation_daegu_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long,"SEIHDQR_9age_simulation_daegu_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_daegu_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_daegu_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_daegu_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_daegu_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_daegu_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_daegu_inter_borderclosure_long,"Infected_9age_simulation_daegu_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_daegu_city_lockdown_long <- SEIHDQR_9age_simulation_daegu_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_daegu_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_city_lockdown_long,"SEIHDQR_9age_simulation_daegu_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_city_lockdown_long<-fread("SEIHDQR_9age_simulation_daegu_city_lockdown_long.csv")

Infected_9age_simulation_daegu_city_lockdown_long<-subset(SEIHDQR_9age_simulation_daegu_city_lockdown_long, state=="I")#
Infected_9age_simulation_daegu_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_daegu_city_lockdown_long,"Infected_9age_simulation_daegu_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_daegu_combined_long <- SEIHDQR_9age_simulation_daegu_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_combined_long <- cbind(SEIHDQR_9age_simulation_daegu_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_combined_long,"SEIHDQR_9age_simulation_daegu_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_combined_long<-fread("SEIHDQR_9age_simulation_daegu_combined_long.csv")
Infected_9age_simulation_daegu_combined_long<-subset(SEIHDQR_9age_simulation_daegu_combined_long, state=="I")#
Infected_9age_simulation_daegu_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_daegu_combined_long,"Infected_9age_simulation_daegu_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_daegu_nointer_long <- SEIHDQR_9age_simulation_daegu_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_nointer_long <- cbind(SEIHDQR_9age_simulation_daegu_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_nointer_long,"SEIHDQR_9age_simulation_daegu_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_daegu_nointer_long<-fread("SEIHDQR_9age_simulation_daegu_nointer_long.csv")
Infected_9age_simulation_daegu_nointer_long<-subset(SEIHDQR_9age_simulation_daegu_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_daegu_nointer_long,"Infected_9age_simulation_daegu_nointer_long.csv",row.names = F)


infected_9age_estimate_daegu_scenarios <- rbind(Infected_9age_simulation_daegu_schoolclose_long, Infected_9age_simulation_daegu_50work_long, Infected_9age_simulation_daegu_80work_long, Infected_9age_simulation_daegu_50other_long, Infected_9age_simulation_daegu_20other_long, Infected_9age_simulation_daegu_10quarantine_long, Infected_9age_simulation_daegu_city_lockdown_long, Infected_9age_simulation_daegu_combined_long) # Infected_9age_simulation_daegu_inter_borderclosure_long,

infected_9age_estimate_daegu_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_daegu_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_daegu_nointer_long$period <- NULL
Infected_9age_simulation_daegu_nointer_long$state<- NULL
names(Infected_9age_simulation_daegu_nointer_long)[2] <- "estimate_nointer" 
infected_9age_estimate_daegu_scenarios_nointer <- merge(infected_9age_estimate_daegu_scenarios, Infected_9age_simulation_daegu_nointer_long, by = c("time","age_group"))
infected_9age_estimate_daegu_scenarios_nointer$state <- NULL
infected_9age_estimate_daegu_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_daegu_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_daegu_scenarios_nointer_agg$policy)
infected_9age_estimate_daegu_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_daegu_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_daegu_scenarios_nointer_agg$estimate)/infected_9age_estimate_daegu_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_daegu_scenarios_nointer_agg,"infected_9age_estimate_daegu_scenarios_nointer_agg.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_schoolclose<-fread("SEIHDQR_9age_simulation_nairobi_schoolclose.csv")
SEIHDQR_9age_simulation_nairobi_50work<-fread("SEIHDQR_9age_simulation_nairobi_50work.csv")
SEIHDQR_9age_simulation_nairobi_80work<-fread("SEIHDQR_9age_simulation_nairobi_80work.csv")
SEIHDQR_9age_simulation_nairobi_50other<-fread("SEIHDQR_9age_simulation_nairobi_50other.csv")
SEIHDQR_9age_simulation_nairobi_20other<-fread("SEIHDQR_9age_simulation_nairobi_20other.csv")
SEIHDQR_9age_simulation_nairobi_10quarantine<-fread("SEIHDQR_9age_simulation_nairobi_10quarantine.csv")
#SEIHDQR_9age_simulation_nairobi_inter_borderclosure<-fread("SEIHDQR_9age_simulation_nairobi_inter_borderclosure.csv")
SEIHDQR_9age_simulation_nairobi_city_lockdown<-fread("SEIHDQR_9age_simulation_nairobi_city_lockdown.csv")
SEIHDQR_9age_simulation_nairobi_combined<-fread("SEIHDQR_9age_simulation_nairobi_combined.csv")
SEIHDQR_9age_simulation_nairobi_nointer <- fread("SEIHDQR_9age_simulation_nairobi_nointer.csv")
#plot specific measure
#test age effects
#test immune effects (maybe in next paper)
#bouncing back timing assume start 100 cases and bouncing back (>1000) time 

#school close plots
SEIHDQR_9age_simulation_nairobi_schoolclose_long <- SEIHDQR_9age_simulation_nairobi_schoolclose %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_schoolclose_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_schoolclose_long <- cbind(SEIHDQR_9age_simulation_nairobi_schoolclose_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_schoolclose_long,"SEIHDQR_9age_simulation_nairobi_schoolclose_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_schoolclose_long<-fread("SEIHDQR_9age_simulation_nairobi_schoolclose_long.csv")
#SEIHDQR_9age_simulation_nairobi_schoolclose_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_schoolclose_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
Infected_9age_simulation_nairobi_schoolclose_long<-subset(SEIHDQR_9age_simulation_nairobi_schoolclose_long, state=="I")#
Infected_9age_simulation_nairobi_schoolclose_long$policy <- "School close"

write.csv(Infected_9age_simulation_nairobi_schoolclose_long,"Infected_9age_simulation_nairobi_schoolclose_long.csv",row.names = F)



#50 work plots
SEIHDQR_9age_simulation_nairobi_50work_long <- SEIHDQR_9age_simulation_nairobi_50work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_50work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_50work_long <- cbind(SEIHDQR_9age_simulation_nairobi_50work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_50work_long,"SEIHDQR_9age_simulation_nairobi_50work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_50work_long<-fread("SEIHDQR_9age_simulation_nairobi_50work_long.csv")

Infected_9age_simulation_nairobi_50work_long<-subset(SEIHDQR_9age_simulation_nairobi_50work_long, state=="I")#
Infected_9age_simulation_nairobi_50work_long$policy <- "50% working from home"

write.csv(Infected_9age_simulation_nairobi_50work_long,"Infected_9age_simulation_nairobi_50work_long.csv",row.names = F)

#80 work plots
SEIHDQR_9age_simulation_nairobi_80work_long <- SEIHDQR_9age_simulation_nairobi_80work %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_80work_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_80work_long <- cbind(SEIHDQR_9age_simulation_nairobi_80work_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_80work_long,"SEIHDQR_9age_simulation_nairobi_80work_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_80work_long<-fread("SEIHDQR_9age_simulation_nairobi_80work_long.csv")

Infected_9age_simulation_nairobi_80work_long<-subset(SEIHDQR_9age_simulation_nairobi_80work_long, state=="I")#
Infected_9age_simulation_nairobi_80work_long$policy <- "80% working from home"
write.csv(Infected_9age_simulation_nairobi_80work_long,"Infected_9age_simulation_nairobi_80work_long.csv",row.names = F)


#50 other plots
SEIHDQR_9age_simulation_nairobi_50other_long <- SEIHDQR_9age_simulation_nairobi_50other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_50other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_50other_long <- cbind(SEIHDQR_9age_simulation_nairobi_50other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_50other_long,"SEIHDQR_9age_simulation_nairobi_50other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_50other_long<-fread("SEIHDQR_9age_simulation_nairobi_50other_long.csv")

Infected_9age_simulation_nairobi_50other_long<-subset(SEIHDQR_9age_simulation_nairobi_50other_long, state=="I")#
Infected_9age_simulation_nairobi_50other_long$policy <- "50% other mobility"
write.csv(Infected_9age_simulation_nairobi_50other_long,"Infected_9age_simulation_nairobi_50other_long.csv",row.names = F)

#20 other plots
SEIHDQR_9age_simulation_nairobi_20other_long <- SEIHDQR_9age_simulation_nairobi_20other %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_20other_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_20other_long <- cbind(SEIHDQR_9age_simulation_nairobi_20other_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_20other_long,"SEIHDQR_9age_simulation_nairobi_20other_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_20other_long<-fread("SEIHDQR_9age_simulation_nairobi_20other_long.csv")

Infected_9age_simulation_nairobi_20other_long<-subset(SEIHDQR_9age_simulation_nairobi_20other_long, state=="I")#
Infected_9age_simulation_nairobi_20other_long$policy <- "20% other mobility"
write.csv(Infected_9age_simulation_nairobi_20other_long,"Infected_9age_simulation_nairobi_20other_long.csv",row.names = F)

#10 quarantine plots
SEIHDQR_9age_simulation_nairobi_10quarantine_long <- SEIHDQR_9age_simulation_nairobi_10quarantine %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_10quarantine_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_10quarantine_long <- cbind(SEIHDQR_9age_simulation_nairobi_10quarantine_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_10quarantine_long,"SEIHDQR_9age_simulation_nairobi_10quarantine_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_10quarantine_long<-fread("SEIHDQR_9age_simulation_nairobi_10quarantine_long.csv")

Infected_9age_simulation_nairobi_10quarantine_long<-subset(SEIHDQR_9age_simulation_nairobi_10quarantine_long, state=="I")#
Infected_9age_simulation_nairobi_10quarantine_long$policy <- "10% quarantine"
write.csv(Infected_9age_simulation_nairobi_10quarantine_long,"Infected_9age_simulation_nairobi_10quarantine_long.csv",row.names = F)


#borderclosure plots
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long <- SEIHDQR_9age_simulation_nairobi_inter_borderclosure %>% gather(SEIHDQR, estimate, -c(time, period))
# state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long$SEIHDQR, "[.]")))
# colnames(state_age)<-c("state","age_group")
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long <- cbind(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long, state_age)
# write.csv(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long,"SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long.csv",row.names = F)
# 
# 
# SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long<-fread("SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long.csv")
# 
# Infected_9age_simulation_nairobi_inter_borderclosure_long<-subset(SEIHDQR_9age_simulation_nairobi_inter_borderclosure_long, state=="I")#
# Infected_9age_simulation_nairobi_inter_borderclosure_long$policy <- "Border closure"
# write.csv(Infected_9age_simulation_nairobi_inter_borderclosure_long,"Infected_9age_simulation_nairobi_inter_borderclosure_long.csv",row.names = F)

#city lockdown plots
SEIHDQR_9age_simulation_nairobi_city_lockdown_long <- SEIHDQR_9age_simulation_nairobi_city_lockdown %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_city_lockdown_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_city_lockdown_long <- cbind(SEIHDQR_9age_simulation_nairobi_city_lockdown_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_city_lockdown_long,"SEIHDQR_9age_simulation_nairobi_city_lockdown_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_city_lockdown_long<-fread("SEIHDQR_9age_simulation_nairobi_city_lockdown_long.csv")

Infected_9age_simulation_nairobi_city_lockdown_long<-subset(SEIHDQR_9age_simulation_nairobi_city_lockdown_long, state=="I")#
Infected_9age_simulation_nairobi_city_lockdown_long$policy <- "City lockdown"
write.csv(Infected_9age_simulation_nairobi_city_lockdown_long,"Infected_9age_simulation_nairobi_city_lockdown_long.csv",row.names = F)

#combined
SEIHDQR_9age_simulation_nairobi_combined_long <- SEIHDQR_9age_simulation_nairobi_combined %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_combined_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_combined_long <- cbind(SEIHDQR_9age_simulation_nairobi_combined_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_combined_long,"SEIHDQR_9age_simulation_nairobi_combined_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_combined_long<-fread("SEIHDQR_9age_simulation_nairobi_combined_long.csv")
Infected_9age_simulation_nairobi_combined_long<-subset(SEIHDQR_9age_simulation_nairobi_combined_long, state=="I")#
Infected_9age_simulation_nairobi_combined_long$policy <- "Combined policy"
write.csv(Infected_9age_simulation_nairobi_combined_long,"Infected_9age_simulation_nairobi_combined_long.csv",row.names = F)

#no intervention
SEIHDQR_9age_simulation_nairobi_nointer_long <- SEIHDQR_9age_simulation_nairobi_nointer %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_nointer_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_nointer_long <- cbind(SEIHDQR_9age_simulation_nairobi_nointer_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_nointer_long,"SEIHDQR_9age_simulation_nairobi_nointer_long.csv",row.names = F)

SEIHDQR_9age_simulation_nairobi_nointer_long<-fread("SEIHDQR_9age_simulation_nairobi_nointer_long.csv")
Infected_9age_simulation_nairobi_nointer_long<-subset(SEIHDQR_9age_simulation_nairobi_nointer_long, state=="I")#
write.csv(Infected_9age_simulation_nairobi_nointer_long,"Infected_9age_simulation_nairobi_nointer_long.csv",row.names = F)


infected_9age_estimate_nairobi_scenarios <- rbind(Infected_9age_simulation_nairobi_schoolclose_long, Infected_9age_simulation_nairobi_50work_long, Infected_9age_simulation_nairobi_80work_long, Infected_9age_simulation_nairobi_50other_long, Infected_9age_simulation_nairobi_20other_long, Infected_9age_simulation_nairobi_10quarantine_long, Infected_9age_simulation_nairobi_city_lockdown_long, Infected_9age_simulation_nairobi_combined_long)#Infected_9age_simulation_nairobi_inter_borderclosure_long,

infected_9age_estimate_nairobi_scenarios$SEIHDQR <-NULL
Infected_9age_simulation_nairobi_nointer_long$SEIHDQR <- NULL
Infected_9age_simulation_nairobi_nointer_long$period <- NULL
Infected_9age_simulation_nairobi_nointer_long$state<- NULL
names(Infected_9age_simulation_nairobi_nointer_long)[2] <- "estimate_nointer"
Infected_9age_simulation_nairobi_nointer_long$age_group <- as.integer(Infected_9age_simulation_nairobi_nointer_long$age_group)
infected_9age_estimate_nairobi_scenarios$age_group <- as.integer(infected_9age_estimate_nairobi_scenarios$age_group)
infected_9age_estimate_nairobi_scenarios_nointer <- merge(infected_9age_estimate_nairobi_scenarios, Infected_9age_simulation_nairobi_nointer_long, by = c("time","age_group"))
infected_9age_estimate_nairobi_scenarios_nointer$state <- NULL
infected_9age_estimate_nairobi_scenarios_nointer_agg <- aggregate(cbind(estimate_nointer, estimate)~ age_group+policy, FUN= sum, infected_9age_estimate_nairobi_scenarios_nointer, na.rm=T)

unique(infected_9age_estimate_nairobi_scenarios_nointer_agg$policy)
infected_9age_estimate_nairobi_scenarios_nointer_agg$avoided_effect <- (infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate_nointer-infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate)/infected_9age_estimate_nairobi_scenarios_nointer_agg$estimate_nointer
write.csv(infected_9age_estimate_nairobi_scenarios_nointer_agg,"infected_9age_estimate_nairobi_scenarios_nointer_agg.csv",row.names = F)





infected_9age_estimate_nyc_scenarios_nointer_agg<-fread("infected_9age_estimate_nyc_scenarios_nointer_agg.csv")
infected_9age_estimate_la_scenarios_nointer_agg<-fread("infected_9age_estimate_la_scenarios_nointer_agg.csv")
infected_9age_estimate_daegu_scenarios_nointer_agg<-fread("infected_9age_estimate_daegu_scenarios_nointer_agg.csv")
infected_9age_estimate_nairobi_scenarios_nointer_agg<-fread("infected_9age_estimate_nairobi_scenarios_nointer_agg.csv")
infected_9age_estimate_nyc_scenarios_nointer_agg$city <- "New York"
infected_9age_estimate_la_scenarios_nointer_agg$city <- "Los Angeles"
infected_9age_estimate_daegu_scenarios_nointer_agg$city <- "Daegu"
infected_9age_estimate_nairobi_scenarios_nointer_agg$city <- "Nairobi"



#unique(infected_9age_estimate_scenario_fourcities$policy)

infected_9age_estimate_scenario_fourcities <- rbind(infected_9age_estimate_nyc_scenarios_nointer_agg,infected_9age_estimate_la_scenarios_nointer_agg,infected_9age_estimate_daegu_scenarios_nointer_agg,infected_9age_estimate_nairobi_scenarios_nointer_agg)

infected_9age_estimate_scenario_fourcities_young_old <- infected_9age_estimate_scenario_fourcities
infected_9age_estimate_scenario_fourcities_young_old$scenario <- "50% contact reduction in the young and old"
write.csv(infected_9age_estimate_scenario_fourcities_young_old,"infected_9age_estimate_scenario_fourcities_young_old.csv",row.names = F)

neworder<-c("School close","50% working from home","80% working from home","50% other mobility","20% other mobility","10% quarantine", "City lockdown","Combined policy")#"Border closure",
neworder_age<-c(1,2,3,4,5,6,7,8,9)


library(viridis)
infected_9age_estimate_scenario_fourcities$policy<-factor(infected_9age_estimate_scenario_fourcities$policy, levels=neworder)
infected_9age_estimate_scenario_fourcities$age_group<-factor(infected_9age_estimate_scenario_fourcities$age_group, levels=neworder_age, labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
# infected_9age_estimate_scenario_fourcities$avoided_effect <- ifelse(infected_9age_estimate_scenario_fourcities$avoided_effect<0,0,infected_9age_estimate_scenario_fourcities$avoided_effect)
infected_9age_estimate_scenario_fourcities_agg<- aggregate(avoided_effect~city+policy, FUN=mean, infected_9age_estimate_scenario_fourcities)
matrix_plot_infected_9age_estimate_scenario_fourcities_effectiveness <- ggplot(infected_9age_estimate_scenario_fourcities, aes(x=policy, y= age_group, fill=avoided_effect))+
  geom_tile()+
  geom_text(aes(label=round(avoided_effect,2)), color = "black", size=8)+
  #scale_fill_gradient(low="orange", high="white", limits=c(0, 1), na.value = "transparent")+
  scale_fill_viridis_c(direction = -1, option = "plasma", begin = 0.1, end = 1,limits=c(-0.2, 1), name="Effectiveness") +
  scale_x_discrete(name = "Policy")+
  scale_y_discrete(name = "Age")+
  theme(axis.title = element_text(size = 18),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 16,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=20, angle = 90),
        axis.text.y = element_text(size=20, angle = 0))+

  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  #guides(fill=guide_legend())+
  facet_wrap(.~city,nrow=2, strip.position = "left")
ggsave("matrix_plot_infected_9age_estimate_scenario_fourcities_effectiveness_old_young.pdf", width = 18, height = 16)


```

```{r social distancing in old vs in old and young}

infected_9age_estimate_scenario_fourcities_old<-fread("age_specific_intervention/infected_9age_estimate_scenario_fourcities_old.csv")
infected_9age_estimate_scenario_fourcities_young_old<-fread("old_young_intervention/infected_9age_estimate_scenario_fourcities_young_old.csv")
neworder<-c("School close","50% working from home","80% working from home","50% other mobility","20% other mobility","10% quarantine", "City lockdown","Combined policy")#"Border closure",
neworder_age<-c(1,2,3,4,5,6,7,8,9)

infected_9age_estimate_scenario_fourcities_old<-infected_9age_estimate_scenario_fourcities_old[,c("age_group","policy","avoided_effect","city")]
infected_9age_estimate_scenario_fourcities_young_old<-infected_9age_estimate_scenario_fourcities_young_old[,c("age_group","policy","avoided_effect","city")]
colnames(infected_9age_estimate_scenario_fourcities_young_old)[3]<-"avoided_effect_youngold"

compar_infected_9age_estimate_scenario_fourcities_young_old<- merge(infected_9age_estimate_scenario_fourcities_young_old,infected_9age_estimate_scenario_fourcities_old, by=c("age_group","policy","city"))
compar_infected_9age_estimate_scenario_fourcities_young_old$benefits <- compar_infected_9age_estimate_scenario_fourcities_young_old$avoided_effect_youngold-compar_infected_9age_estimate_scenario_fourcities_young_old$avoided_effect
write.csv(compar_infected_9age_estimate_scenario_fourcities_young_old,"compar_infected_9age_estimate_scenario_fourcities_young_old.csv",row.names = F)
compar_infected_9age_estimate_scenario_fourcities_young_old$age_category <- ifelse(compar_infected_9age_estimate_scenario_fourcities_young_old$age_group<2, "young",ifelse(compar_infected_9age_estimate_scenario_fourcities_young_old$age_group<6, "middle","old"))

compar_infected_9age_estimate_scenario_fourcities_young_old_agg <- aggregate(benefits~city+policy+age_category, FUN=mean, compar_infected_9age_estimate_scenario_fourcities_young_old,na.rm=T)
write.csv(compar_infected_9age_estimate_scenario_fourcities_young_old_agg,"compar_infected_9age_estimate_scenario_fourcities_young_old_agg.csv",row.names = F)
compar_infected_9age_estimate_scenario_fourcities_young_old_policyagg <- aggregate(benefits~city+age_category, FUN=mean, compar_infected_9age_estimate_scenario_fourcities_young_old,na.rm=T)
library(viridis)
infected_9age_estimate_scenario_fourcities$policy<-factor(infected_9age_estimate_scenario_fourcities$policy, levels=neworder)
infected_9age_estimate_scenario_fourcities$age_group<-factor(infected_9age_estimate_scenario_fourcities$age_group, levels=neworder_age, labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))

```


```{r population age structure effects}

birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")




#para 9
hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis

#para 11
quar.rate_nairobi =c(rep(0.0001,9))
quar.rate_daegu =c(rep(0.0001,9))
quar.rate_nyc =c(rep(0.0001,9))
quar.rate_la =c(rep(0.0001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.


nyc_int_travel_import_data <- readRDS("nyc_int_travel_import_data.rds")
nyc_int_travel_export_data <- readRDS("nyc_int_travel_export_data.rds")
nyc_dom_travel_import_data <- readRDS("nyc_dom_travel_import_data.rds")
nyc_dom_travel_export_data <- readRDS("nyc_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_nyc_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "New York")
age_specific_incidence_prop_nyc_extend_agg<-fread("age_specific_prop_nyc_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")



contact_matrix_9age_ny <-readRDS("contact_matrix_9age_ny.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_ny <- list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work,contact_matrix_9age_ny$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_ny<-list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work*0.95,contact_matrix_9age_ny$other*0.98)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_ny<-list(contact_matrix_9age_ny$home*1.2,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.6,contact_matrix_9age_ny$other*0.8)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.45)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.3,contact_matrix_9age_ny$other*0.3)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.40)


#transmissibility

transmissibility_9age_nyc <- calculate_transimissibility(R0t = R0t_ny, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nyc, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc,"transmissibility_9age_nyc.rds")

transmissibility_9age_nyc <- readRDS("transmissibility_9age_nyc.rds")
###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact_matrix_9age_nointer_ny)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p1_ny)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p2_ny)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p3_ny)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p4_ny)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p5_ny)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc.rds")



#population age-specific weights 
pop_age_weight_nyc_la <- pop_age_structure_la/pop_age_structure_nyc
pop_age_weight_nyc_daegu <- pop_age_structure_daegu/pop_age_structure_nyc
pop_age_weight_nyc_nairobi <- pop_age_structure_nairobi/pop_age_structure_nyc

#transmissiblity adjusted by population structure in la

transmissibility_9age_nyc_la <- calculate_transimissibility(R0t = R0t_ny, recov.rate = recov.rate, pop_age_structure = pop_age_structure_la, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_la,"transmissibility_9age_nyc_la.rds")
 
transmissibility_9age_nyc_la <- readRDS("transmissibility_9age_nyc_la.rds")

###transmission rate
transm.rate_without_intervention_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_without_intervention_nyc_la,"transm.rate_without_intervention_nyc_la.rds")
transm.rate_package1_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package1_nyc_la,"transm.rate_package1_nyc_la.rds")
transm.rate_package2_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package2_nyc_la,"transm.rate_package2_nyc_la.rds")
transm.rate_package3_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package3_nyc_la,"transm.rate_package3_nyc_la.rds")
transm.rate_package4_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package4_nyc_la,"transm.rate_package4_nyc_la.rds")
transm.rate_package5_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package5_nyc_la,"transm.rate_package5_nyc_la.rds")


#transmissiblity adjusted by population structure in daegu
transmissibility_9age_nyc_daegu <- calculate_transimissibility(R0t = R0t_ny, recov.rate = recov.rate, pop_age_structure = pop_age_structure_daegu, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_daegu,"transmissibility_9age_nyc_daegu.rds")
 
transmissibility_9age_nyc_daegu <- readRDS("transmissibility_9age_nyc_daegu.rds")

###transmission rate
transm.rate_without_intervention_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_without_intervention_nyc_daegu,"transm.rate_without_intervention_nyc_daegu.rds")
transm.rate_package1_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package1_nyc_daegu,"transm.rate_package1_nyc_daegu.rds")
transm.rate_package2_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package2_nyc_daegu,"transm.rate_package2_nyc_daegu.rds")
transm.rate_package3_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package3_nyc_daegu,"transm.rate_package3_nyc_daegu.rds")
transm.rate_package4_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package4_nyc_daegu,"transm.rate_package4_nyc_daegu.rds")
transm.rate_package5_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package5_nyc_daegu,"transm.rate_package5_nyc_daegu.rds")


#transmissiblity adjusted by population structure in nairobi
transmissibility_9age_nyc_nairobi <- calculate_transimissibility(R0t = R0t_ny, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nairobi, calculate_transmission_probability = 1, contact.matrix =contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_nairobi,"transmissibility_9age_nyc_nairobi.rds")
 
transmissibility_9age_nyc_nairobi <- readRDS("transmissibility_9age_nyc_nairobi.rds")

transmissibility_9age_nyc_nycla_nycdaegu_nycnairobi <- data.frame(transmissibility_9age_nyc,transmissibility_9age_nyc_la,transmissibility_9age_nyc_daegu,transmissibility_9age_nyc_nairobi)
names(transmissibility_9age_nyc_nycla_nycdaegu_nycnairobi) <- c("nyc","nyc_la","nyc_daegu","nyc_nairobi")
write.csv(transmissibility_9age_nyc_nycla_nycdaegu_nycnairobi,"transmissibility_9age_nyc_nycla_nycdaegu_nycnairobi.csv",row.names = F)
###transmission rate
transm.rate_without_intervention_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_nairobi
(-transm.rate_without_intervention_nyc+transm.rate_without_intervention_nyc_nairobi)/transm.rate_without_intervention_nyc
(-transm.rate_without_intervention_nyc+transm.rate_without_intervention_nyc_la)/transm.rate_without_intervention_nyc
(-transm.rate_without_intervention_nyc+transm.rate_without_intervention_nyc_daegu)/transm.rate_without_intervention_nyc

saveRDS(transm.rate_without_intervention_nyc_nairobi,"transm.rate_without_intervention_nyc_nairobi.rds")
transm.rate_package1_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package1_nyc_nairobi,"transm.rate_package1_nyc_nairobi.rds")
transm.rate_package2_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package2_nyc_nairobi,"transm.rate_package2_nyc_nairobi.rds")
transm.rate_package3_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package3_nyc_nairobi,"transm.rate_package3_nyc_nairobi.rds")
transm.rate_package4_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package4_nyc_nairobi,"transm.rate_package4_nyc_nairobi.rds")
transm.rate_package5_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package5_nyc_nairobi,"transm.rate_package5_nyc_nairobi.rds")



#US-New York City
parameters_nyc <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


#US-la City
parameters_nyc_la <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_la,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_la*pop_nyc)

#US-daegu City
parameters_nyc_daegu <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_daegu,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_daegu*pop_nyc)


#US-nairobi City
parameters_nyc_nairobi <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_nairobi,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nairobi*pop_nyc)


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

#"2020-03-02"
constraint_package1_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc/transm.rate_without_intervention_nyc),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

#2020-04-03
constraint_package5_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")


#2020-05-18
constraint_package6_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")


#nyc la age structure
constraint_no_intervention_nyc_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_la,"constraint_no_intervention_nyc_la.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_la/transm.rate_without_intervention_nyc_la),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_la,"constraint_package1_nyc_la.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_la,"constraint_package2_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_la,"constraint_package3_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_la,"constraint_package4_nyc_la.rds")

#2020-04-03
constraint_package5_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_la,"constraint_package5_nyc_la.rds")


#2020-05-18
constraint_package6_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_la,"constraint_package6_nyc_la.rds")


#nyc daegu age structure
constraint_no_intervention_nyc_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_daegu,"constraint_no_intervention_nyc_daegu.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_daegu/transm.rate_without_intervention_nyc_daegu),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_daegu,"constraint_package1_nyc_daegu.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_daegu,"constraint_package2_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_daegu,"constraint_package3_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_daegu,"constraint_package4_nyc_daegu.rds")

#2020-04-03
constraint_package5_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_daegu,"constraint_package5_nyc_daegu.rds")


#2020-05-18
constraint_package6_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_daegu,"constraint_package6_nyc_daegu.rds")


#nyc nairobi age structure
constraint_no_intervention_nyc_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_nairobi,"constraint_no_intervention_nyc_nairobi.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_nairobi,"constraint_package1_nyc_nairobi.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_nairobi,"constraint_package2_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_nairobi,"constraint_package3_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_nairobi,"constraint_package4_nyc_nairobi.rds")

#2020-04-03
constraint_package5_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_nairobi,"constraint_package5_nyc_nairobi.rds")


#2020-05-18
constraint_package6_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_nairobi,"constraint_package6_nyc_nairobi.rds")

E. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")





E. = pop_nyc*pop_age_structure_la*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_la*2e-06
initials_nyc_la <- c(S. = pop_nyc*pop_age_structure_la- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_la*2e-06)
saveRDS(initials_nyc_la,"initials_nyc_la.rds")




E. = pop_nyc*pop_age_structure_daegu*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_daegu*2e-06
initials_nyc_daegu <- c(S. = pop_nyc*pop_age_structure_daegu- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_daegu*2e-06)
saveRDS(initials_nyc_daegu,"initials_nyc_daegu.rds")


E. = pop_nyc*pop_age_structure_nairobi*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nairobi*2e-06
initials_nyc_nairobi <- c(S. = pop_nyc*pop_age_structure_nairobi- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nyc_nairobi,"initials_nyc_nairobi.rds")


#simulate the cases


SEIHDQR_9age_simulation_nyc_estimate_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


#plots
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Ageing effects")

ggsave("line_plot_ID_9age_simulation_nyc_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_la, init = initials_nyc_la, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_la, constraint2 = constraint_package2_nyc_la, constraint3 = constraint_package3_nyc_la, constraint4 = constraint_package4_nyc_la, constraint5 = constraint_package5_nyc_la, constraint6 = constraint_package6_nyc_la)


#plots
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_la_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_la_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_la_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Los Angeles")

ggsave("line_plot_ID_9age_simulation_nyc_la_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_daegu, init = initials_nyc_daegu, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_daegu, constraint2 = constraint_package2_nyc_daegu, constraint3 = constraint_package3_nyc_daegu, constraint4 = constraint_package4_nyc_daegu, constraint5 = constraint_package5_nyc_daegu, constraint6 = constraint_package6_nyc_daegu)


#plots
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_daegu_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_daegu_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_daegu_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Daegu")

ggsave("line_plot_ID_9age_simulation_nyc_daegu_ageeffect.pdf", width = 12, height = 10)



SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_nairobi, init = initials_nyc_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_nairobi, constraint2 = constraint_package2_nyc_nairobi, constraint3 = constraint_package3_nyc_nairobi, constraint4 = constraint_package4_nyc_nairobi, constraint5 = constraint_package5_nyc_nairobi, constraint6 = constraint_package6_nyc_nairobi)


#plots
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_nairobi_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Nairobi")

ggsave("line_plot_ID_9age_simulation_nyc_nairobi_ageeffect.pdf", width = 12, height = 10)




#tidy up data
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- "New York"
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$city <- "Los Angeles"
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$city <- "Daegu"
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$city <- "Nairobi"

age_effect_estimate_fourcities <- rbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long)
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$period <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- NULL
names(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long)[2] <- c("estimate_nyc")

age_effect_estimate_fourcities <- merge(age_effect_estimate_fourcities, SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, by=c("time","state","age_group"))
write.csv(age_effect_estimate_fourcities,"age_effect_estimate_fourcities.csv",row.names = F)

infect_dead_age_effect_estimate_fourcities <- subset(age_effect_estimate_fourcities, state=="I" | state =="D")
infect_dead_age_effect_estimate_fourcities_agg <- aggregate(cbind(estimate,estimate_nyc)~state+city, FUN=sum, infect_dead_age_effect_estimate_fourcities, na.rm=T)

infect_dead_age_effect_estimate_fourcities_agg$age_effect <- (infect_dead_age_effect_estimate_fourcities_agg$estimate-infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc)/infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc

write.csv(infect_dead_age_effect_estimate_fourcities_agg,"infect_dead_age_effect_estimate_fourcities_agg.csv",row.names = F)

barplot_infect_dead_age_effect <- ggplot(infect_dead_age_effect_estimate_fourcities_agg, aes(x=state, y=age_effect))+
  geom_bar(position="dodge", stat="identity", aes(fill=reorder(city, -age_effect)))+

  geom_text(aes(y=age_effect,label = paste0(round(age_effect, 3)), group=reorder(city, -age_effect)), position = position_dodge(width=1),angle=90, col = "black",size=8)+
  scale_y_continuous(name = "Effects of population ageing")+ #, breaks = seq(0,0.6e+12, 0.1e+12), labels = paste0(as.character(c(seq(0,0.6,0.1))))
  scale_x_discrete()+
  scale_fill_viridis_d(option="plasma", begin = 0.1)+
  #facet_wrap(.~city, ncol = 2)+
  theme(axis.title = element_text(size = 22),
        strip.text = element_text(size = 22),
        strip.background = element_rect(size=0.5, fill="grey95"),
        panel.background = element_rect(fill="white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.title = element_text(size = 20, face="bold"),
        legend.text = element_text(size=22),
        axis.text = element_text(size=22),
        axis.text.x = element_text(angle = 90, hjust = 2))+
  labs(fill="City")
ggsave("barplot_infect_dead_age_effect.pdf", width = 12, height = 12)

```



```{r sensitivity test of R03.5}


#test age effects

birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")




#para 9
hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis

#para 11
quar.rate_nairobi =c(rep(0.0001,9))
quar.rate_daegu =c(rep(0.0001,9))
quar.rate_nyc =c(rep(0.0001,9))
quar.rate_la =c(rep(0.0001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0-1
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.


nyc_int_travel_import_data <- readRDS("nyc_int_travel_import_data.rds")
nyc_int_travel_export_data <- readRDS("nyc_int_travel_export_data.rds")
nyc_dom_travel_import_data <- readRDS("nyc_dom_travel_import_data.rds")
nyc_dom_travel_export_data <- readRDS("nyc_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_nyc_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "New York")
age_specific_incidence_prop_nyc_extend_agg<-fread("age_specific_prop_nyc_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")




tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)
#contact matrix package

contact_matrix_9age_ny <-readRDS("contact_matrix_9age_ny.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_ny <- list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work,contact_matrix_9age_ny$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_ny<-list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work*0.95,contact_matrix_9age_ny$other*0.98)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_ny<-list(contact_matrix_9age_ny$home*1.2,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.6,contact_matrix_9age_ny$other*0.8)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.45)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.3,contact_matrix_9age_ny$other*0.3)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.40)


#transmissibility
#transmissibility

transmissibility_9age_nyc <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nyc, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc,"transmissibility_9age_nyc.rds")

transmissibility_9age_nyc <- readRDS("transmissibility_9age_nyc.rds")
###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact_matrix_9age_nointer_ny)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p1_ny)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p2_ny)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p3_ny)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p4_ny)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p5_ny)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc.rds")



#population age-specific weights 
pop_age_weight_nyc_la <- pop_age_structure_la/pop_age_structure_nyc
pop_age_weight_nyc_daegu <- pop_age_structure_daegu/pop_age_structure_nyc
pop_age_weight_nyc_nairobi <- pop_age_structure_nairobi/pop_age_structure_nyc

#transmissiblity adjusted by population structure in la

transmissibility_9age_nyc_la <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_la, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_la,"transmissibility_9age_nyc_la.rds")
 
transmissibility_9age_nyc_la <- readRDS("transmissibility_9age_nyc_la.rds")

###transmission rate
transm.rate_without_intervention_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_without_intervention_nyc_la,"transm.rate_without_intervention_nyc_la.rds")
transm.rate_package1_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package1_nyc_la,"transm.rate_package1_nyc_la.rds")
transm.rate_package2_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package2_nyc_la,"transm.rate_package2_nyc_la.rds")
transm.rate_package3_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package3_nyc_la,"transm.rate_package3_nyc_la.rds")
transm.rate_package4_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package4_nyc_la,"transm.rate_package4_nyc_la.rds")
transm.rate_package5_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package5_nyc_la,"transm.rate_package5_nyc_la.rds")


#transmissiblity adjusted by population structure in daegu
transmissibility_9age_nyc_daegu <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_daegu, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_daegu,"transmissibility_9age_nyc_daegu.rds")
 
transmissibility_9age_nyc_daegu <- readRDS("transmissibility_9age_nyc_daegu.rds")

###transmission rate
transm.rate_without_intervention_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_without_intervention_nyc_daegu,"transm.rate_without_intervention_nyc_daegu.rds")
transm.rate_package1_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package1_nyc_daegu,"transm.rate_package1_nyc_daegu.rds")
transm.rate_package2_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package2_nyc_daegu,"transm.rate_package2_nyc_daegu.rds")
transm.rate_package3_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package3_nyc_daegu,"transm.rate_package3_nyc_daegu.rds")
transm.rate_package4_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package4_nyc_daegu,"transm.rate_package4_nyc_daegu.rds")
transm.rate_package5_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package5_nyc_daegu,"transm.rate_package5_nyc_daegu.rds")


#transmissiblity adjusted by population structure in nairobi
transmissibility_9age_nyc_nairobi <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nairobi, calculate_transmission_probability = 1, contact.matrix =contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_nairobi,"transmissibility_9age_nyc_nairobi.rds")
 
transmissibility_9age_nyc_nairobi <- readRDS("transmissibility_9age_nyc_nairobi.rds")

###transmission rate
transm.rate_without_intervention_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_without_intervention_nyc_nairobi,"transm.rate_without_intervention_nyc_nairobi.rds")
transm.rate_package1_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package1_nyc_nairobi,"transm.rate_package1_nyc_nairobi.rds")
transm.rate_package2_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package2_nyc_nairobi,"transm.rate_package2_nyc_nairobi.rds")
transm.rate_package3_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package3_nyc_nairobi,"transm.rate_package3_nyc_nairobi.rds")
transm.rate_package4_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package4_nyc_nairobi,"transm.rate_package4_nyc_nairobi.rds")
transm.rate_package5_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package5_nyc_nairobi,"transm.rate_package5_nyc_nairobi.rds")



#US-New York City
parameters_nyc <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


#US-la City
parameters_nyc_la <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_la,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_la*pop_nyc)

#US-daegu City
parameters_nyc_daegu <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_daegu,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_daegu*pop_nyc)


#US-nairobi City
parameters_nyc_nairobi <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_nairobi,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nairobi*pop_nyc)


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

#"2020-03-02"
constraint_package1_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc/transm.rate_without_intervention_nyc),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

#2020-04-03
constraint_package5_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")


#2020-05-18
constraint_package6_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")


#nyc la age structure
constraint_no_intervention_nyc_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_la,"constraint_no_intervention_nyc_la.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_la/transm.rate_without_intervention_nyc_la),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_la,"constraint_package1_nyc_la.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_la,"constraint_package2_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_la,"constraint_package3_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_la,"constraint_package4_nyc_la.rds")

#2020-04-03
constraint_package5_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_la,"constraint_package5_nyc_la.rds")


#2020-05-18
constraint_package6_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_la,"constraint_package6_nyc_la.rds")


#nyc daegu age structure
constraint_no_intervention_nyc_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_daegu,"constraint_no_intervention_nyc_daegu.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_daegu/transm.rate_without_intervention_nyc_daegu),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_daegu,"constraint_package1_nyc_daegu.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_daegu,"constraint_package2_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_daegu,"constraint_package3_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_daegu,"constraint_package4_nyc_daegu.rds")

#2020-04-03
constraint_package5_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_daegu,"constraint_package5_nyc_daegu.rds")


#2020-05-18
constraint_package6_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_daegu,"constraint_package6_nyc_daegu.rds")


#nyc nairobi age structure
constraint_no_intervention_nyc_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_nairobi,"constraint_no_intervention_nyc_nairobi.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_nairobi,"constraint_package1_nyc_nairobi.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_nairobi,"constraint_package2_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_nairobi,"constraint_package3_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_nairobi,"constraint_package4_nyc_nairobi.rds")

#2020-04-03
constraint_package5_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_nairobi,"constraint_package5_nyc_nairobi.rds")


#2020-05-18
constraint_package6_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_nairobi,"constraint_package6_nyc_nairobi.rds")

E. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")





E. = pop_nyc*pop_age_structure_la*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_la*2e-06
initials_nyc_la <- c(S. = pop_nyc*pop_age_structure_la- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_la*2e-06)
saveRDS(initials_nyc_la,"initials_nyc_la.rds")




E. = pop_nyc*pop_age_structure_daegu*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_daegu*2e-06
initials_nyc_daegu <- c(S. = pop_nyc*pop_age_structure_daegu- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_daegu*2e-06)
saveRDS(initials_nyc_daegu,"initials_nyc_daegu.rds")


E. = pop_nyc*pop_age_structure_nairobi*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nairobi*2e-06
initials_nyc_nairobi <- c(S. = pop_nyc*pop_age_structure_nairobi- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nyc_nairobi,"initials_nyc_nairobi.rds")



#simulate the cases


SEIHDQR_9age_simulation_nyc_estimate_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


#plots
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Ageing effects")

ggsave("line_plot_ID_9age_simulation_nyc_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_la, init = initials_nyc_la, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_la, constraint2 = constraint_package2_nyc_la, constraint3 = constraint_package3_nyc_la, constraint4 = constraint_package4_nyc_la, constraint5 = constraint_package5_nyc_la, constraint6 = constraint_package6_nyc_la)


#plots
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_la_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_la_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_la_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Los Angeles")

ggsave("line_plot_ID_9age_simulation_nyc_la_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_daegu, init = initials_nyc_daegu, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_daegu, constraint2 = constraint_package2_nyc_daegu, constraint3 = constraint_package3_nyc_daegu, constraint4 = constraint_package4_nyc_daegu, constraint5 = constraint_package5_nyc_daegu, constraint6 = constraint_package6_nyc_daegu)


#plots
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_daegu_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_daegu_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_daegu_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Daegu")

ggsave("line_plot_ID_9age_simulation_nyc_daegu_ageeffect.pdf", width = 12, height = 10)



SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_nairobi, init = initials_nyc_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_nairobi, constraint2 = constraint_package2_nyc_nairobi, constraint3 = constraint_package3_nyc_nairobi, constraint4 = constraint_package4_nyc_nairobi, constraint5 = constraint_package5_nyc_nairobi, constraint6 = constraint_package6_nyc_nairobi)


#plots
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_nairobi_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Nairobi")

ggsave("line_plot_ID_9age_simulation_nyc_nairobi_ageeffect.pdf", width = 12, height = 10)




#tidy up data
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- "New York"
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$city <- "Los Angeles"
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$city <- "Daegu"
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$city <- "Nairobi"

age_effect_estimate_fourcities <- rbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long)
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$period <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- NULL
names(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long)[2] <- c("estimate_nyc")

age_effect_estimate_fourcities <- merge(age_effect_estimate_fourcities, SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, by=c("time","state","age_group"))
write.csv(age_effect_estimate_fourcities,"age_effect_estimate_fourcities.csv",row.names = F)

infect_dead_age_effect_estimate_fourcities <- subset(age_effect_estimate_fourcities, state=="I" | state =="D")
infect_dead_age_effect_estimate_fourcities_agg <- aggregate(cbind(estimate,estimate_nyc)~state+city, FUN=sum, infect_dead_age_effect_estimate_fourcities, na.rm=T)

infect_dead_age_effect_estimate_fourcities_agg$age_effect <- (infect_dead_age_effect_estimate_fourcities_agg$estimate-infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc)/infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc

write.csv(infect_dead_age_effect_estimate_fourcities_agg,"infect_dead_age_effect_estimate_fourcities_agg.csv",row.names = F)

barplot_infect_dead_age_effect <- ggplot(infect_dead_age_effect_estimate_fourcities_agg, aes(x=state, y=age_effect))+
  geom_bar(position="dodge", stat="identity", aes(fill=reorder(city, -age_effect)))+

  geom_text(aes(y=age_effect,label = paste0(round(age_effect, 3)), group=reorder(city, -age_effect)), position = position_dodge(width=1),angle=90, col = "black",size=8)+
  scale_y_continuous(name = "Effects of population ageing")+ #, breaks = seq(0,0.6e+12, 0.1e+12), labels = paste0(as.character(c(seq(0,0.6,0.1))))
  scale_x_discrete()+
  scale_fill_viridis_d(option="plasma", begin = 0.1)+
  #facet_wrap(.~city, ncol = 2)+
  theme(axis.title = element_text(size = 22),
        strip.text = element_text(size = 22),
        strip.background = element_rect(size=0.5, fill="grey95"),
        panel.background = element_rect(fill="white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.title = element_text(size = 20, face="bold"),
        legend.text = element_text(size=22),
        axis.text = element_text(size=22),
        axis.text.x = element_text(angle = 90, hjust = 2))+
  labs(fill="City")
ggsave("barplot_infect_dead_age_effect.pdf", width = 12, height = 12)


```

```{r sensitivity analysis R0 5.5}


#test age effects
birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")




#para 9
hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis

#para 11
quar.rate_nairobi =c(rep(0.0001,9))
quar.rate_daegu =c(rep(0.0001,9))
quar.rate_nyc =c(rep(0.0001,9))
quar.rate_la =c(rep(0.0001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0+1
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.


nyc_int_travel_import_data <- readRDS("nyc_int_travel_import_data.rds")
nyc_int_travel_export_data <- readRDS("nyc_int_travel_export_data.rds")
nyc_dom_travel_import_data <- readRDS("nyc_dom_travel_import_data.rds")
nyc_dom_travel_export_data <- readRDS("nyc_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_nyc_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "New York")
age_specific_incidence_prop_nyc_extend_agg<-fread("age_specific_prop_nyc_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")




tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)
#contact matrix package

contact_matrix_9age_ny <-readRDS("contact_matrix_9age_ny.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_ny <- list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work,contact_matrix_9age_ny$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_ny<-list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work*0.95,contact_matrix_9age_ny$other*0.98)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_ny<-list(contact_matrix_9age_ny$home*1.2,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.6,contact_matrix_9age_ny$other*0.8)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.45)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.3,contact_matrix_9age_ny$other*0.3)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.40)



#transmissibility

transmissibility_9age_nyc <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nyc, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc,"transmissibility_9age_nyc.rds")

transmissibility_9age_nyc <- readRDS("transmissibility_9age_nyc.rds")
###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact_matrix_9age_nointer_ny)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p1_ny)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p2_ny)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p3_ny)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p4_ny)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p5_ny)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc.rds")



#population age-specific weights 
pop_age_weight_nyc_la <- pop_age_structure_la/pop_age_structure_nyc
pop_age_weight_nyc_daegu <- pop_age_structure_daegu/pop_age_structure_nyc
pop_age_weight_nyc_nairobi <- pop_age_structure_nairobi/pop_age_structure_nyc

#transmissiblity adjusted by population structure in la

transmissibility_9age_nyc_la <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_la, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_la,"transmissibility_9age_nyc_la.rds")
 
transmissibility_9age_nyc_la <- readRDS("transmissibility_9age_nyc_la.rds")

###transmission rate
transm.rate_without_intervention_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_without_intervention_nyc_la,"transm.rate_without_intervention_nyc_la.rds")
transm.rate_package1_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package1_nyc_la,"transm.rate_package1_nyc_la.rds")
transm.rate_package2_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package2_nyc_la,"transm.rate_package2_nyc_la.rds")
transm.rate_package3_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package3_nyc_la,"transm.rate_package3_nyc_la.rds")
transm.rate_package4_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package4_nyc_la,"transm.rate_package4_nyc_la.rds")
transm.rate_package5_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package5_nyc_la,"transm.rate_package5_nyc_la.rds")


#transmissiblity adjusted by population structure in daegu
transmissibility_9age_nyc_daegu <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_daegu, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_daegu,"transmissibility_9age_nyc_daegu.rds")
 
transmissibility_9age_nyc_daegu <- readRDS("transmissibility_9age_nyc_daegu.rds")

###transmission rate
transm.rate_without_intervention_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_without_intervention_nyc_daegu,"transm.rate_without_intervention_nyc_daegu.rds")
transm.rate_package1_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package1_nyc_daegu,"transm.rate_package1_nyc_daegu.rds")
transm.rate_package2_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package2_nyc_daegu,"transm.rate_package2_nyc_daegu.rds")
transm.rate_package3_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package3_nyc_daegu,"transm.rate_package3_nyc_daegu.rds")
transm.rate_package4_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package4_nyc_daegu,"transm.rate_package4_nyc_daegu.rds")
transm.rate_package5_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package5_nyc_daegu,"transm.rate_package5_nyc_daegu.rds")


#transmissiblity adjusted by population structure in nairobi
transmissibility_9age_nyc_nairobi <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nairobi, calculate_transmission_probability = 1, contact.matrix =contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_nairobi,"transmissibility_9age_nyc_nairobi.rds")
 
transmissibility_9age_nyc_nairobi <- readRDS("transmissibility_9age_nyc_nairobi.rds")

###transmission rate
transm.rate_without_intervention_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_without_intervention_nyc_nairobi,"transm.rate_without_intervention_nyc_nairobi.rds")
transm.rate_package1_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package1_nyc_nairobi,"transm.rate_package1_nyc_nairobi.rds")
transm.rate_package2_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package2_nyc_nairobi,"transm.rate_package2_nyc_nairobi.rds")
transm.rate_package3_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package3_nyc_nairobi,"transm.rate_package3_nyc_nairobi.rds")
transm.rate_package4_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package4_nyc_nairobi,"transm.rate_package4_nyc_nairobi.rds")
transm.rate_package5_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package5_nyc_nairobi,"transm.rate_package5_nyc_nairobi.rds")



#US-New York City
parameters_nyc <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


#US-la City
parameters_nyc_la <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_la,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_la*pop_nyc)

#US-daegu City
parameters_nyc_daegu <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_daegu,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_daegu*pop_nyc)


#US-nairobi City
parameters_nyc_nairobi <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_nairobi,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nairobi*pop_nyc)


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

#"2020-03-02"
constraint_package1_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc/transm.rate_without_intervention_nyc),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

#2020-04-03
constraint_package5_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")


#2020-05-18
constraint_package6_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")


#nyc la age structure
constraint_no_intervention_nyc_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_la,"constraint_no_intervention_nyc_la.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_la/transm.rate_without_intervention_nyc_la),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_la,"constraint_package1_nyc_la.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_la,"constraint_package2_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_la,"constraint_package3_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_la,"constraint_package4_nyc_la.rds")

#2020-04-03
constraint_package5_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_la,"constraint_package5_nyc_la.rds")


#2020-05-18
constraint_package6_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_la,"constraint_package6_nyc_la.rds")


#nyc daegu age structure
constraint_no_intervention_nyc_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_daegu,"constraint_no_intervention_nyc_daegu.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_daegu/transm.rate_without_intervention_nyc_daegu),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_daegu,"constraint_package1_nyc_daegu.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_daegu,"constraint_package2_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_daegu,"constraint_package3_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_daegu,"constraint_package4_nyc_daegu.rds")

#2020-04-03
constraint_package5_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_daegu,"constraint_package5_nyc_daegu.rds")


#2020-05-18
constraint_package6_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_daegu,"constraint_package6_nyc_daegu.rds")


#nyc nairobi age structure
constraint_no_intervention_nyc_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_nairobi,"constraint_no_intervention_nyc_nairobi.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_nairobi,"constraint_package1_nyc_nairobi.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_nairobi,"constraint_package2_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_nairobi,"constraint_package3_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_nairobi,"constraint_package4_nyc_nairobi.rds")

#2020-04-03
constraint_package5_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_nairobi,"constraint_package5_nyc_nairobi.rds")


#2020-05-18
constraint_package6_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_nairobi,"constraint_package6_nyc_nairobi.rds")

E. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")





E. = pop_nyc*pop_age_structure_la*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_la*2e-06
initials_nyc_la <- c(S. = pop_nyc*pop_age_structure_la- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_la*2e-06)
saveRDS(initials_nyc_la,"initials_nyc_la.rds")




E. = pop_nyc*pop_age_structure_daegu*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_daegu*2e-06
initials_nyc_daegu <- c(S. = pop_nyc*pop_age_structure_daegu- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_daegu*2e-06)
saveRDS(initials_nyc_daegu,"initials_nyc_daegu.rds")


E. = pop_nyc*pop_age_structure_nairobi*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nairobi*2e-06
initials_nyc_nairobi <- c(S. = pop_nyc*pop_age_structure_nairobi- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nyc_nairobi,"initials_nyc_nairobi.rds")



#simulate the cases


SEIHDQR_9age_simulation_nyc_estimate_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


#plots
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Ageing effects")

ggsave("line_plot_ID_9age_simulation_nyc_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_la, init = initials_nyc_la, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_la, constraint2 = constraint_package2_nyc_la, constraint3 = constraint_package3_nyc_la, constraint4 = constraint_package4_nyc_la, constraint5 = constraint_package5_nyc_la, constraint6 = constraint_package6_nyc_la)


#plots
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_la_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_la_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_la_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Los Angeles")

ggsave("line_plot_ID_9age_simulation_nyc_la_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_daegu, init = initials_nyc_daegu, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_daegu, constraint2 = constraint_package2_nyc_daegu, constraint3 = constraint_package3_nyc_daegu, constraint4 = constraint_package4_nyc_daegu, constraint5 = constraint_package5_nyc_daegu, constraint6 = constraint_package6_nyc_daegu)


#plots
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_daegu_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_daegu_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_daegu_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Daegu")

ggsave("line_plot_ID_9age_simulation_nyc_daegu_ageeffect.pdf", width = 12, height = 10)



SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_nairobi, init = initials_nyc_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_nairobi, constraint2 = constraint_package2_nyc_nairobi, constraint3 = constraint_package3_nyc_nairobi, constraint4 = constraint_package4_nyc_nairobi, constraint5 = constraint_package5_nyc_nairobi, constraint6 = constraint_package6_nyc_nairobi)


#plots
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_nairobi_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Nairobi")

ggsave("line_plot_ID_9age_simulation_nyc_nairobi_ageeffect.pdf", width = 12, height = 10)




#tidy up data
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- "New York"
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$city <- "Los Angeles"
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$city <- "Daegu"
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$city <- "Nairobi"

age_effect_estimate_fourcities <- rbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long)
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$period <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- NULL
names(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long)[2] <- c("estimate_nyc")

age_effect_estimate_fourcities <- merge(age_effect_estimate_fourcities, SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, by=c("time","state","age_group"))
write.csv(age_effect_estimate_fourcities,"age_effect_estimate_fourcities.csv",row.names = F)

infect_dead_age_effect_estimate_fourcities <- subset(age_effect_estimate_fourcities, state=="I" | state =="D")
infect_dead_age_effect_estimate_fourcities_agg <- aggregate(cbind(estimate,estimate_nyc)~state+city, FUN=sum, infect_dead_age_effect_estimate_fourcities, na.rm=T)

infect_dead_age_effect_estimate_fourcities_agg$age_effect <- (infect_dead_age_effect_estimate_fourcities_agg$estimate-infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc)/infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc

write.csv(infect_dead_age_effect_estimate_fourcities_agg,"infect_dead_age_effect_estimate_fourcities_agg.csv",row.names = F)

barplot_infect_dead_age_effect <- ggplot(infect_dead_age_effect_estimate_fourcities_agg, aes(x=state, y=age_effect))+
  geom_bar(position="dodge", stat="identity", aes(fill=reorder(city, -age_effect)))+

  geom_text(aes(y=age_effect,label = paste0(round(age_effect, 3)), group=reorder(city, -age_effect)), position = position_dodge(width=1),angle=90, col = "black",size=8)+
  scale_y_continuous(name = "Effects of population ageing")+ #, breaks = seq(0,0.6e+12, 0.1e+12), labels = paste0(as.character(c(seq(0,0.6,0.1))))
  scale_x_discrete()+
  scale_fill_viridis_d(option="plasma", begin = 0.1)+
  #facet_wrap(.~city, ncol = 2)+
  theme(axis.title = element_text(size = 22),
        strip.text = element_text(size = 22),
        strip.background = element_rect(size=0.5, fill="grey95"),
        panel.background = element_rect(fill="white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.title = element_text(size = 20, face="bold"),
        legend.text = element_text(size=22),
        axis.text = element_text(size=22),
        axis.text.x = element_text(angle = 90, hjust = 2))+
  labs(fill="City")
ggsave("barplot_infect_dead_age_effect.pdf", width = 12, height = 12)

```



```{r sensitivity analysis R0 2.5}


#test age effects

#test age effects
birth.rate_nyc<-readRDS("birth_rate_nyc_daily.rds")
birth.rate_la<-readRDS("birth_rate_los_angeles_daily.rds")
birth.rate_daegu<-readRDS("birth_rate_daegu_daily.rds")
birth.rate_nairobi<-readRDS("birth_rate_nairobi_daily.rds")


death.rate_nyc<-readRDS("death_rate_nyc_daily.rds")
death.rate_la<-readRDS("death_rate_los_angeles_daily.rds")
death.rate_daegu<-readRDS("death_rate_daegu_daily.rds")
death.rate_nairobi<-readRDS("death_rate_nairobi_daily.rds")

pop_age_structure_nyc<-readRDS("pop_age_structure_nyc.rds")
pop_age_structure_la<-readRDS("pop_age_structure_la.rds")
pop_age_structure_daegu<-readRDS("pop_age_structure_daegu.rds")
pop_age_structure_nairobi<-readRDS("pop_age_structure_nairobi.rds")

incub.rate<-readRDS("incub.rate.rds")
recov.rate<-readRDS("recov.rate.rds")




#para 9
hosp.rate_nairobi <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_daegu <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_nyc <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
hosp.rate_la <- c(0.001,0.003,0.012,0.032,0.049,0.102,0.166,0.243,0.273) #imperial college & Estimates of the severity of coronavirus disease 2019
#para 10
fatal.rate_nairobi = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_daegu = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_nyc = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis
fatal.rate_la = c(0.0026/100,0.0148/100,0.06/100,0.146/100,0.295/100,1.25/100,3.99/100,8.61/100,13.4/100)#c(0.00161/100,0.00695/100,0.0309/100,0.0844/100,0.161/100,0.595/100,1.93/100,4.28/100,7.8/100)#Estimates of the severity of coronavirus disease 2019: a model-based analysis

#para 11
quar.rate_nairobi =c(rep(0.0001,9))
quar.rate_daegu =c(rep(0.0001,9))
quar.rate_nyc =c(rep(0.0001,9))
quar.rate_la =c(rep(0.0001,9))

#para 4
pop_nyc=8.399e+06 #population in New York city
pop_la=3.99e+06
pop_daegu=2.465e+06
pop_nairobi=4.397e+06

R0_fourcities<-fread("R0_fourcities.csv")
R0t_nyc = subset(R0_fourcities, city=="ny")$R0-2
R0t_la = subset(R0_fourcities, city=="la")$R0
R0t_daegu = subset(R0_fourcities, city=="daegu")$R0
R0t_nairobi = subset(R0_fourcities, city=="nairobi")$R0 # imperial college study #sensitivity test for R0 = 2 and R0 = 3.


nyc_int_travel_import_data <- readRDS("nyc_int_travel_import_data.rds")
nyc_int_travel_export_data <- readRDS("nyc_int_travel_export_data.rds")
nyc_dom_travel_import_data <- readRDS("nyc_dom_travel_import_data.rds")
nyc_dom_travel_export_data <- readRDS("nyc_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_nyc_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "New York")
age_specific_incidence_prop_nyc_extend_agg<-fread("age_specific_prop_nyc_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")




tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)
#contact matrix package

contact_matrix_9age_ny <-readRDS("contact_matrix_9age_ny.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_ny <- list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work,contact_matrix_9age_ny$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_ny<-list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work*0.95,contact_matrix_9age_ny$other*0.98)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_ny<-list(contact_matrix_9age_ny$home*1.2,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.6,contact_matrix_9age_ny$other*0.8)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.45)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.3,contact_matrix_9age_ny$other*0.3)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.40)


#transmissibility
#transmissibility

transmissibility_9age_nyc <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nyc, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc,"transmissibility_9age_nyc.rds")

transmissibility_9age_nyc <- readRDS("transmissibility_9age_nyc.rds")
###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact_matrix_9age_nointer_ny)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p1_ny)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p2_ny)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p3_ny)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p4_ny)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p5_ny)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc.rds")



#population age-specific weights 
pop_age_weight_nyc_la <- pop_age_structure_la/pop_age_structure_nyc
pop_age_weight_nyc_daegu <- pop_age_structure_daegu/pop_age_structure_nyc
pop_age_weight_nyc_nairobi <- pop_age_structure_nairobi/pop_age_structure_nyc

#transmissiblity adjusted by population structure in la

transmissibility_9age_nyc_la <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_la, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_la,"transmissibility_9age_nyc_la.rds")
 
transmissibility_9age_nyc_la <- readRDS("transmissibility_9age_nyc_la.rds")

###transmission rate
transm.rate_without_intervention_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_without_intervention_nyc_la,"transm.rate_without_intervention_nyc_la.rds")
transm.rate_package1_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package1_nyc_la,"transm.rate_package1_nyc_la.rds")
transm.rate_package2_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package2_nyc_la,"transm.rate_package2_nyc_la.rds")
transm.rate_package3_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package3_nyc_la,"transm.rate_package3_nyc_la.rds")
transm.rate_package4_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package4_nyc_la,"transm.rate_package4_nyc_la.rds")
transm.rate_package5_nyc_la <- unlist(transmissibility_9age_nyc_la)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_la
saveRDS(transm.rate_package5_nyc_la,"transm.rate_package5_nyc_la.rds")


#transmissiblity adjusted by population structure in daegu
transmissibility_9age_nyc_daegu <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_daegu, calculate_transmission_probability = 1, contact.matrix = contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_daegu,"transmissibility_9age_nyc_daegu.rds")
 
transmissibility_9age_nyc_daegu <- readRDS("transmissibility_9age_nyc_daegu.rds")

###transmission rate
transm.rate_without_intervention_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_without_intervention_nyc_daegu,"transm.rate_without_intervention_nyc_daegu.rds")
transm.rate_package1_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package1_nyc_daegu,"transm.rate_package1_nyc_daegu.rds")
transm.rate_package2_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package2_nyc_daegu,"transm.rate_package2_nyc_daegu.rds")
transm.rate_package3_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package3_nyc_daegu,"transm.rate_package3_nyc_daegu.rds")
transm.rate_package4_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package4_nyc_daegu,"transm.rate_package4_nyc_daegu.rds")
transm.rate_package5_nyc_daegu <- unlist(transmissibility_9age_nyc_daegu)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_daegu
saveRDS(transm.rate_package5_nyc_daegu,"transm.rate_package5_nyc_daegu.rds")


#transmissiblity adjusted by population structure in nairobi
transmissibility_9age_nyc_nairobi <- calculate_transimissibility(R0t = R0t_nyc, recov.rate = recov.rate, pop_age_structure = pop_age_structure_nairobi, calculate_transmission_probability = 1, contact.matrix =contact_matrix_9age_ny)
saveRDS(transmissibility_9age_nyc_nairobi,"transmissibility_9age_nyc_nairobi.rds")
 
transmissibility_9age_nyc_nairobi <- readRDS("transmissibility_9age_nyc_nairobi.rds")

###transmission rate
transm.rate_without_intervention_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact_matrix_9age_nointer_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_without_intervention_nyc_nairobi,"transm.rate_without_intervention_nyc_nairobi.rds")
transm.rate_package1_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p1_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package1_nyc_nairobi,"transm.rate_package1_nyc_nairobi.rds")
transm.rate_package2_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p2_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package2_nyc_nairobi,"transm.rate_package2_nyc_nairobi.rds")
transm.rate_package3_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p3_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package3_nyc_nairobi,"transm.rate_package3_nyc_nairobi.rds")
transm.rate_package4_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p4_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package4_nyc_nairobi,"transm.rate_package4_nyc_nairobi.rds")
transm.rate_package5_nyc_nairobi <- unlist(transmissibility_9age_nyc_nairobi)*Reduce('+', contact.matrix_p5_ny)* pop_age_weight_nyc_nairobi
saveRDS(transm.rate_package5_nyc_nairobi,"transm.rate_package5_nyc_nairobi.rds")



#US-New York City
parameters_nyc <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


#US-la City
parameters_nyc_la <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_la,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_la*pop_nyc)

#US-daegu City
parameters_nyc_daegu <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_daegu,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_daegu*pop_nyc)


#US-nairobi City
parameters_nyc_nairobi <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*tourism_age_structure,
                       i.export=nyc_int_travel_export_data*pop_age_structure_nairobi,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nairobi*pop_nyc)


constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

#"2020-03-02"
constraint_package1_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc/transm.rate_without_intervention_nyc),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

#2020-04-03
constraint_package5_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")


#2020-05-18
constraint_package6_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")


#nyc la age structure
constraint_no_intervention_nyc_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_la,"constraint_no_intervention_nyc_la.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_la/transm.rate_without_intervention_nyc_la),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_la,"constraint_package1_nyc_la.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_la,"constraint_package2_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_la,"constraint_package3_nyc_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_la/transm.rate_without_intervention_nyc_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_la,"constraint_package4_nyc_la.rds")

#2020-04-03
constraint_package5_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_la,"constraint_package5_nyc_la.rds")


#2020-05-18
constraint_package6_nyc_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_la/transm.rate_without_intervention_nyc_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_la,"constraint_package6_nyc_la.rds")


#nyc daegu age structure
constraint_no_intervention_nyc_daegu <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_daegu,"constraint_no_intervention_nyc_daegu.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_daegu/transm.rate_without_intervention_nyc_daegu),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_daegu,"constraint_package1_nyc_daegu.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_daegu,"constraint_package2_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_daegu,"constraint_package3_nyc_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_daegu,"constraint_package4_nyc_daegu.rds")

#2020-04-03
constraint_package5_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_daegu,"constraint_package5_nyc_daegu.rds")


#2020-05-18
constraint_package6_nyc_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_daegu/transm.rate_without_intervention_nyc_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_daegu,"constraint_package6_nyc_daegu.rds")


#nyc nairobi age structure
constraint_no_intervention_nyc_nairobi <- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc_nairobi,"constraint_no_intervention_nyc_nairobi.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc_nairobi,"constraint_package1_nyc_nairobi.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc_nairobi,"constraint_package2_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc_nairobi,"constraint_package3_nyc_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc_nairobi,"constraint_package4_nyc_nairobi.rds")

#2020-04-03
constraint_package5_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc_nairobi,"constraint_package5_nyc_nairobi.rds")


#2020-05-18
constraint_package6_nyc_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc_nairobi/transm.rate_without_intervention_nyc_nairobi*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc_nairobi,"constraint_package6_nyc_nairobi.rds")


E. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")





E. = pop_nyc*pop_age_structure_la*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_la*2e-06
initials_nyc_la <- c(S. = pop_nyc*pop_age_structure_la- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_la*2e-06)
saveRDS(initials_nyc_la,"initials_nyc_la.rds")




E. = pop_nyc*pop_age_structure_daegu*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_daegu*2e-06
initials_nyc_daegu <- c(S. = pop_nyc*pop_age_structure_daegu- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_daegu*2e-06)
saveRDS(initials_nyc_daegu,"initials_nyc_daegu.rds")


E. = pop_nyc*pop_age_structure_nairobi*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nairobi*2e-06
initials_nyc_nairobi <- c(S. = pop_nyc*pop_age_structure_nairobi- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nyc_nairobi,"initials_nyc_nairobi.rds")


#simulate the cases


SEIHDQR_9age_simulation_nyc_estimate_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


#plots
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Ageing effects")

ggsave("line_plot_ID_9age_simulation_nyc_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_la, init = initials_nyc_la, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_la, constraint2 = constraint_package2_nyc_la, constraint3 = constraint_package3_nyc_la, constraint4 = constraint_package4_nyc_la, constraint5 = constraint_package5_nyc_la, constraint6 = constraint_package6_nyc_la)


#plots
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_la_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_la_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_la_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Los Angeles")

ggsave("line_plot_ID_9age_simulation_nyc_la_ageeffect.pdf", width = 12, height = 10)




SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_daegu, init = initials_nyc_daegu, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_daegu, constraint2 = constraint_package2_nyc_daegu, constraint3 = constraint_package3_nyc_daegu, constraint4 = constraint_package4_nyc_daegu, constraint5 = constraint_package5_nyc_daegu, constraint6 = constraint_package6_nyc_daegu)


#plots
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_daegu_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_daegu_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_daegu_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Daegu")

ggsave("line_plot_ID_9age_simulation_nyc_daegu_ageeffect.pdf", width = 12, height = 10)



SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_nairobi, init = initials_nyc_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc_nairobi, constraint2 = constraint_package2_nyc_nairobi, constraint3 = constraint_package3_nyc_nairobi, constraint4 = constraint_package4_nyc_nairobi, constraint5 = constraint_package5_nyc_nairobi, constraint6 = constraint_package6_nyc_nairobi)


#plots
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect %>% gather(SEIHDQR, estimate, -c(time, period))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long ,"SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="D"))
ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long, state=="I" | state == "D")#
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
line_plot_ID_9age_simulation_nyc_nairobi_ageeffect <- ggplot(ID_9age_simulation_nyc_estimate_nairobi_ageeffect_long, aes(x= time, y= estimate, shape=state, color=as.factor(age_group)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(aes(linetype = state),alpha=0.8, size=1.5)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Age"))+
  ggtitle("Age structure in Nairobi")

ggsave("line_plot_ID_9age_simulation_nyc_nairobi_ageeffect.pdf", width = 12, height = 10)




#tidy up data
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long <- fread("SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long<-fread("SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long.csv")

SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- "New York"
SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long$city <- "Los Angeles"
SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long$city <- "Daegu"
SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long$city <- "Nairobi"

age_effect_estimate_fourcities <- rbind(SEIHDQR_9age_simulation_nyc_estimate_la_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_daegu_ageeffect_long, SEIHDQR_9age_simulation_nyc_estimate_nairobi_ageeffect_long)
SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$SEIHDQR <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$period <- SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long$city <- NULL
names(SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long)[2] <- c("estimate_nyc")

age_effect_estimate_fourcities <- merge(age_effect_estimate_fourcities, SEIHDQR_9age_simulation_nyc_estimate_ageeffect_long, by=c("time","state","age_group"))
write.csv(age_effect_estimate_fourcities,"age_effect_estimate_fourcities.csv",row.names = F)

infect_dead_age_effect_estimate_fourcities <- subset(age_effect_estimate_fourcities, state=="I" | state =="D")
infect_dead_age_effect_estimate_fourcities_agg <- aggregate(cbind(estimate,estimate_nyc)~state+city, FUN=sum, infect_dead_age_effect_estimate_fourcities, na.rm=T)

infect_dead_age_effect_estimate_fourcities_agg$age_effect <- (infect_dead_age_effect_estimate_fourcities_agg$estimate-infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc)/infect_dead_age_effect_estimate_fourcities_agg$estimate_nyc

write.csv(infect_dead_age_effect_estimate_fourcities_agg,"infect_dead_age_effect_estimate_fourcities_agg.csv",row.names = F)

barplot_infect_dead_age_effect <- ggplot(infect_dead_age_effect_estimate_fourcities_agg, aes(x=state, y=age_effect))+
  geom_bar(position="dodge", stat="identity", aes(fill=reorder(city, -age_effect)))+

  geom_text(aes(y=age_effect,label = paste0(round(age_effect, 2)), group=reorder(city, -age_effect)), position = position_dodge(width=1),angle=90, col = "black",size=8)+
  scale_y_continuous(name = "Effects of population ageing")+ #, breaks = seq(0,0.6e+12, 0.1e+12), labels = paste0(as.character(c(seq(0,0.6,0.1))))
  scale_x_discrete()+
  scale_fill_viridis_d(option="plasma", begin = 0.1)+
  #facet_wrap(.~city, ncol = 2)+
  theme(axis.title = element_text(size = 22),
        strip.text = element_text(size = 22),
        strip.background = element_rect(size=0.5, fill="grey95"),
        panel.background = element_rect(fill="white"),
        panel.grid.major = element_blank(),
        panel.grid.minor = element_blank(),
        legend.title = element_text(size = 20, face="bold"),
        legend.text = element_text(size=22),
        axis.text = element_text(size=22),
        axis.text.x = element_text(angle = 90, hjust = 2))+
  labs(fill=guide_legend("City"))
ggsave("barplot_infect_dead_age_effect.pdf", width = 12, height = 12)

```


```{r sensitivity analysis plot R0}


age_effect_estimate_fourcitiesR4.5<-fread("ageing_effect_R0_ny/age_effect_estimate_fourcities.csv")
age_effect_estimate_fourcitiesR2.5<-fread("ageing_effect_policy_effects/R2.5/age_effect_estimate_fourcities.csv")
age_effect_estimate_fourcitiesR3.5<-fread("ageing_effect_policy_effects/R3.5/age_effect_estimate_fourcities.csv")
age_effect_estimate_fourcitiesR5.5<-fread("ageing_effect_policy_effects/R5.5/age_effect_estimate_fourcities.csv")
age_effect_estimate_fourcitiesR2.5$R <- 2.5
age_effect_estimate_fourcitiesR3.5$R <- 3.5
age_effect_estimate_fourcitiesR4.5$R <- 4.5
age_effect_estimate_fourcitiesR5.5$R <- 5.5
age_effect_estimate_fourcitiesRsensitivity <- rbind(age_effect_estimate_fourcitiesR2.5,age_effect_estimate_fourcitiesR3.5,age_effect_estimate_fourcitiesR4.5,age_effect_estimate_fourcitiesR5.5)
infected_dead_age_effect_estimate_fourcitiesRsensitivity <- subset(age_effect_estimate_fourcitiesRsensitivity, state == "I" |state == "D")

#infected_age_effect_estimate_fourcitiesRsensitivity <- subset(age_effect_estimate_fourcitiesRsensitivity, state == "I")

infected_dead_age_effect_estimate_fourcitiesRsensitivity_cityagg <- aggregate(cbind(estimate, estimate_nyc)~state+city+R+time, FUN=sum, infected_dead_age_effect_estimate_fourcitiesRsensitivity, na.rm=T)
infected_dead_age_effect_estimate_la_daegu_nairobi_Rsensitivity_cityagg <- infected_dead_age_effect_estimate_fourcitiesRsensitivity_cityagg[,-6]
infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg <- infected_dead_age_effect_estimate_fourcitiesRsensitivity_cityagg[,-5]
colnames(infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg) <- c("state", "city", "R", "time", "estimate")
infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg$city <- "New York"
infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg <- aggregate(estimate~state+city+R+time, FUN=mean, infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg, na.rm=T)
infected_dead_age_effect_estimate_nyc_la_daegu_nairobi_Rsensitivity_cityagg <- rbind(infected_dead_age_effect_estimate_la_daegu_nairobi_Rsensitivity_cityagg,infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg)
infected_dead_age_effect_estimate_nyc_la_daegu_nairobi_Rsensitivity_cityagg$date<-as.Date(infected_dead_age_effect_estimate_nyc_la_daegu_nairobi_Rsensitivity_cityagg$time, origin = "2020-03-02")

neworder_R<-c(2.5,3.5,4.5,5.5)

infected_dead_age_effect_estimate_nyc_la_daegu_nairobi_Rsensitivity_cityagg$R<-factor(infected_dead_age_effect_estimate_nyc_la_daegu_nairobi_Rsensitivity_cityagg$R, levels=neworder_R, labels = c("2.5","3.5","4.5","5.5"))

area_plot_infected_dead_age_effect_estimate_fourcitiesRsensitivity_cityagg <- ggplot(infected_dead_age_effect_estimate_nyc_la_daegu_nairobi_Rsensitivity_cityagg)+
  geom_area(aes(x=date, y= estimate/1000, fill=as.factor(R)),alpha=0.1, position = "identity")+
  geom_line(aes(x=date, y= estimate/1000, color = as.factor(R)), size = 1.2)+
  #geom_text(aes(label=round(age_effect,2)), color = "black", size=8)+
  #scale_fill_gradient(low="orange", high="white", limits=c(0, 1), na.value = "transparent")+
  scale_fill_viridis_d(direction = -1, option = "plasma", begin = 0, end = 0.8, name="R0")+
  scale_color_viridis_d(direction = -1, option = "plasma", begin = 0, end = 0.8, name="R0")+
  #scale_color_tron(name="R0")+
  #scale_fill_tron(name="R0")+
  # scale_color_manual(values = c("#00AFBB", "#E7B800", "#FC4E07","#293352"))+
  # scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07","#293352"))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 month", date_labels = "%Y-%m")+
  scale_y_continuous()+
  theme(
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 16,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=20, angle = 90),
        axis.text.y = element_text(size=20, angle = 0))+
  #guides(fill=FALSE)+
  facet_wrap(state~city,nrow=1, strip.position = "top")

ggsave("area_plot_infected_age_effect_estimate_fourcitiesRsensitivity_cityagg.pdf", width = 10, height = 10)

infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg <- subset(infected_dead_age_effect_estimate_nyc_la_daegu_nairobi_Rsensitivity_cityagg, city == "New York")
neworder_state <- c("I","D")
infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg$state<-factor(infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg$state, levels=neworder_state, labels = c("Infected","Dead"))
area_plot_infected_dead_age_effect_estimate_fourcitiesRsensitivity_cityagg <- ggplot(infected_dead_age_effect_estimate_nyc_Rsensitivity_cityagg)+
  geom_area(aes(x=date, y= estimate/1000, fill=as.factor(R)),alpha=0.1, position = "identity")+
  geom_line(aes(x=date, y= estimate/1000, color = as.factor(R)), size = 1.2)+
  #geom_text(aes(label=round(age_effect,2)), color = "black", size=8)+
  #scale_fill_gradient(low="orange", high="white", limits=c(0, 1), na.value = "transparent")+
  scale_fill_viridis_d(direction = -1, option = "plasma", begin = 0, end = 0.8, name="R0")+
  scale_color_viridis_d(direction = -1, option = "plasma", begin = 0, end = 0.8, name="R0")+
  #scale_color_tron(name="R0")+
  #scale_fill_tron(name="R0")+
  # scale_color_manual(values = c("#00AFBB", "#E7B800", "#FC4E07","#293352"))+
  # scale_fill_manual(values = c("#00AFBB", "#E7B800", "#FC4E07","#293352"))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 month", date_labels = "%Y-%m")+
  scale_y_continuous()+
  theme(
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 16,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=20, angle = 90),
        axis.text.y = element_text(size=20, angle = 0))+
  #guides(fill=FALSE)+
  facet_wrap(.~state,nrow=1, strip.position = "left")

ggsave("area_plot_infected_dead_age_effect_estimate_fourcitiesRsensitivity_cityagg.pdf",  width = 16, height = 8)


infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg <- aggregate(cbind(estimate, estimate_nyc)~state+city+R, FUN=sum, infected_dead_age_effect_estimate_fourcitiesRsensitivity, na.rm=T)

infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$age_effect <- (infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$estimate-infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$estimate_nyc)/infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$estimate_nyc


neworder_city<-c("Los Angeles","Daegu","Nairobi")
neworder_R<-c(2.5,3.5,4.5,5.5)
neworder_state <- c("I","D")

library(viridis)
infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$city<-factor(infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$city, levels=neworder_city)
infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$R<-factor(infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$R, levels=neworder_R, labels = c("2.5","3.5","4.5","5.5"))
infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$state<-factor(infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg$state, levels=neworder_state, labels = c("Infected","Dead"))

matrix_plot_infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg <- ggplot(infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg, aes(x=city, y= R, fill=age_effect))+
  geom_tile(color="white",size=1)+
  geom_text(aes(label=round(age_effect,3)), color = "black", size=8)+
  #scale_fill_gradient(low="orange", high="white", limits=c(-0.5, 0.2), na.value = "transparent")+
  scale_fill_viridis_c(direction = -1, option = "plasma", begin = 0, end = 1, limits=c(-0.5,0.1), name="R0") +
  scale_x_discrete(name = "City")+
  scale_y_discrete(name = "R0")+
  theme(axis.title = element_text(size = 18),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 16,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=20, angle = 0),
        axis.text.y = element_text(size=20, angle = 0))+

  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  #guides(fill=guide_legend("Ageing effect"))+
  facet_wrap(.~state,nrow=1, strip.position = "left")
ggsave("matrix_plot_infected_dead_age_effect_estimate_fourcitiesRsensitivity_agg.pdf", width = 17, height = 8)



```


```{r sensitivity analysis of population movement nyc}


nyc_int_travel_import_data <- readRDS("nyc_int_travel_import_data.rds")
nyc_int_travel_export_data <- readRDS("nyc_int_travel_export_data.rds")
nyc_dom_travel_import_data <- readRDS("nyc_dom_travel_import_data.rds")
nyc_dom_travel_export_data <- readRDS("nyc_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_nyc_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "New York")
age_specific_incidence_prop_nyc_extend_agg<-fread("age_specific_prop_nyc_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")


tourism_age_structure <- c(0.052/0.838,0.129/0.838,0.155/0.838,0.147/0.838,0.125/0.838,0.106/0.838,0.075/0.838,0.039/0.838,0.01/0.838)
#contact matrix package

contact_matrix_9age_ny <-readRDS("contact_matrix_9age_ny.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_ny <- list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work,contact_matrix_9age_ny$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_ny<-list(contact_matrix_9age_ny$home,contact_matrix_9age_ny$school,contact_matrix_9age_ny$work*0.95,contact_matrix_9age_ny$other*0.98)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_ny<-list(contact_matrix_9age_ny$home*1.2,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.6,contact_matrix_9age_ny$other*0.8)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.45)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.3,contact_matrix_9age_ny$other*0.3)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_ny<-list(contact_matrix_9age_ny$home*1.3,contact_matrix_9age_ny$school*0,contact_matrix_9age_ny$work*0.4,contact_matrix_9age_ny$other*0.40)


#transmissibility
transmissibility_9age_nyc <- readRDS("transmissibility_9age_nyc.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact_matrix_9age_nointer_ny)
saveRDS(transm.rate_without_intervention_nyc,"transm.rate_without_intervention_nyc.rds")
transm.rate_package1_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p1_ny)
saveRDS(transm.rate_package1_nyc,"transm.rate_package1_nyc.rds")
transm.rate_package2_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p2_ny)
saveRDS(transm.rate_package2_nyc,"transm.rate_package2_nyc.rds")
transm.rate_package3_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p3_ny)
saveRDS(transm.rate_package3_nyc,"transm.rate_package3_nyc.rds")
transm.rate_package4_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p4_ny)
saveRDS(transm.rate_package4_nyc,"transm.rate_package4_nyc.rds")
transm.rate_package5_nyc <- unlist(transmissibility_9age_nyc)*Reduce('+', contact.matrix_p5_ny)
saveRDS(transm.rate_package5_nyc,"transm.rate_package5_nyc.rds")


parameters_nyc_base <- list(i.import=nyc_int_travel_import_data*tourism_age_structure,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc,
                       i.export=nyc_int_travel_export_data*tourism_age_structure,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


parameters_nyc_10more <- list(i.import=nyc_int_travel_import_data*tourism_age_structure*1.1,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc*1.1,
                       i.export=nyc_int_travel_export_data*tourism_age_structure*1.1,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc*1.1,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)

parameters_nyc_30more <- list(i.import=nyc_int_travel_import_data*tourism_age_structure*1.3,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc*1.3,
                       i.export=nyc_int_travel_export_data*tourism_age_structure*1.3,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc*1.3,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)
parameters_nyc_50more <- list(i.import=nyc_int_travel_import_data*tourism_age_structure*1.5,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc*1.5,
                       i.export=nyc_int_travel_export_data*tourism_age_structure*1.5,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc*1.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)


parameters_nyc_10less <- list(i.import=nyc_int_travel_import_data*tourism_age_structure*0.9,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc*0.9,
                       i.export=nyc_int_travel_export_data*tourism_age_structure*0.9,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc*0.9,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)

parameters_nyc_30less <- list(i.import=nyc_int_travel_import_data*tourism_age_structure*0.7,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc*0.7,
                       i.export=nyc_int_travel_export_data*tourism_age_structure*0.7,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc*0.7,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)
parameters_nyc_50less <- list(i.import=nyc_int_travel_import_data*tourism_age_structure*0.5,
                       d.import=nyc_dom_travel_import_data*pop_age_structure_nyc*0.5,
                       i.export=nyc_int_travel_export_data*tourism_age_structure*0.5,
                       d.export=nyc_dom_travel_export_data*pop_age_structure_nyc*0.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nyc_extend_annual_agg[1,2:10]*0.1)),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[1,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nyc,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nyc,#hospitalization rate
                       fatal.rate = fatal.rate_nyc,
                       quar.rate = quar.rate_nyc,
                       death.rate = death.rate_nyc,
                       birth.rate = birth.rate_nyc,
                       n = pop_age_structure_nyc*pop_nyc)

constraint_no_intervention_nyc<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nyc,"constraint_no_intervention_nyc.rds")

#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
#"2020-03-02"
constraint_package1_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.98,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.export = c(rep(0.98,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nyc_extend_agg[1,3:11]),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[6,3:11]),3)),
                               transm.rate = as.matrix(transm.rate_package1_nyc/transm.rate_without_intervention_nyc),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nyc,"constraint_package1_nyc.rds")



#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
#"2020-03-16"
constraint_package2_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.556,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.556,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[2,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[7,3:11]),3)),
                               transm.rate = transm.rate_package2_nyc/transm.rate_without_intervention_nyc,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.05,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nyc,"constraint_package2_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#"2020-03-21"
constraint_package3_nyc<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.60,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.60,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[7,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nyc,"constraint_package3_nyc.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-03-25
constraint_package4_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.70,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.export = c(rep(1-0.70,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[3,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]),3)),
                               transm.rate = transm.rate_package3_nyc/transm.rate_without_intervention_nyc*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nyc,"constraint_package4_nyc.rds")

#2020-04-03
constraint_package5_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.80,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.80,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[4,3:11])),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[9,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.5,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nyc,"constraint_package5_nyc.rds")


#2020-05-18
constraint_package6_nyc <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(0.1,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(0.1,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nyc_extend_agg[8,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[13,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_nyc/transm.rate_without_intervention_nyc*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.7,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nyc,"constraint_package6_nyc.rds")


E. = pop_nyc*pop_age_structure_nyc*2e-06/incub.rate
I. = pop_nyc*pop_age_structure_nyc*2e-06
initials_nyc <- c(S. = pop_nyc*pop_age_structure_nyc- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nyc*pop_age_structure_nyc*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nyc*pop_age_structure_nyc*2e-06)
saveRDS(initials_nyc,"initials_nyc.rds")




#simulate the cases


SEIHDQR_9age_simulation_nyc_estimate_base <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_base, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)

SEIHDQR_9age_simulation_nyc_estimate_10more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_10more, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


SEIHDQR_9age_simulation_nyc_estimate_30more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_30more, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


SEIHDQR_9age_simulation_nyc_estimate_50more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_50more, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)



SEIHDQR_9age_simulation_nyc_estimate_10less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_10less, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)




SEIHDQR_9age_simulation_nyc_estimate_30less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_30less, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)



SEIHDQR_9age_simulation_nyc_estimate_50less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nyc_50less, init = initials_nyc, time = 0:365, outbreak_start_date = as.Date("2020-03-02"), inter_start_date1 = as.Date('2020-03-06'), inter_start_date2 = as.Date("2020-03-16"), inter_start_date3 = as.Date("2020-03-21"), inter_start_date4 = as.Date("2020-03-25"),inter_start_date5 = as.Date("2020-04-03"),inter_start_date6 = as.Date("2020-05-18"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nyc, constraint2 = constraint_package2_nyc, constraint3 = constraint_package3_nyc, constraint4 = constraint_package4_nyc, constraint5 = constraint_package5_nyc, constraint6 = constraint_package6_nyc)


SEIHDQR_9age_simulation_nyc_estimate_base$movement_scenario <- "base"
SEIHDQR_9age_simulation_nyc_estimate_10more$movement_scenario <- "10% increase"
SEIHDQR_9age_simulation_nyc_estimate_30more$movement_scenario <- "30% increase"
SEIHDQR_9age_simulation_nyc_estimate_50more$movement_scenario <- "50% increase"
SEIHDQR_9age_simulation_nyc_estimate_10less$movement_scenario <- "10% decrease"
SEIHDQR_9age_simulation_nyc_estimate_30less$movement_scenario <- "30% decrease"
SEIHDQR_9age_simulation_nyc_estimate_50less$movement_scenario <- "50% decrease"

SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity <- rbind(SEIHDQR_9age_simulation_nyc_estimate_base,SEIHDQR_9age_simulation_nyc_estimate_10more,SEIHDQR_9age_simulation_nyc_estimate_30more,SEIHDQR_9age_simulation_nyc_estimate_50more,SEIHDQR_9age_simulation_nyc_estimate_10less,SEIHDQR_9age_simulation_nyc_estimate_30less,SEIHDQR_9age_simulation_nyc_estimate_50less)


#plots
SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long <- SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity %>% gather(SEIHDQR, estimate, -c(time, period, movement_scenario))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long <- cbind(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long, state_age)
write.csv(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long,"SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long.csv",row.names = F)


SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_long, state=="D"))
I_9age_simulation_nyc_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_nyc_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_nyc_estimate_movement_sensitivity_long, na.rm=T)
#ID_9age_simulation_nyc_estimate_long <- subset(ID_9age_simulation_nyc_estimate_long,time<as.Date("2020-09-01"))
lineplot_I_9age_simulation_nyc_estimate_movement_sensitivity <- ggplot(I_9age_simulation_nyc_estimate_movement_sensitivity_agg, aes(x= as.Date(time), y= estimate, color=as.factor(movement_scenario)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(size=1)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~age_group)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Movement scenario"))+
  ggtitle("New York City movement sensitivity")

ggsave("lineplot_I_9age_simulation_nyc_estimate_movement_sensitivity.pdf", width = 12, height = 10)





```



```{r sensitivity analysis of population movement la}


la_int_travel_import_data <- readRDS("la_int_travel_import_data.rds")
la_int_travel_export_data <- readRDS("la_int_travel_export_data.rds")
la_dom_travel_import_data <- readRDS("la_dom_travel_import_data.rds")
la_dom_travel_export_data <- readRDS("la_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_la_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "Los Angeles")
age_specific_incidence_prop_la_extend_agg<-fread("age_specific_prop_la_extend_agg.csv",header = T)

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv",header =T)


contact_matrix_9age_la <-readRDS("contact_matrix_9age_la.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_la <- list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other)
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_la<-list(contact_matrix_9age_la$home,contact_matrix_9age_la$school,contact_matrix_9age_la$work,contact_matrix_9age_la$other*0.9)
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_la<-list(contact_matrix_9age_la$home*1.2,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.6,contact_matrix_9age_la$other*0.7)
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_la<-list(contact_matrix_9age_la$home*1.2,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.55,contact_matrix_9age_la$other*0.6)
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_la<-list(contact_matrix_9age_la$home*1.2,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.5,contact_matrix_9age_la$other*0.55)
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_la<-list(contact_matrix_9age_la$home*1.1,contact_matrix_9age_la$school*0,contact_matrix_9age_la$work*0.6,contact_matrix_9age_la$other*0.70)


#transmissibility
transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_la <- unlist(transmissibility_9age_la)*Reduce('+', contact_matrix_9age_nointer_la)
saveRDS(transm.rate_without_intervention_la,"transm.rate_without_intervention_la.rds")
transm.rate_package1_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p1_la)
saveRDS(transm.rate_package1_la,"transm.rate_package1_la.rds")
transm.rate_package2_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p2_la)
saveRDS(transm.rate_package2_la,"transm.rate_package2_la.rds")
transm.rate_package3_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p3_la)
saveRDS(transm.rate_package3_la,"transm.rate_package3_la.rds")
transm.rate_package4_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p4_la)
saveRDS(transm.rate_package4_la,"transm.rate_package4_la.rds")
transm.rate_package5_la <- unlist(transmissibility_9age_la)*Reduce('+', contact.matrix_p5_la)
saveRDS(transm.rate_package5_la,"transm.rate_package5_la.rds")



parameters_la_base <- list(i.import=la_int_travel_import_data*tourism_age_structure,
                       d.import=la_dom_travel_import_data*pop_age_structure_la,
                       i.export=la_int_travel_export_data*tourism_age_structure,
                       d.export=la_dom_travel_export_data*pop_age_structure_la,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.00001)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.00001)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)



parameters_la_10more <- list(i.import=la_int_travel_import_data*tourism_age_structure*1.1,
                       d.import=la_dom_travel_import_data*pop_age_structure_la*1.1,
                       i.export=la_int_travel_export_data*tourism_age_structure*1.1,
                       d.export=la_dom_travel_export_data*pop_age_structure_la*1.1,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.00001)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.00001)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)

parameters_la_30more <- list(i.import=la_int_travel_import_data*tourism_age_structure*1.3,
                       d.import=la_dom_travel_import_data*pop_age_structure_la*1.3,
                       i.export=la_int_travel_export_data*tourism_age_structure*1.3,
                       d.export=la_dom_travel_export_data*pop_age_structure_la*1.3,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.00001)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.00001)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)


parameters_la_50more <- list(i.import=la_int_travel_import_data*tourism_age_structure*1.5,
                       d.import=la_dom_travel_import_data*pop_age_structure_la*1.5,
                       i.export=la_int_travel_export_data*tourism_age_structure*1.5,
                       d.export=la_dom_travel_export_data*pop_age_structure_la*1.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.00001)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.00001)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)


parameters_la_10less <- list(i.import=la_int_travel_import_data*tourism_age_structure*0.9,
                       d.import=la_dom_travel_import_data*pop_age_structure_la*0.9,
                       i.export=la_int_travel_export_data*tourism_age_structure*0.9,
                       d.export=la_dom_travel_export_data*pop_age_structure_la*0.9,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.00001)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.00001)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)


parameters_la_30less <- list(i.import=la_int_travel_import_data*tourism_age_structure*0.7,
                       d.import=la_dom_travel_import_data*pop_age_structure_la*0.7,
                       i.export=la_int_travel_export_data*tourism_age_structure*0.7,
                       d.export=la_dom_travel_export_data*pop_age_structure_la*0.7,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.00001)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.00001)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)

parameters_la_50less <- list(i.import=la_int_travel_import_data*tourism_age_structure*0.5,
                       d.import=la_dom_travel_import_data*pop_age_structure_la*0.5,
                       i.export=la_int_travel_export_data*tourism_age_structure*0.5,
                       d.export=la_dom_travel_export_data*pop_age_structure_la*0.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_la_extend_annual_agg[,c(2:10)]*0.00001)),#
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_US_extend_annual_agg[,2:10]*0.00001)),
                       transm.rate = transm.rate_without_intervention_la,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_la,#hospitalization rate
                       fatal.rate = fatal.rate_la,
                       quar.rate = quar.rate_la,
                       death.rate = death.rate_la,
                       birth.rate = birth.rate_la,
                       n = pop_age_structure_la*pop_la)



constraint_no_intervention_la<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_annual_agg[1,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_US_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_la,"constraint_no_intervention_la.rds")
#2020-02-04
#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
constraint_package1_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[6],9)),
                               d.import = c(rep(0.9,9)),
                               i.export = c(rep(0.9,9)),
                               d.export = c(rep(0.9,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_la_extend_agg[3,3:11])*100,3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[5,3:11])*100,3)),
                               transm.rate = as.matrix(transm.rate_package1_la/transm.rate_without_intervention_la),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.9,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_la,"constraint_package1_la.rds")


#2020-03-12
#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
constraint_package2_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[7,3:11])*500),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11])*800,3)), 
                              transm.rate = transm.rate_package2_la/transm.rate_without_intervention_la*0.9,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.5,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_la,"constraint_package2_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#2020-03-19
constraint_package3_la<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[7,3:11]*800)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[8,3:11]*1000),3)),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_la,"constraint_package3_la.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-04-03
constraint_package4_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.45,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.export = c(rep(1-0.45,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[9,3:11]*1500)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[10,3:11]*2000),3)),
                               transm.rate = transm.rate_package3_la/transm.rate_without_intervention_la*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_la,"constraint_package4_la.rds")

#2020-04-16
constraint_package5_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.import = c(rep(1-0.40,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.export = c(rep(1-0.40,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[10,3:11]*2500)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[11,3:11])*3000,3)),
                               transm.rate = transm.rate_package4_la/transm.rate_without_intervention_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_la,"constraint_package5_la.rds")


#2020-06-04
constraint_package6_la <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[17],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(i_import_travel_prop_agg$travel_prop[17],9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_la_extend_agg[15,3:11]*3000)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_US_extend_agg[16,3:11]*3500),3)),
                               transm.rate = transm.rate_package5_la/transm.rate_without_intervention_la*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.4,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_la,"constraint_package6_la.rds")

E. = pop_la*pop_age_structure_la*2e-06/incub.rate
I. = pop_la*pop_age_structure_la*2e-06
initials_la <- c(S. = pop_la*pop_age_structure_la - E. - I.,
                  E. = rep(0,9),#I./incub.rate,
                  I. = 1*pop_age_structure_la,#pop_la*pop_age_structure_la*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_la*pop_age_structure_la*2e-06)
saveRDS(initials_la,"initials_la.rds")

#simulate the cases


SEIHDQR_9age_simulation_la_estimate_base <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_base, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)

SEIHDQR_9age_simulation_la_estimate_10more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_10more, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)


SEIHDQR_9age_simulation_la_estimate_30more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_30more, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)


SEIHDQR_9age_simulation_la_estimate_50more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_50more, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)



SEIHDQR_9age_simulation_la_estimate_10less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_10less, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)




SEIHDQR_9age_simulation_la_estimate_30less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_30less, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)



SEIHDQR_9age_simulation_la_estimate_50less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_la_50less, init = initials_la, time = 0:365, outbreak_start_date = as.Date("2020-01-26"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-03-12"), inter_start_date3 = as.Date("2020-03-19"), inter_start_date4 = as.Date("2020-04-03"),inter_start_date5 = as.Date("2020-04-16"),inter_start_date6 = as.Date("2020-06-04"),inter_end_date6 = as.Date("2021-01-24"), constraint1 = constraint_package1_la, constraint2 = constraint_package2_la, constraint3 = constraint_package3_la, constraint4 = constraint_package4_la, constraint5 = constraint_package5_la, constraint6 = constraint_package6_la)


SEIHDQR_9age_simulation_la_estimate_base$movement_scenario <- "base"
SEIHDQR_9age_simulation_la_estimate_10more$movement_scenario <- "10% increase"
SEIHDQR_9age_simulation_la_estimate_30more$movement_scenario <- "30% increase"
SEIHDQR_9age_simulation_la_estimate_50more$movement_scenario <- "50% increase"
SEIHDQR_9age_simulation_la_estimate_10less$movement_scenario <- "10% decrease"
SEIHDQR_9age_simulation_la_estimate_30less$movement_scenario <- "30% decrease"
SEIHDQR_9age_simulation_la_estimate_50less$movement_scenario <- "50% decrease"

SEIHDQR_9age_simulation_la_estimate_movement_sensitivity <- rbind(SEIHDQR_9age_simulation_la_estimate_base,SEIHDQR_9age_simulation_la_estimate_10more,SEIHDQR_9age_simulation_la_estimate_30more,SEIHDQR_9age_simulation_la_estimate_50more,SEIHDQR_9age_simulation_la_estimate_10less,SEIHDQR_9age_simulation_la_estimate_30less,SEIHDQR_9age_simulation_la_estimate_50less)


#plots
SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long <- SEIHDQR_9age_simulation_la_estimate_movement_sensitivity %>% gather(SEIHDQR, estimate, -c(time, period, movement_scenario))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long <- cbind(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long, state_age)
write.csv(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long,"SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long.csv",row.names = F)


SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long$time, origin = "2020-01-26")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_la_estimate_long, state=="D"))
I_9age_simulation_la_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_la_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_la_estimate_movement_sensitivity_long, na.rm=T)
#ID_9age_simulation_la_estimate_long <- subset(ID_9age_simulation_la_estimate_long,time<as.Date("2020-09-01"))
lineplot_I_9age_simulation_la_estimate_movement_sensitivity <- ggplot(I_9age_simulation_la_estimate_movement_sensitivity_agg, aes(x= as.Date(time), y= estimate, color=as.factor(movement_scenario)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(size=1)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~age_group)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Movement scenario"))+
  ggtitle("Los Angeles City movement sensitivity")

ggsave("lineplot_I_9age_simulation_la_estimate_movement_sensitivity.pdf", width = 12, height = 10)


```


```{r sensitivity analysis of population movement daegu}


daegu_int_travel_import_data <- readRDS("daegu_int_travel_import_data.rds")
daegu_int_travel_export_data <- readRDS("daegu_int_travel_export_data.rds")
daegu_dom_travel_import_data <- readRDS("daegu_dom_travel_import_data.rds")
daegu_dom_travel_export_data <- readRDS("daegu_dom_travel_export_data.rds")

mobility_nyc_la_daegu_nairobi_agg<- fread("mobility_nyc_la_daegu_nairobi_agg.csv")
mobility_daegu_agg <- subset(mobility_nyc_la_daegu_nairobi_agg,city == "Daegu")
age_specific_incidence_prop_daegu_extend_agg<-fread("age_specific_prop_daegu_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")



contact_matrix_9age_daegu <-readRDS("contact_matrix_9age_daegu.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_daegu <- list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work,contact_matrix_9age_daegu$other)
#2020-01-28
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school,contact_matrix_9age_daegu$work*0.95,contact_matrix_9age_daegu$other*0.88)
#2020-02-07
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work*0.9,contact_matrix_9age_daegu$other*0.85)
#2020-02-20
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work*0.9,contact_matrix_9age_daegu$other*0.8)
#2020-02-25 4-20
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0,contact_matrix_9age_daegu$work*0.7,contact_matrix_9age_daegu$other*0.6)
#2020-05-06
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_daegu<-list(contact_matrix_9age_daegu$home,contact_matrix_9age_daegu$school*0.3,contact_matrix_9age_daegu$work*0.8,contact_matrix_9age_daegu$other*0.8)


#transmissibility
transmissibility_9age_daegu <- readRDS("transmissibility_9age_daegu.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact_matrix_9age_nointer_daegu)
saveRDS(transm.rate_without_intervention_daegu,"transm.rate_without_intervention_daegu.rds")
transm.rate_package1_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p1_daegu)
saveRDS(transm.rate_package1_daegu,"transm.rate_package1_daegu.rds")
transm.rate_package2_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p2_daegu)
saveRDS(transm.rate_package2_daegu,"transm.rate_package2_daegu.rds")
transm.rate_package3_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p3_daegu)
saveRDS(transm.rate_package3_daegu,"transm.rate_package3_daegu.rds")
transm.rate_package4_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p4_daegu)
saveRDS(transm.rate_package4_daegu,"transm.rate_package4_daegu.rds")
transm.rate_package5_daegu <- unlist(transmissibility_9age_daegu)*Reduce('+', contact.matrix_p5_daegu)
saveRDS(transm.rate_package5_daegu,"transm.rate_package5_daegu.rds")

parameters_daegu_base <- list(i.import=daegu_int_travel_import_data*tourism_age_structure,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu,
                       i.export=daegu_int_travel_export_data*tourism_age_structure,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.2),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)





parameters_daegu_10more <- list(i.import=daegu_int_travel_import_data*tourism_age_structure*1.1,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu*1.1,
                       i.export=daegu_int_travel_export_data*tourism_age_structure*1.1,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu*1.1,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.2),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)


parameters_daegu_30more <- list(i.import=daegu_int_travel_import_data*tourism_age_structure*1.3,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu*1.3,
                       i.export=daegu_int_travel_export_data*tourism_age_structure*1.3,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu*1.3,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.2),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)




parameters_daegu_50more <- list(i.import=daegu_int_travel_import_data*tourism_age_structure*1.5,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu*1.5,
                       i.export=daegu_int_travel_export_data*tourism_age_structure*1.5,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu*1.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.2),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)




parameters_daegu_10less <- list(i.import=daegu_int_travel_import_data*tourism_age_structure*0.9,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu*0.9,
                       i.export=daegu_int_travel_export_data*tourism_age_structure*0.9,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu*0.9,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.2),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)


parameters_daegu_30less <- list(i.import=daegu_int_travel_import_data*tourism_age_structure*0.7,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu*0.7,
                       i.export=daegu_int_travel_export_data*tourism_age_structure*0.7,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu*0.7,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.2),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)

parameters_daegu_50less <- list(i.import=daegu_int_travel_import_data*tourism_age_structure*0.5,
                       d.import=daegu_dom_travel_import_data*pop_age_structure_daegu*0.5,
                       i.export=daegu_int_travel_export_data*tourism_age_structure*0.5,
                       d.export=daegu_dom_travel_export_data*pop_age_structure_daegu*0.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_daegu_extend_annual_agg[1,2:10])*0.2),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_korea_extend_annual_agg[,2:10]*0.5)),
                       transm.rate = transm.rate_without_intervention_daegu,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_daegu,#hospitalization rate
                       fatal.rate = fatal.rate_daegu,
                       quar.rate = quar.rate_daegu,
                       death.rate = death.rate_daegu,
                       birth.rate = birth.rate_daegu,
                       n = pop_age_structure_daegu*pop_daegu)





constraint_no_intervention_daegu<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_korea_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_daegu,"constraint_no_intervention_daegu.rds")
#2020-01-28
#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
constraint_package1_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[2],9)),
                               d.import = c(rep(0.8,9)),
                               i.export = c(rep(0.8,9)),
                               d.export = c(rep(0.8,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_daegu_extend_agg[2,3:11]*0.1),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[2,3:11]*0.1),3)),
                               transm.rate = as.matrix(transm.rate_package1_daegu/transm.rate_without_intervention_daegu),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_daegu,"constraint_package1_daegu.rds")


#2020-02-07
#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
constraint_package2_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[4],9)),
                               d.import = c(rep(1-0.3,9)),
                               i.export = c(rep(1-0.3,9)),
                               d.export = c(rep(1-0.3,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[4,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[3,3:11]*0.1),3)),
                               transm.rate = transm.rate_package2_daegu/transm.rate_without_intervention_daegu*0.95,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.08,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_daegu,"constraint_package2_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#2020-02-20
constraint_package3_daegu<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[4],9)),
                               d.import = c(rep(1-0.4,9)),
                               i.export = c(rep(1-0.4,9)),
                               d.export = c(rep(1-0.4,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[4,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[4,3:11]*0.1),3)),
                               transm.rate = transm.rate_package3_daegu/transm.rate_without_intervention_daegu*0.9,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.1,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_daegu,"constraint_package3_daegu.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-02-25
constraint_package4_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[9],9)),
                               d.import = c(rep(1-0.5,9)),
                               i.export = c(rep(1-0.8,9)),
                               d.export = c(rep(1-0.5,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[5,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[5,3:11]*0.1),3)),
                               transm.rate = transm.rate_package3_daegu/transm.rate_without_intervention_daegu*0.85,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.15,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_daegu,"constraint_package4_daegu.rds")

#2020-04-20
constraint_package5_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[11],9)),
                               d.import = c(rep(1-0.8,9)),
                               i.export = c(rep(1-0.8,9)),
                               d.export = c(rep(1-0.8,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[11,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[10,3:11]*0.1),3)),
                               transm.rate = transm.rate_package4_daegu/transm.rate_without_intervention_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.25,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_daegu,"constraint_package5_daegu.rds")


#2020-05-06
constraint_package6_daegu <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[13],9)),
                               d.import = c(rep(1-0.8,9)),
                               i.export = c(rep(1-0.95,9)),
                               d.export = c(rep(1-0.8,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_daegu_extend_agg[11,3:11]*0.1)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_korea_extend_agg[12,3:11]*0.1),3)),
                               transm.rate = transm.rate_package5_daegu/transm.rate_without_intervention_daegu*0.8,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.3,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_daegu,"constraint_package6_daegu.rds")




E. = pop_daegu*pop_age_structure_daegu*2e-06/incub.rate
I. = pop_daegu*pop_age_structure_daegu*2e-06
initials_daegu <- c(S. = pop_daegu*pop_age_structure_daegu- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_daegu*pop_age_structure_daegu*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_daegu*pop_age_structure_daegu*2e-06)
saveRDS(initials_daegu,"initials_daegu.rds")

library(deSolve)
#no intervention

#simulate the cases

SEIHDQR_9age_simulation_daegu_estimate_base <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_base, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)




SEIHDQR_9age_simulation_daegu_estimate_10more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_10more, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)


SEIHDQR_9age_simulation_daegu_estimate_30more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_30more, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)


SEIHDQR_9age_simulation_daegu_estimate_50more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_50more, init = initials_daegu, time = 0:365,  outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)



SEIHDQR_9age_simulation_daegu_estimate_10less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_10less, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)




SEIHDQR_9age_simulation_daegu_estimate_30less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_30less, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)



SEIHDQR_9age_simulation_daegu_estimate_50less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_daegu_50less, init = initials_daegu, time = 0:365, outbreak_start_date = as.Date("2020-01-20"), inter_start_date1 = as.Date('2020-01-28'), inter_start_date2 = as.Date("2020-02-07"), inter_start_date3 = as.Date("2020-02-20"), inter_start_date4 = as.Date("2020-02-25"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-05-06"),inter_end_date6 = as.Date("2021-01-18"), constraint1 = constraint_package1_daegu, constraint2 = constraint_package2_daegu, constraint3 = constraint_package3_daegu, constraint4 = constraint_package4_daegu, constraint5 = constraint_package5_daegu, constraint6 = constraint_package6_daegu)


SEIHDQR_9age_simulation_daegu_estimate_base$movement_scenario <- "base"
SEIHDQR_9age_simulation_daegu_estimate_10more$movement_scenario <- "10% increase"
SEIHDQR_9age_simulation_daegu_estimate_30more$movement_scenario <- "30% increase"
SEIHDQR_9age_simulation_daegu_estimate_50more$movement_scenario <- "50% increase"
SEIHDQR_9age_simulation_daegu_estimate_10less$movement_scenario <- "10% decrease"
SEIHDQR_9age_simulation_daegu_estimate_30less$movement_scenario <- "30% decrease"
SEIHDQR_9age_simulation_daegu_estimate_50less$movement_scenario <- "50% decrease"

SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity <- rbind(SEIHDQR_9age_simulation_daegu_estimate_base,SEIHDQR_9age_simulation_daegu_estimate_10more,SEIHDQR_9age_simulation_daegu_estimate_30more,SEIHDQR_9age_simulation_daegu_estimate_50more,SEIHDQR_9age_simulation_daegu_estimate_10less,SEIHDQR_9age_simulation_daegu_estimate_30less,SEIHDQR_9age_simulation_daegu_estimate_50less)


#plots
SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long <- SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity %>% gather(SEIHDQR, estimate, -c(time, period, movement_scenario))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long <- cbind(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long, state_age)
write.csv(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long,"SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long.csv",row.names = F)


SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long$time, origin = "2020-01-20")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_daegu_estimate_long, state=="D"))
I_9age_simulation_daegu_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_daegu_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_daegu_estimate_movement_sensitivity_long, na.rm=T)
#ID_9age_simulation_daegu_estimate_long <- subset(ID_9age_simulation_daegu_estimate_long,time<as.Date("2020-09-01"))
lineplot_I_9age_simulation_daegu_estimate_movement_sensitivity <- ggplot(I_9age_simulation_daegu_estimate_movement_sensitivity_agg, aes(x= as.Date(time), y= estimate, color=as.factor(movement_scenario)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(size=1)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Age")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~age_group)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Movement scenario"))+
  ggtitle("Daegu City movement sensitivity")

ggsave("lineplot_I_9age_simulation_daegu_estimate_movement_sensitivity.pdf", width = 12, height = 10)


```



```{r sensitivity analysis of population movement nairobi}


nairobi_int_travel_import_data <- readRDS("nairobi_int_travel_import_data.rds")
nairobi_int_travel_export_data <- readRDS("nairobi_int_travel_export_data.rds")
nairobi_dom_travel_import_data <- readRDS("nairobi_dom_travel_import_data.rds")
nairobi_dom_travel_export_data <- readRDS("nairobi_dom_travel_export_data.rds")

mobility_nyc_la_nairobi_nairobi_agg<- fread("mobility_nyc_la_nairobi_nairobi_agg.csv")
mobility_nairobi_agg <- subset(mobility_nyc_la_nairobi_nairobi_agg,city == "Nairobi")
age_specific_incidence_prop_nairobi_extend_agg<-fread("age_specific_prop_nairobi_extend_agg.csv")

i_import_travel_prop_agg <- fread("i_import_travel_prop_agg.csv")


contact_matrix_9age_nairobi <-readRDS("contact_matrix_9age_nairobi.rds")
#contact matrix without intervention
contact_matrix_9age_nointer_nairobi <- list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work,contact_matrix_9age_nairobi$other)
#2020-03-15
#contact matrix policy package 1: 100%*home+100%*school+100%*workplace+90%*others+0%quarantine
contact.matrix_p1_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school,contact_matrix_9age_nairobi$work*0.9,contact_matrix_9age_nairobi$other*0.9)
#2020-03-23
#contact matrix policy package 2: 100%*home+0%*school+95%*workplace+80%*others+5%quarantine
contact.matrix_p2_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work*0.80,contact_matrix_9age_nairobi$other*0.70)
#2020-03-27
#contact matrix policy package 3: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p3_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work*0.60,contact_matrix_9age_nairobi$other*0.55)
#2020-04-15
#contact matrix policy package 4: 100%*home+0%*school+20%*workplace+50%*others+30%quarantine
contact.matrix_p4_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0,contact_matrix_9age_nairobi$work*0.7,contact_matrix_9age_nairobi$other*0.5)
#2020-09-01
#contact matrix policy package 5: 100%*home+0%*school+20%*workplace+20%*others+20%quarantine+95%transimissibility
contact.matrix_p5_nairobi<-list(contact_matrix_9age_nairobi$home,contact_matrix_9age_nairobi$school*0.5,contact_matrix_9age_nairobi$work*0.8,contact_matrix_9age_nairobi$other*0.8)


#transmissibility
transmissibility_9age_nairobi <- readRDS("transmissibility_9age_nairobi.rds")
#transmissibility_9age_la <- readRDS("transmissibility_9age_la.rds")
###transmission rate
transm.rate_without_intervention_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact_matrix_9age_nointer_nairobi)
saveRDS(transm.rate_without_intervention_nairobi,"transm.rate_without_intervention_nairobi.rds")
transm.rate_package1_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p1_nairobi)
saveRDS(transm.rate_package1_nairobi,"transm.rate_package1_nairobi.rds")
transm.rate_package2_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p2_nairobi)
saveRDS(transm.rate_package2_nairobi,"transm.rate_package2_nairobi.rds")
transm.rate_package3_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p3_nairobi)
saveRDS(transm.rate_package3_nairobi,"transm.rate_package3_nairobi.rds")
transm.rate_package4_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p4_nairobi)
saveRDS(transm.rate_package4_nairobi,"transm.rate_package4_nairobi.rds")
transm.rate_package5_nairobi <- unlist(transmissibility_9age_nairobi)*Reduce('+', contact.matrix_p5_nairobi)
saveRDS(transm.rate_package5_nairobi,"transm.rate_package5_nairobi.rds")


parameters_nairobi_base <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)





parameters_nairobi_10more <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure*1.1,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi*1.1,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure*1.1,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi*1.1,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)


parameters_nairobi_30more <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure*1.3,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi*1.3,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure*1.3,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi*1.3,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)




parameters_nairobi_50more <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure*1.5,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi*1.5,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure*1.5,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi*1.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)




parameters_nairobi_10less <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure*0.9,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi*0.9,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure*0.9,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi*0.9,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)


parameters_nairobi_30less <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure*0.7,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi*0.7,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure*0.7,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi*0.7,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)

parameters_nairobi_50less <- list(i.import=nairobi_int_travel_import_data*tourism_age_structure*0.5,
                       d.import=nairobi_dom_travel_import_data*pop_age_structure_nairobi*0.5,
                       i.export=nairobi_int_travel_export_data*tourism_age_structure*0.5,
                       d.export=nairobi_dom_travel_export_data*pop_age_structure_nairobi*0.5,
                       i.incidence.rate = as.vector(unlist(age_specific_incidence_nairobi_extend_annual_agg[1,2:10])*0.1),
                       d.incidence.rate = as.vector(unlist(age_specific_domestic_incidence_kenya_extend_annual_agg[,2:10]*0.1)),
                       transm.rate = transm.rate_without_intervention_nairobi,#transmission rate
                       incub.rate = incub.rate,#
                       recov.rate = recov.rate,
                       hosp.rate = hosp.rate_nairobi,#hospitalization rate
                       fatal.rate = fatal.rate_nairobi,
                       quar.rate = quar.rate_nairobi,
                       death.rate = death.rate_nairobi,
                       birth.rate = birth.rate_nairobi,
                       n = pop_age_structure_nairobi*pop_nairobi)






constraint_no_intervention_nairobi<- list(i.import = c(rep(1,9)),
                                      d.import = c(rep(1,9)),
                                      i.export = c(rep(1,9)),
                                      d.export = c(rep(1,9)),
                                      i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_annual_agg[,2:10])),
                                      d.incidence.rate = as.vector(unlist(age_specific_domestic_prop_kenya_extend_annual_agg[1,2:10])),
                                      transm.rate = matrix(1,9,9),#transmission rate
                                      incub.rate = c(rep(1,9)),#
                                      recov.rate = c(rep(1,9)),
                                      hosp.rate = c(rep(1,9)),#hospitalization rate
                                      fatal.rate = c(rep(1,9)),
                                      quar.rate = c(rep(1,9)),
                                      death.rate = c(rep(1,9)), #death.rate,
                                      birth.rate = c(rep(1,9)),
                                      n = c(rep(1,9)))
saveRDS(constraint_no_intervention_nairobi,"constraint_no_intervention_nairobi.rds")
#2020-03-15
#100%*home+100%*school+100%*workplace+90%*others+20%quarantine+95%transimissibility
constraint_package1_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[7],9)),
                               d.import = c(rep(0.8,9)),
                               i.export = c(rep(0.7,9)),
                               d.export = c(rep(0.8,9)),
                               i.incidence.rate = as.vector(round(unlist(age_specific_prop_nairobi_extend_agg[2,3:11]*0.5),3)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[7,3:11]*0.5),3)),
                               transm.rate = as.matrix(transm.rate_package1_nairobi/transm.rate_without_intervention_nairobi),#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))
saveRDS(constraint_package1_nairobi,"constraint_package1_nairobi.rds")


#2020-03-23
#100%*home+0%*school+95%*workplace+50%*others+30%quarantine+95%transimissibility
constraint_package2_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.30,9)),
                               i.export = c(rep(1-0.30,9)),
                               d.export = c(rep(1-0.30,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[3,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[7,3:11]*0.5),3)),
                               transm.rate = transm.rate_package2_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                               incub.rate = c(rep(1,9)),#
                               recov.rate = c(rep(1,9)),
                               hosp.rate = c(rep(1,9)),#hospitalization rate
                               fatal.rate = c(rep(1,9)),
                               quar.rate = c(rep(1e04*0.01,9)),
                               death.rate = c(rep(1,9)), #death.rate,
                               birth.rate = c(rep(1,9)),
                               n = c(rep(1,9)))

saveRDS(constraint_package2_nairobi,"constraint_package2_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+95%transimissibility
#2020-03-27
constraint_package3_nairobi<- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[8],9)),
                               d.import = c(rep(1-0.4,9)),
                               i.export = c(rep(1-0.4,9)),
                               d.export = c(rep(1-0.4,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[3,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[8,3:11]*0.5),3)),
                               transm.rate = transm.rate_package3_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.01,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package3_nairobi,"constraint_package3_nairobi.rds")

#100%*home+0%*school+20%*workplace+20%*others+30%quarantine+90%transimissibility
#2020-04-15
constraint_package4_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[10],9)),
                               d.import = c(rep(1-0.5,9)),
                               i.export = c(rep(1-0.5,9)),
                               d.export = c(rep(1-0.5,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[5,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[10,3:11]*0.5),3)),
                               transm.rate = transm.rate_package3_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.01,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package4_nairobi,"constraint_package4_nairobi.rds")

#2020-04-20
constraint_package5_nairobi <- list(i.import = c(rep(i_import_travel_prop_agg$travel_prop[11],9)),
                               d.import = c(rep(1-0.4,9)),
                               i.export = c(rep(1-0.4,9)),
                               d.export = c(rep(1-0.4,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[6,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[11,3:11]*0.5),3)),
                               transm.rate = transm.rate_package4_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.01,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package5_nairobi,"constraint_package5_nairobi.rds")


#2020-09-01
constraint_package6_nairobi <- list(i.import = c(rep(0.15,9)),
                               d.import = c(rep(0.5,9)),
                               i.export = c(rep(0.4,9)),
                               d.export = c(rep(0.5,9)),
                               i.incidence.rate = as.vector(unlist(age_specific_prop_nairobi_extend_agg[19,3:11]*0.5)),
                               d.incidence.rate = as.vector(round(unlist(age_specific_domestic_prop_kenya_extend_agg[24,3:11]*0.5),3)),
                               transm.rate = transm.rate_package5_nairobi/transm.rate_without_intervention_nairobi*0.95,#transmission rate
                   incub.rate = c(rep(1,9)),#
                   recov.rate = c(rep(1,9)),
                   hosp.rate = c(rep(1,9)),#hospitalization rate
                   fatal.rate = c(rep(1,9)),
                   quar.rate = c(rep(1e04*0.02,9)),
                   death.rate = c(rep(1,9)), #death.rate,
                   birth.rate = c(rep(1,9)),
                   n = c(rep(1,9)))
saveRDS(constraint_package6_nairobi,"constraint_package6_nairobi.rds")

E. = pop_nairobi*pop_age_structure_nairobi*2e-06#/incub.rate
I. = pop_nairobi*pop_age_structure_nairobi*2e-06
initials_nairobi <- c(S. = pop_nairobi*pop_age_structure_nairobi- E. - I.,
                  E. = I./incub.rate,
                  I. = pop_nairobi*pop_age_structure_nairobi*2e-06,
                  H. = rep(0,9),
                  D. = rep(0,9),
                  Q. = rep(0,9),
                  R. = rep(0,9),
                  Ic. = pop_nairobi*pop_age_structure_nairobi*2e-06)
saveRDS(initials_nairobi,"initials_nairobi.rds")


library(deSolve)
#no intervention

#simulate the cases

SEIHDQR_9age_simulation_nairobi_estimate_base <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_base, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)



SEIHDQR_9age_simulation_nairobi_estimate_10more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_10more, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)


SEIHDQR_9age_simulation_nairobi_estimate_30more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_30more, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)



SEIHDQR_9age_simulation_nairobi_estimate_50more <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_50more, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)



SEIHDQR_9age_simulation_nairobi_estimate_10less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_10less, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)



SEIHDQR_9age_simulation_nairobi_estimate_30less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_30less, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)


SEIHDQR_9age_simulation_nairobi_estimate_50less <- SEIHDQR_9age_simulation_intervention_model(pars = parameters_nairobi_50less, init = initials_nairobi, time = 0:365, outbreak_start_date = as.Date("2020-03-13"), inter_start_date1 = as.Date('2020-03-15'), inter_start_date2 = as.Date("2020-03-23"), inter_start_date3 = as.Date("2020-03-27"), inter_start_date4 = as.Date("2020-04-15"),inter_start_date5 = as.Date("2020-04-20"),inter_start_date6 = as.Date("2020-09-01"),inter_end_date6 = as.Date("2021-03-01"),  constraint1 = constraint_package1_nairobi, constraint2 = constraint_package2_nairobi, constraint3 = constraint_package3_nairobi, constraint4 = constraint_package4_nairobi, constraint5 = constraint_package5_nairobi, constraint6 = constraint_package6_nairobi)


SEIHDQR_9age_simulation_nairobi_estimate_base$movement_scenario <- "base"
SEIHDQR_9age_simulation_nairobi_estimate_10more$movement_scenario <- "10% increase"
SEIHDQR_9age_simulation_nairobi_estimate_30more$movement_scenario <- "30% increase"
SEIHDQR_9age_simulation_nairobi_estimate_50more$movement_scenario <- "50% increase"
SEIHDQR_9age_simulation_nairobi_estimate_10less$movement_scenario <- "10% decrease"
SEIHDQR_9age_simulation_nairobi_estimate_30less$movement_scenario <- "30% decrease"
SEIHDQR_9age_simulation_nairobi_estimate_50less$movement_scenario <- "50% decrease"

SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity <- rbind(SEIHDQR_9age_simulation_nairobi_estimate_base,SEIHDQR_9age_simulation_nairobi_estimate_10more,SEIHDQR_9age_simulation_nairobi_estimate_30more,SEIHDQR_9age_simulation_nairobi_estimate_50more,SEIHDQR_9age_simulation_nairobi_estimate_10less,SEIHDQR_9age_simulation_nairobi_estimate_30less,SEIHDQR_9age_simulation_nairobi_estimate_50less)


#plots
SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long <- SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity %>% gather(SEIHDQR, estimate, -c(time, period, movement_scenario))
state_age<-as.data.frame(do.call(rbind, strsplit(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long$SEIHDQR, "[.]")))
colnames(state_age)<-c("state","age_group")
SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long <- cbind(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long, state_age)
write.csv(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long,"SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long.csv",row.names = F)


SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
I_9age_simulation_nairobi_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_nairobi_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_nairobi_estimate_movement_sensitivity_long, na.rm=T)
#ID_9age_simulation_nairobi_estimate_long <- subset(ID_9age_simulation_nairobi_estimate_long,time<as.Date("2020-09-01"))
lineplot_I_9age_simulation_nairobi_estimate_movement_sensitivity <- ggplot(I_9age_simulation_nairobi_estimate_movement_sensitivity_agg, aes(x= as.Date(time), y= estimate, color=as.factor(movement_scenario)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(size=1)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%b. %d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet(name = "Movement scenario")+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        # strip.text = element_text(size = 20,face="bold", colour = "grey"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=10),#legend text
        axis.title.x = element_text(size=25, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=25, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=22, angle = 90),
        axis.text.y = element_text(size=22, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  #facet_grid(.~age_group)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Movement scenario"))+
  ggtitle("nairobi City movement sensitivity")

ggsave("lineplot_I_9age_simulation_nairobi_estimate_movement_sensitivity.pdf", width = 12, height = 10)


```

```{r plots for sensitivity movement}

SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_long, state=="D"))
I_9age_simulation_nyc_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_nyc_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_nyc_estimate_movement_sensitivity_long, na.rm=T)

I_9age_simulation_nyc_estimate_movement_sensitivity_agg$city <- "New York"


SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long$time, origin = "2020-01-26")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_la_estimate_long, state=="D"))
I_9age_simulation_la_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_la_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_la_estimate_movement_sensitivity_long, na.rm=T)

I_9age_simulation_la_estimate_movement_sensitivity_agg$city <- "Los Angeles"


SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long$time, origin = "2020-01-20")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_daegu_estimate_long, state=="D"))
I_9age_simulation_daegu_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_daegu_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_daegu_estimate_movement_sensitivity_long, na.rm=T)
I_9age_simulation_daegu_estimate_movement_sensitivity_agg$city <- "Daegu"



SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
I_9age_simulation_nairobi_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long, state=="I")#
I_9age_simulation_nairobi_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, I_9age_simulation_nairobi_estimate_movement_sensitivity_long, na.rm=T)
I_9age_simulation_nairobi_estimate_movement_sensitivity_agg$city <- "Nairobi"

nyc_la_nairobi_daegu_estimate_movement_sensitivity_agg <- rbind(I_9age_simulation_nyc_estimate_movement_sensitivity_agg,I_9age_simulation_la_estimate_movement_sensitivity_agg,I_9age_simulation_daegu_estimate_movement_sensitivity_agg,I_9age_simulation_nairobi_estimate_movement_sensitivity_agg)

#ID_9age_simulation_nairobi_estimate_long <- subset(ID_9age_simulation_nairobi_estimate_long,time<as.Date("2020-09-01"))
lineplot_nyc_la_nairobi_daegu_estimate_movement_sensitivity_agg <- ggplot(nyc_la_nairobi_daegu_estimate_movement_sensitivity_agg, aes(x= as.Date(time), y= estimate, color=as.factor(movement_scenario)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(size=1)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%Y-%m-%d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet()+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        strip.text = element_text(size = 20,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=12, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=12, angle = 90),
        axis.text.y = element_text(size=18, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  facet_wrap(.~city, nrow=2, scales = "free")+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Movement scenario"))+
  ggtitle("Four cities movement sensitivity")

ggsave("lineplot_nyc_la_nairobi_daegu_estimate_movement_sensitivity_agg.pdf", width = 14, height = 12)




I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, I_9age_simulation_nyc_estimate_movement_sensitivity_long)
I_9age_simulation_la_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, I_9age_simulation_la_estimate_movement_sensitivity_long)
I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, I_9age_simulation_daegu_estimate_movement_sensitivity_long)
I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, I_9age_simulation_nairobi_estimate_movement_sensitivity_long)

I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base <- subset(I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg, movement_scenario=="base")
I_9age_simulation_la_estimate_movement_sensitivity_age_agg_base <- subset(I_9age_simulation_la_estimate_movement_sensitivity_age_agg, movement_scenario=="base")
I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base <- subset(I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg, movement_scenario=="base")
I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base <- subset(I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg, movement_scenario=="base")

I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_scenario <- subset(I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")
I_9age_simulation_la_estimate_movement_sensitivity_age_agg_scenario <- subset(I_9age_simulation_la_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")
I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_scenario <- subset(I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")
I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_scenario <- subset(I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")

I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
I_9age_simulation_la_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
names(I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")
names(I_9age_simulation_la_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")
names(I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")
names(I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")

I_9age_simulation_nyc_estimate_movement_sensitivity_age_effect <- merge(I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_scenario,I_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

I_9age_simulation_la_estimate_movement_sensitivity_age_effect <- merge(I_9age_simulation_la_estimate_movement_sensitivity_age_agg_scenario,I_9age_simulation_la_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

I_9age_simulation_daegu_estimate_movement_sensitivity_age_effect <- merge(I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_scenario,I_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

I_9age_simulation_nairobi_estimate_movement_sensitivity_age_effect <- merge(I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_scenario,I_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

I_9age_simulation_nyc_estimate_movement_sensitivity_age_effect$city <- "New York"
I_9age_simulation_la_estimate_movement_sensitivity_age_effect$city <- "Los Angeles"
I_9age_simulation_daegu_estimate_movement_sensitivity_age_effect$city <- "Daegu"
I_9age_simulation_nairobi_estimate_movement_sensitivity_age_effect$city <- "Nairobi"
I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect <- rbind(I_9age_simulation_nyc_estimate_movement_sensitivity_age_effect,I_9age_simulation_la_estimate_movement_sensitivity_age_effect,I_9age_simulation_daegu_estimate_movement_sensitivity_age_effect,I_9age_simulation_nairobi_estimate_movement_sensitivity_age_effect)

I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$ageing_effect <- (I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$estimate - I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$estimate_base)/I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$estimate_base
neworder_age<-c(1,2,3,4,5,6,7,8,9)
I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$age_group <-factor(I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$age_group, levels=neworder_age, labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
write.csv(I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect,"I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect.csv",row.names = F)
unique(I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$movement_scenario)
neworder_scenario<-c("50% decrease","30% decrease","10% decrease","10% increase", "30% increase", "50% increase")
I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$movement_scenario <-factor(I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$movement_scenario, levels=neworder_scenario, labels = c("-50%","-30%","-10%","+10%", "+30%", "+50%"))

matrix_plot_I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect <- ggplot(I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect, aes(x=movement_scenario, y= age_group, fill=ageing_effect))+
  geom_tile(color="white",size=1)+
  geom_text(aes(label=round(ageing_effect,3)), color = "black", size=7)+
  #scale_fill_gradient(low="orange", high="white", limits=c(-0.5, 0.2), na.value = "transparent")+
  scale_fill_viridis_c(direction = -1, option = "viridis", begin = 0, end = 1, limits=c(-0.5, 0.5), name="Movement effect") +
  scale_x_discrete(name = "City")+
  scale_y_discrete(name = "Age group")+
  theme(axis.title = element_text(size = 18),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 18,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=18, angle = 90),
        axis.text.y = element_text(size=18, angle = 0))+

  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  #guides(fill=guide_legend("Ageing effect"))+
  facet_wrap(.~city,nrow=2, strip.position = "left")
ggsave("matrix_plot_I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect.pdf", width = 16, height = 12)



I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg <- aggregate(cbind(estimate, estimate_base)~movement_scenario+city, FUN=sum, I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect)
I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$ageing_effect <- (I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$estimate-I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$estimate_base)/I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$estimate_base
write.csv(I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg,"I_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg.csv",row.names = F)







#death

SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long$time, origin = "2020-03-02")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nyc_estimate_long, state=="D"))
D_9age_simulation_nyc_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_nyc_estimate_movement_sensitivity_long, state=="D")#
D_9age_simulation_nyc_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, D_9age_simulation_nyc_estimate_movement_sensitivity_long, na.rm=T)

D_9age_simulation_nyc_estimate_movement_sensitivity_agg$city <- "New York"


SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long$time, origin = "2020-01-26")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_la_estimate_long, state=="D"))
D_9age_simulation_la_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_la_estimate_movement_sensitivity_long, state=="D")#
D_9age_simulation_la_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, D_9age_simulation_la_estimate_movement_sensitivity_long, na.rm=T)

D_9age_simulation_la_estimate_movement_sensitivity_agg$city <- "Los Angeles"


SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long$time, origin = "2020-01-20")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_daegu_estimate_long, state=="D"))
D_9age_simulation_daegu_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_daegu_estimate_movement_sensitivity_long, state=="D")#
D_9age_simulation_daegu_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, D_9age_simulation_daegu_estimate_movement_sensitivity_long, na.rm=T)
D_9age_simulation_daegu_estimate_movement_sensitivity_agg$city <- "Daegu"



SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long <-fread("SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long.csv")
SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long$time<-as.Date(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long$time, origin = "2020-03-13")
#infectious and deaths
#View(subset(SEIHDQR_9age_simulation_nairobi_estimate_long, state=="D"))
D_9age_simulation_nairobi_estimate_movement_sensitivity_long<-subset(SEIHDQR_9age_simulation_nairobi_estimate_movement_sensitivity_long, state=="D")#
D_9age_simulation_nairobi_estimate_movement_sensitivity_agg <- aggregate(estimate~time+movement_scenario,FUN=sum, D_9age_simulation_nairobi_estimate_movement_sensitivity_long, na.rm=T)
D_9age_simulation_nairobi_estimate_movement_sensitivity_agg$city <- "Nairobi"

nyc_la_nairobi_daegu_estimate_movement_sensitivity_agg <- rbind(D_9age_simulation_nyc_estimate_movement_sensitivity_agg,D_9age_simulation_la_estimate_movement_sensitivity_agg,D_9age_simulation_daegu_estimate_movement_sensitivity_agg,D_9age_simulation_nairobi_estimate_movement_sensitivity_agg)

#ID_9age_simulation_nairobi_estimate_long <- subset(ID_9age_simulation_nairobi_estimate_long,time<as.Date("2020-09-01"))
lineplot_nyc_la_nairobi_daegu_estimate_movement_sensitivity_agg <- ggplot(nyc_la_nairobi_daegu_estimate_movement_sensitivity_agg, aes(x= as.Date(time), y= estimate, color=as.factor(movement_scenario)))+
  #geom_text_repel(data=filter(mort2016, GDP_ppp2011>1.0e+12), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, lossvslyage_percapita2000_2016<(-0.3)), aes(label=(country_abb)), point.padding = 2, size=6, segment.size = 1, show.legend = FALSE)+
  #geom_vline(xintercept = 60,colour="gray90",size=1.2)+
  #geom_hline(yintercept = 0,colour="gray90",size=1.2)+
  geom_line(size=1)+
  #scale_y_continuous(labels = scales::percent_format(accuracy = 1), breaks = seq(0,0.12, 0.02))+
  scale_x_date(date_breaks = "1 month", date_minor_breaks = "1 week", date_labels = "%Y-%m-%d")+
  #geom_text_repel(data=filter(loss_gdp_mortality_agg60_2000_2016_diff_sub, GDP_ppp2011>1.5e+12), aes(label=(country_abb)), point.padding = 1)+
  #scale_color_viridis_d(option="viridis", name = "Age", end=1,direction = 1)+
  scale_color_lancet()+
  # geom_smooth(method = loess,level=0.95, span=0, size=1, alpha=0.3)+
  theme(axis.title = element_text(size = 10),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        
        strip.text = element_text(size = 20,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        #legend.title = element_text(size = 25,face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=12, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=12, angle = 90),
        axis.text.y = element_text(size=18, angle = 0))+
  xlab("Time")+ 
  ylab("Real-time cases per day")+
  facet_wrap(.~city, nrow=2, scales = "free")+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  guides(color=guide_legend("Movement scenario"))+
  ggtitle("Four cities movement sensitivity")

ggsave("lineplot_nyc_la_nairobi_daegu_death_estimate_movement_sensitivity_agg.pdf", width = 14, height = 12)




D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, D_9age_simulation_nyc_estimate_movement_sensitivity_long)
D_9age_simulation_la_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, D_9age_simulation_la_estimate_movement_sensitivity_long)
D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, D_9age_simulation_daegu_estimate_movement_sensitivity_long)
D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg <- aggregate(estimate~movement_scenario+age_group, FUN=sum, D_9age_simulation_nairobi_estimate_movement_sensitivity_long)

D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base <- subset(D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg, movement_scenario=="base")
D_9age_simulation_la_estimate_movement_sensitivity_age_agg_base <- subset(D_9age_simulation_la_estimate_movement_sensitivity_age_agg, movement_scenario=="base")
D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base <- subset(D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg, movement_scenario=="base")
D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base <- subset(D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg, movement_scenario=="base")

D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_scenario <- subset(D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")
D_9age_simulation_la_estimate_movement_sensitivity_age_agg_scenario <- subset(D_9age_simulation_la_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")
D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_scenario <- subset(D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")
D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_scenario <- subset(D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg, !movement_scenario=="base")

D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
D_9age_simulation_la_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base$movement_scenario <- NULL
names(D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")
names(D_9age_simulation_la_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")
names(D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")
names(D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base) <- c("age_group","estimate_base")

D_9age_simulation_nyc_estimate_movement_sensitivity_age_effect <- merge(D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_scenario,D_9age_simulation_nyc_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

D_9age_simulation_la_estimate_movement_sensitivity_age_effect <- merge(D_9age_simulation_la_estimate_movement_sensitivity_age_agg_scenario,D_9age_simulation_la_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

D_9age_simulation_daegu_estimate_movement_sensitivity_age_effect <- merge(D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_scenario,D_9age_simulation_daegu_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

D_9age_simulation_nairobi_estimate_movement_sensitivity_age_effect <- merge(D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_scenario,D_9age_simulation_nairobi_estimate_movement_sensitivity_age_agg_base, by=c("age_group"))

D_9age_simulation_nyc_estimate_movement_sensitivity_age_effect$city <- "New York"
D_9age_simulation_la_estimate_movement_sensitivity_age_effect$city <- "Los Angeles"
D_9age_simulation_daegu_estimate_movement_sensitivity_age_effect$city <- "Daegu"
D_9age_simulation_nairobi_estimate_movement_sensitivity_age_effect$city <- "Nairobi"
D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect <- rbind(D_9age_simulation_nyc_estimate_movement_sensitivity_age_effect,D_9age_simulation_la_estimate_movement_sensitivity_age_effect,D_9age_simulation_daegu_estimate_movement_sensitivity_age_effect,D_9age_simulation_nairobi_estimate_movement_sensitivity_age_effect)

D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$ageing_effect <- (D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$estimate - D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$estimate_base)/D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$estimate_base
neworder_age<-c(1,2,3,4,5,6,7,8,9)
D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$age_group <-factor(D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$age_group, levels=neworder_age, labels = c("0-9","10-19","20-29","30-39","40-49","50-59","60-69","70-79","80+"))
write.csv(D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect,"D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect.csv",row.names = F)
unique(D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$movement_scenario)
neworder_scenario<-c("50% decrease","30% decrease","10% decrease","10% increase", "30% increase", "50% increase")
D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$movement_scenario <-factor(D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect$movement_scenario, levels=neworder_scenario, labels = c("-50%","-30%","-10%","+10%", "+30%", "+50%"))

matrix_plot_D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect <- ggplot(D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect, aes(x=movement_scenario, y= age_group, fill=ageing_effect))+
  geom_tile(color="white",size=1)+
  geom_text(aes(label=round(ageing_effect,3)), color = "black", size=5)+
  #scale_fill_gradient(low="orange", high="white", limits=c(-0.5, 0.2), na.value = "transparent")+
  scale_fill_viridis_c(direction = -1, option = "plasma", begin = 0, end = 1, limits=c(-0.5, 0.5), name="Movement effect") +
  scale_x_discrete(name = "City")+
  scale_y_discrete(name = "Age group")+
  theme(axis.title = element_text(size = 18),
        panel.background = element_rect(fill="white"),
        #panel.border = element_rect(fill = NA, color = "grey85"),
        #text = element_text(size = 10, face = "bold"),
        strip.text = element_text(size = 16,face="bold", colour = "black"),#strip text size
        #strip.background = element_rect(size=0.5, fill="grey95"),
        legend.title = element_text(size = 18, face="bold"),#legend title
        legend.text = element_text(size=18),#legend text
        axis.title.x = element_text(size=18, face="bold",margin = margin(t = 20, r = 0, b = 20, l = 0)),
        axis.title.y = element_text(size=18, face="bold", margin = margin(t = 0, r = 20, b = 0, l = 20)),
        axis.text.x = element_text(size=20, angle = 90),
        axis.text.y = element_text(size=20, angle = 0))+

  #facet_grid(.~cause)+
  #xlim(-0.4,0.2)+
  #ylim(-10,30)+
  #guides(fill=guide_legend("Ageing effect"))+
  facet_wrap(.~city,nrow=2, strip.position = "left")
ggsave("matrix_plot_D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect.pdf", width = 14, height = 12)



D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg <- aggregate(cbind(estimate, estimate_base)~movement_scenario+city, FUN=sum, D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect)
D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$ageing_effect <- (D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$estimate-D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$estimate_base)/D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg$estimate_base
write.csv(D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg,"D_9age_simulation_nyc_la_daegu_nairobi_estimate_movement_sensitivity_age_effect_agg.csv",row.names = F)

```

